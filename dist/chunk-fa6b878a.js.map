{"version":3,"file":"chunk-fa6b878a.js","sources":["../node_modules/can-observation-recorder/can-observation-recorder.js"],"sourcesContent":["\"use strict\";\nvar namespace = require(\"can-namespace\");\nvar canSymbol = require(\"can-symbol\");\n\n// Contains stack of observation records created by pushing with `.start`\n// and popping with `.stop()`.\n// The top of the stack is the \"target\" observation record - the record that calls\n// to `ObservationRecorder.add` get added to.\nvar stack = [];\n\nvar addParentSymbol = canSymbol.for(\"can.addParent\");\n\nvar ObservationRecorder = {\n    stack: stack,\n    start: function(){\n    \tvar deps = {\n            keyDependencies: new Map(),\n            valueDependencies: new Set(),\n\t\t\t\t\t\tchildDependencies: new Set(),\n\n            // `traps` and `ignore` are here only for performance\n            // reasons. They work with `ObservationRecorder.ignore` and `ObservationRecorder.trap`.\n            traps: null,\n            ignore: 0\n    \t};\n\n        stack.push(deps);\n\n        return deps;\n    },\n    stop: function() {\n    \treturn stack.pop();\n    },\n\n    add: function(obj, event) {\n        var top = stack[stack.length-1];\n    \tif (top && top.ignore === 0) {\n\n    \t\tif(top.traps) {\n    \t\t\ttop.traps.push([obj, event]);\n    \t\t}\n    \t\telse {\n                // Use `=== undefined` instead of `arguments.length` for performance.\n                if(event === undefined) {\n                    top.valueDependencies.add(obj);\n                } else {\n                    var eventSet = top.keyDependencies.get(obj);\n        \t\t\tif(!eventSet) {\n        \t\t\t\teventSet = new Set();\n        \t\t\t\ttop.keyDependencies.set(obj, eventSet);\n        \t\t\t}\n        \t\t\teventSet.add(event);\n                }\n    \t\t}\n    \t}\n    },\n\n    addMany: function(observes){\n        var top = stack[stack.length-1];\n    \tif (top) {\n    \t\tif(top.traps) {\n    \t\t\ttop.traps.push.apply(top.traps, observes);\n    \t\t} else {\n    \t\t\tfor(var i =0, len = observes.length; i < len; i++) {\n                    this.add(observes[i][0],observes[i][1]);\n    \t\t\t}\n    \t\t}\n    \t}\n    },\n\t\tcreated: function(obs){\n\t\t\tvar top = stack[stack.length - 1];\n\t\t\tif(top) {\n\t\t\t\ttop.childDependencies.add(obs);\n\t\t\t\tif(obs[addParentSymbol]) {\n\t\t\t\t\tobs[addParentSymbol](top);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n    ignore: function(fn){\n    \treturn function(){\n    \t\tif (stack.length) {\n    \t\t\tvar top = stack[stack.length-1];\n    \t\t\ttop.ignore++;\n    \t\t\tvar res = fn.apply(this, arguments);\n    \t\t\ttop.ignore--;\n    \t\t\treturn res;\n    \t\t} else {\n    \t\t\treturn fn.apply(this, arguments);\n    \t\t}\n    \t};\n    },\n    isRecording: function(){\n    \tvar len = stack.length;\n    \tvar last = len && stack[len-1];\n    \treturn last && (last.ignore === 0) && last;\n    },\n    // `can-observation` uses this to do diffs more easily.\n    makeDependenciesRecord: function(){\n        return {\n            traps: null,\n            keyDependencies: new Map(),\n            valueDependencies: new Set(),\n\t\t\t\t\t\t//childDependencies: new Set(),\n            ignore: 0\n        };\n    },\n    // The following are legacy methods we should do away with.\n    makeDependenciesRecorder: function(){\n        return ObservationRecorder.makeDependenciesRecord();\n    },\n    // Traps should be replace by calling `.start()` and `.stop()`.\n    // To do this, we'd need a method that accepts a dependency record.\n    trap: function(){\n    \tif (stack.length) {\n    \t\tvar top = stack[stack.length-1];\n    \t\tvar oldTraps = top.traps;\n    \t\tvar traps = top.traps = [];\n    \t\treturn function(){\n    \t\t\ttop.traps = oldTraps;\n    \t\t\treturn traps;\n    \t\t};\n    \t} else {\n    \t\treturn function(){return [];};\n    \t}\n    },\n    trapsCount: function(){\n    \tif (stack.length) {\n    \t\tvar top = stack[stack.length-1];\n    \t\treturn top.traps.length;\n    \t} else {\n    \t\treturn 0;\n    \t}\n    }\n};\n\nif (namespace.ObservationRecorder) {\n\tthrow new Error(\"You can't have two versions of can-observation-recorder, check your dependencies\");\n} else {\n\tmodule.exports = namespace.ObservationRecorder = ObservationRecorder;\n}\n"],"names":["stack","addParentSymbol","canSymbol","for","ObservationRecorder","start","deps","keyDependencies","Map","valueDependencies","Set","childDependencies","traps","ignore","push","stop","pop","add","obj","event","top","length","undefined","eventSet","get","set","addMany","observes","apply","i","len","this","created","obs","fn","res","arguments","isRecording","last","makeDependenciesRecord","makeDependenciesRecorder","trap","oldTraps","trapsCount","namespace","Error","module"],"mappings":"+SAQA,IAAIA,EAAQ,GAERC,EAAkBC,UAAUC,IAAI,iBAEhCC,EAAsB,CACtBJ,MAAOA,EACPK,MAAO,WACN,IAAIC,EAAO,CACJC,gBAAiB,IAAIC,IACrBC,kBAAmB,IAAIC,IAC7BC,kBAAmB,IAAID,IAIjBE,MAAO,KACPC,OAAQ,GAKZ,OAFAb,EAAMc,KAAKR,GAEJA,GAEXS,KAAM,WACL,OAAOf,EAAMgB,OAGdC,IAAK,SAASC,EAAKC,GACf,IAAIC,EAAMpB,EAAMA,EAAMqB,OAAO,GAChC,GAAID,GAAsB,IAAfA,EAAIP,OAEd,GAAGO,EAAIR,MACNQ,EAAIR,MAAME,KAAK,CAACI,EAAKC,SAIZ,QAAaG,IAAVH,EACCC,EAAIX,kBAAkBQ,IAAIC,OACvB,CACH,IAAIK,EAAWH,EAAIb,gBAAgBiB,IAAIN,GAC5CK,IACHA,EAAW,IAAIb,IACfU,EAAIb,gBAAgBkB,IAAIP,EAAKK,IAE9BA,EAASN,IAAIE,KAMpBO,QAAS,SAASC,GACd,IAAIP,EAAMpB,EAAMA,EAAMqB,OAAO,GAChC,GAAID,EACH,GAAGA,EAAIR,MACNQ,EAAIR,MAAME,KAAKc,MAAMR,EAAIR,MAAOe,QAEhC,IAAI,IAAIE,EAAG,EAAGC,EAAMH,EAASN,OAAQQ,EAAIC,EAAKD,IACjCE,KAAKd,IAAIU,EAASE,GAAG,GAAGF,EAASE,GAAG,KAKtDG,QAAS,SAASC,GACjB,IAAIb,EAAMpB,EAAMA,EAAMqB,OAAS,GAC5BD,IACFA,EAAIT,kBAAkBM,IAAIgB,GACvBA,EAAIhC,IACNgC,EAAIhC,GAAiBmB,KAItBP,OAAQ,SAASqB,GAChB,OAAO,WACN,GAAIlC,EAAMqB,OAAQ,CACjB,IAAID,EAAMpB,EAAMA,EAAMqB,OAAO,GAC7BD,EAAIP,SACJ,IAAIsB,EAAMD,EAAGN,MAAMG,KAAMK,WAEzB,OADAhB,EAAIP,SACGsB,EAEP,OAAOD,EAAGN,MAAMG,KAAMK,aAIzBC,YAAa,WACZ,IAAIP,EAAM9B,EAAMqB,OACZiB,EAAOR,GAAO9B,EAAM8B,EAAI,GAC5B,OAAOQ,GAAyB,IAAhBA,EAAKzB,QAAiByB,GAGvCC,uBAAwB,WACpB,MAAO,CACH3B,MAAO,KACPL,gBAAiB,IAAIC,IACrBC,kBAAmB,IAAIC,IAEvBG,OAAQ,IAIhB2B,yBAA0B,WACtB,OAAOpC,EAAoBmC,0BAI/BE,KAAM,WACL,GAAIzC,EAAMqB,OAAQ,CACjB,IAAID,EAAMpB,EAAMA,EAAMqB,OAAO,GACzBqB,EAAWtB,EAAIR,MACfA,EAAQQ,EAAIR,MAAQ,GACxB,OAAO,WAEN,OADAQ,EAAIR,MAAQ8B,EACL9B,GAGR,OAAO,WAAW,MAAO,KAG3B+B,WAAY,WACX,OAAI3C,EAAMqB,OACCrB,EAAMA,EAAMqB,OAAO,GAClBT,MAAMS,OAEV,IAKb,GAAIuB,UAAUxC,oBACb,MAAM,IAAIyC,MAAM,oFAEhBC,UAAiBF,UAAUxC,oBAAsBA"}