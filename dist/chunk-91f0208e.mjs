import{a as process$1}from"./chunk-bacf0c54.mjs";import"./chunk-5f1245ff.mjs";import{a as canSymbol}from"./chunk-b37d91a1.mjs";import"./chunk-805ffcb4.mjs";import"./chunk-862b179d.mjs";import"./chunk-bd824939.mjs";import{a as dev}from"./chunk-585d4076.mjs";import"./chunk-0c313990.mjs";import{a as canReflect}from"./chunk-7e0220de.mjs";import{a as namespace}from"./chunk-3b4c7b38.mjs";import{a as queues}from"./chunk-12ed728f.mjs";import{a as assign}from"./chunk-75bea8d8.mjs";import{a as canReflectDeps}from"./chunk-0cc812f8.mjs";if("production"!==process$1.env.NODE_ENV)var canLog=dev,canReflectDeps$1=canReflectDeps;var getChangesSymbol=canSymbol.for("can.getChangesDependencyRecord"),getValueSymbol=canSymbol.for("can.getValue"),onValueSymbol=canSymbol.for("can.onValue"),setValueSymbol=canSymbol.for("can.setValue");function defaultSetValue(e,t){canReflect.setValue(t,e)}function turnOffListeningAndUpdate(e,t,a,n){e[onValueSymbol]&&(canReflect.offValue(e,a,n),"production"!==process$1.env.NODE_ENV&&(canReflectDeps$1.deleteMutatedBy(t,e),a[getChangesSymbol]=function(){}))}function turnOnListeningAndUpdate(e,t,a,n){e[onValueSymbol]&&(canReflect.onValue(e,a,n),"production"!==process$1.env.NODE_ENV&&(canReflectDeps$1.addMutatedBy(t,e),a[getChangesSymbol]=function(){var e=new Set;return e.add(t),{valueDependencies:e}}))}function Semaphore(){this.value=0}function Bind(e){if(this._options=e,"production"!==process$1.env.NODE_ENV){if(void 0===e.child)throw new TypeError("You must supply a child");if(void 0===e.parent)throw new TypeError("You must supply a parent");if(e.queue&&-1===["notify","derive","domUI"].indexOf(e.queue))throw new RangeError("Invalid queue; must be one of notify, derive, or domUI")}void 0===e.queue&&(e.queue="domUI"),e.cycles>0==!1&&(e.cycles=0),e.onInitDoNotUpdateChild="boolean"==typeof e.onInitDoNotUpdateChild&&e.onInitDoNotUpdateChild,e.onInitSetUndefinedParentIfChildIsDefined="boolean"!=typeof e.onInitSetUndefinedParentIfChildIsDefined||e.onInitSetUndefinedParentIfChildIsDefined;var t=new Semaphore,a=new Semaphore,n=!0;"boolean"==typeof e.childToParent?n=e.childToParent:null==e.child[getValueSymbol]?n=!1:void 0===e.setParent&&null==e.parent[setValueSymbol]&&(n=!1);var i=!0;if("boolean"==typeof e.parentToChild?i=e.parentToChild:null==e.parent[getValueSymbol]?i=!1:void 0===e.setChild&&null==e.child[setValueSymbol]&&(i=!1),!1===n&&!1===i)throw new Error("Neither the child nor parent will be updated; this is a no-way binding");this._childToParent=n,this._parentToChild=i,void 0===e.setChild&&(e.setChild=defaultSetValue),void 0===e.setParent&&(e.setParent=defaultSetValue),void 0!==e.priority&&(canReflect.setPriority(e.child,e.priority),canReflect.setPriority(e.parent,e.priority));var r=2*e.cycles,o=r+("childSticksToParent"===e.sticky?1:0),d=r+("parentSticksToChild"===e.sticky?1:0),l=this._bindingState={child:!1,parent:!1};this._updateChild=function(n){updateValue({bindingState:l,newValue:n,debugObservableName:"child",debugPartnerName:"parent",observable:e.child,setValue:e.setChild,semaphore:t,allowedUpdates:o,sticky:"parentSticksToChild"===e.sticky,partner:e.parent,setPartner:e.setParent,partnerSemaphore:a})},this._updateParent=function(n){updateValue({bindingState:l,newValue:n,debugObservableName:"parent",debugPartnerName:"child",observable:e.parent,setValue:e.setParent,semaphore:a,allowedUpdates:d,sticky:"childSticksToParent"===e.sticky,partner:e.child,setPartner:e.setChild,partnerSemaphore:t})},"production"!==process$1.env.NODE_ENV&&(e.updateChildName&&Object.defineProperty(this._updateChild,"name",{value:e.updateChildName}),e.updateParentName&&Object.defineProperty(this._updateParent,"name",{value:e.updateParentName}))}function updateValue(e){var t=e.bindingState;if(!1!==t.child||!1!==t.parent){var a=e.semaphore;if(a.value+e.partnerSemaphore.value<=e.allowedUpdates){if(queues.batch.start(),e.setValue(e.newValue,e.observable),a.increment(),queues.mutateQueue.enqueue(a.decrement,a,[]),queues.batch.stop(),e.sticky){var n=canReflect.getValue(e.observable);n!==canReflect.getValue(e.partner)&&e.setPartner(n,e.partner)}}else if("production"!==process$1.env.NODE_ENV){var i=canReflect.getValue(e.observable);if(i!==e.newValue){var r=["can-bind updateValue: attempting to update "+e.debugObservableName+" "+canReflect.getName(e.observable)+" to new value: %o","…but the "+e.debugObservableName+" semaphore is at "+a.value+" and the "+e.debugPartnerName+" semaphore is at "+e.partnerSemaphore.value+". The number of allowed updates is "+e.allowedUpdates+".","The "+e.debugObservableName+" value will remain unchanged; it’s currently: %o"];canLog.warn(r.join("\n"),e.newValue,i)}}}}assign(Semaphore.prototype,{decrement:function(){this.value-=1},increment:function(){this.value+=1}}),Object.defineProperty(Bind.prototype,"parentValue",{get:function(){return canReflect.getValue(this._options.parent)}}),assign(Bind.prototype,{start:function(){var e,t,a=this._options;this.startParent(),this.startChild(),!0===this._childToParent&&!0===this._parentToChild?void 0===(t=canReflect.getValue(a.parent))?void 0===(e=canReflect.getValue(a.child))?!1===a.onInitDoNotUpdateChild&&this._updateChild(t):!0===a.onInitSetUndefinedParentIfChildIsDefined&&this._updateParent(e):!1===a.onInitDoNotUpdateChild&&this._updateChild(t):!0===this._childToParent?(e=canReflect.getValue(a.child),this._updateParent(e)):!0===this._parentToChild&&!1===a.onInitDoNotUpdateChild&&(t=canReflect.getValue(a.parent),this._updateChild(t))},startChild:function(){if(!1===this._bindingState.child&&!0===this._childToParent){var e=this._options;this._bindingState.child=!0,turnOnListeningAndUpdate(e.child,e.parent,this._updateParent,e.queue)}},startParent:function(){if(!1===this._bindingState.parent&&!0===this._parentToChild){var e=this._options;this._bindingState.parent=!0,turnOnListeningAndUpdate(e.parent,e.child,this._updateChild,e.queue)}},stop:function(){var e=this._bindingState,t=this._options;!0===e.parent&&!0===this._parentToChild&&(e.parent=!1,turnOffListeningAndUpdate(t.parent,t.child,this._updateChild,t.queue)),!0===e.child&&!0===this._childToParent&&(e.child=!1,turnOffListeningAndUpdate(t.child,t.parent,this._updateParent,t.queue))}});var canBind=namespace.Bind=Bind;export{canBind as a,canBind as b};
//# sourceMappingURL=chunk-91f0208e.js.map
