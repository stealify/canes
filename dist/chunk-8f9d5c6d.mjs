import{a as process$1}from"./chunk-bacf0c54.mjs";import"./chunk-660b4975.mjs";import"./chunk-7dfeb1df.mjs";import"./chunk-862b179d.mjs";import{a as SettableObservable}from"./chunk-576d20b1.mjs";import"./chunk-5f1245ff.mjs";import"./chunk-fa6b878a.mjs";import"./chunk-79943599.mjs";import{a as SimpleObservable}from"./chunk-65b62c71.mjs";import{a as Observation}from"./chunk-c1d5d21e.mjs";import{a as queues}from"./chunk-12ed728f.mjs";import{a as canReflect}from"./chunk-7e0220de.mjs";import{a as ObservationRecorder}from"./chunk-8811d387.mjs";import{a as valueEventBindings}from"./chunk-825526fa.mjs";import{a as canSymbol}from"./chunk-b37d91a1.mjs";import"./chunk-f8a6947c.mjs";import{a as mapEventBindings}from"./chunk-910f3205.mjs";function AsyncObservable(e,t,s){function n(){this.resolveCalled=!1,this.inGetter=!0;var s=e.call(t,this.lastSetValue.get(),!0===this.bound?this.resolve:void 0);if(this.inGetter=!1,void 0!==s?this.resolve(s):this.resolveCalled&&this.resolve(this._value),!0!==this.bound)return s}this.resolve=this.resolve.bind(this),this.lastSetValue=new SimpleObservable(s),this.handler=this.handler.bind(this),"production"!==process$1.env.NODE_ENV&&(canReflect.assignSymbols(this,{"can.getName":function(){return canReflect.getName(this.constructor)+"<"+canReflect.getName(e)+">"}}),Object.defineProperty(this.handler,"name",{value:canReflect.getName(this)+".handler"}),Object.defineProperty(n,"name",{value:canReflect.getName(e)+"::"+canReflect.getName(this.constructor)})),this.observation=new Observation(n,this)}AsyncObservable.prototype=Object.create(SettableObservable.prototype),AsyncObservable.prototype.constructor=AsyncObservable,AsyncObservable.prototype.handler=function(e){void 0!==e&&SettableObservable.prototype.handler.apply(this,arguments)};var peek=ObservationRecorder.ignore(canReflect.getValue.bind(canReflect));AsyncObservable.prototype.activate=function(){canReflect.onValue(this.observation,this.handler,"notify"),this.resolveCalled||(this._value=peek(this.observation))},AsyncObservable.prototype.resolve=function(e){this.resolveCalled=!0;var t=this._value;if(this._value=e,"production"!==process$1.env.NODE_ENV&&"function"==typeof this._log&&this._log(t,e),!this.inGetter){var s=[this.handlers.getNode([]),this,[e,t],null];"production"!==process$1.env.NODE_ENV&&(s=[this.handlers.getNode([]),this,[e,t],null,[canReflect.getName(this),"resolved with",e]]),queues.enqueueByQueue.apply(queues,s)}};var async=AsyncObservable,getChangesSymbol=canSymbol.for("can.getChangesDependencyRecord");function ResolverObservable(e,t,s){this.resolver=ObservationRecorder.ignore(e),this.context=t,this._valueOptions={resolve:this.resolve.bind(this),listenTo:this.listenTo.bind(this),stopListening:this.stopListening.bind(this),lastSet:new SimpleObservable(s)},this.update=this.update.bind(this),this.contextHandlers=new WeakMap,this.teardown=null,this.binder={},"production"!==process$1.env.NODE_ENV&&(canReflect.assignSymbols(this,{"can.getName":function(){return canReflect.getName(this.constructor)+"<"+canReflect.getName(e)+">"}}),Object.defineProperty(this.update,"name",{value:canReflect.getName(this)+".update"}),canReflect.assignSymbols(this._valueOptions.lastSet,{"can.getName":function(){return canReflect.getName(this.constructor)+"::lastSet<"+canReflect.getName(e)+">"}}))}function deleteHandler(e,t,s,n){mapEventBindings.off.call(e,t,n,s)}ResolverObservable.prototype=Object.create(SettableObservable.prototype),canReflect.assignMap(ResolverObservable.prototype,{constructor:ResolverObservable,listenTo:function(e,t,s,n){canReflect.isPrimitive(e)&&(s=t,t=e,e=this.context),"function"==typeof t&&(s=t,t=void 0);var i=this;"production"!==process$1.env.NODE_ENV&&(s.name||Object.defineProperty(s,"name",{value:(e?canReflect.getName(e):"")+(t?".on('"+t+"',handler)":".on(handler)")+"::"+canReflect.getName(this)}));var a=s.bind(this.context);a[getChangesSymbol]=function(){var e=new Set;return e.add(i),{valueDependencies:e}},this.contextHandlers.set(s,a),mapEventBindings.listenTo.call(this.binder,e,t,a,n||"notify")},stopListening:function(){var e=this.binder[canSymbol.for("can.meta")],t=e&&e.listenHandlers;if(t){var s=mapEventBindings.stopListeningArgumentsToKeys.call({context:this.context,defaultQueue:"notify"});t.delete(s,deleteHandler)}return this},resolve:function(e){if(this._value=e,this.isBinding)return this.lastValue=this._value,e;if(this._value!==this.lastValue){var t={};"production"!==process$1.env.NODE_ENV&&(t={log:[canReflect.getName(this.update)],reasonLog:[canReflect.getName(this),"resolved with",e]}),queues.batch.start(),queues.deriveQueue.enqueue(this.update,this,[],t),queues.batch.stop()}return e},update:function(){if(this.lastValue!==this._value){var e=this.lastValue;this.lastValue=this._value,"production"!==process$1.env.NODE_ENV&&"function"==typeof this._log&&this._log(e,this._value),queues.enqueueByQueue(this.handlers.getNode([]),this,[this._value,e])}},activate:function(){this.isBinding=!0,this.teardown=this.resolver.call(this.context,this._valueOptions),this.isBinding=!1},onUnbound:function(){this.bound=!1,mapEventBindings.stopListening.call(this.binder),null!=this.teardown&&(this.teardown(),this.teardown=null)},set:function(e){this._valueOptions.lastSet.set(e)},get:function(){if(ObservationRecorder.isRecording()&&(ObservationRecorder.add(this),this.bound||this.onBound()),!0===this.bound)return this._value;var e=function(){};this.on(e);var t=this._value;return this.off(e),t},hasDependencies:function(){var e=!1;if(this.bound){var t=this.binder[canSymbol.for("can.meta")];e=!!(t&&t.listenHandlers).size()}return e},getValueDependencies:function(){if(this.bound){var e=this.binder[canSymbol.for("can.meta")],t=e&&e.listenHandlers,s=new Map,n=new Set;if(t&&(canReflect.each(t.root,function(e,t){canReflect.each(e,function(e,i){if(void 0===i)n.add(t);else{var a=s.get(t);a||(a=new Set,s.set(t,a)),a.add(i)}})}),n.size||s.size)){var i={};return s.size&&(i.keyDependencies=s),n.size&&(i.valueDependencies=n),i}}}}),canReflect.assignSymbols(ResolverObservable.prototype,{"can.getValue":ResolverObservable.prototype.get,"can.setValue":ResolverObservable.prototype.set,"can.isMapLike":!1,"can.getPriority":function(){return this.priority||0},"can.setPriority":function(e){this.priority=e},"can.valueHasDependencies":ResolverObservable.prototype.hasDependencies,"can.getValueDependencies":ResolverObservable.prototype.getValueDependencies});var resolver=ResolverObservable;export{async as a,resolver as b};
//# sourceMappingURL=chunk-8f9d5c6d.js.map
