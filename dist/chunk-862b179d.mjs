import{a as process$1}from"./chunk-bacf0c54.mjs";import{a as dev}from"./chunk-585d4076.mjs";import"./chunk-bd824939.mjs";import{a as assign}from"./chunk-75bea8d8.mjs";import{a as commonjsGlobal,b as commonjsRequire,c as unwrapExports,d as createCommonjsModule}from"./chunk-eae5b219.mjs";import"./chunk-805ffcb4.mjs";import{a as namespace}from"./chunk-3b4c7b38.mjs";var queueState={lastTask:null};function noOperation(){}var Queue=function(t,e){this.callbacks=assign({onFirstTask:noOperation,onComplete:function(){queueState.lastTask=null}},e||{}),this.name=t,this.index=0,this.tasks=[],this._log=!1};Queue.prototype.constructor=Queue,Queue.noop=noOperation,Queue.prototype.enqueue=function(t,e,s,o){var n=this.tasks.push({fn:t,context:e,args:s,meta:o||{}});"production"!==process$1.env.NODE_ENV&&this._logEnqueue(this.tasks[n-1]),1===n&&this.callbacks.onFirstTask(this)},Queue.prototype.flush=function(){for(;this.index<this.tasks.length;){var t=this.tasks[this.index++];"production"!==process$1.env.NODE_ENV&&this._logFlush(t),t.fn.apply(t.context,t.args)}this.index=0,this.tasks=[],this.callbacks.onComplete(this)},Queue.prototype.log=function(){this._log=!arguments.length||arguments[0]},"production"!==process$1.env.NODE_ENV&&(Queue.prototype._logEnqueue=function(t){if(t.meta.parentTask=queueState.lastTask,t.meta.stack=this,!0===this._log||"enqueue"===this._log){var e=t.meta.log?t.meta.log.concat(t):[t.fn.name,t];dev.log.apply(dev,[this.name+" enqueuing:"].concat(e))}},Queue.prototype._logFlush=function(t){if(!0===this._log||"flush"===this._log){var e=t.meta.log?t.meta.log.concat(t):[t.fn.name,t];dev.log.apply(dev,[this.name+" running  :"].concat(e))}queueState.lastTask=t});var queue=Queue,PriorityQueue=function(){queue.apply(this,arguments),this.taskMap=new Map,this.taskContainersByPriority=[],this.curPriorityIndex=1/0,this.curPriorityMax=0,this.isFlushing=!1,this.tasksRemaining=0};PriorityQueue.prototype=Object.create(queue.prototype),PriorityQueue.prototype.constructor=PriorityQueue,PriorityQueue.prototype.enqueue=function(t,e,s,o){if(!this.taskMap.has(t)){this.tasksRemaining++;var n=0===this.taskContainersByPriority.length,i={fn:t,context:e,args:s,meta:o||{}};this.getTaskContainerAndUpdateRange(i).tasks.push(i),this.taskMap.set(t,i),"production"!==process$1.env.NODE_ENV&&this._logEnqueue(i),n&&this.callbacks.onFirstTask(this)}},PriorityQueue.prototype.getTaskContainerAndUpdateRange=function(t){var e=t.meta.priority||0;e<this.curPriorityIndex&&(this.curPriorityIndex=e),e>this.curPriorityMax&&(this.curPriorityMax=e);var s=this.taskContainersByPriority,o=s[e];return o||(o=s[e]={tasks:[],index:0}),o},PriorityQueue.prototype.flush=function(){if(!this.isFlushing)for(this.isFlushing=!0;;){if(!(this.curPriorityIndex<=this.curPriorityMax))return this.taskMap=new Map,this.curPriorityIndex=1/0,this.curPriorityMax=0,this.taskContainersByPriority=[],this.isFlushing=!1,void this.callbacks.onComplete(this);var t=this.taskContainersByPriority[this.curPriorityIndex];if(t&&t.tasks.length>t.index){var e=t.tasks[t.index++];"production"!==process$1.env.NODE_ENV&&this._logFlush(e),this.tasksRemaining--,this.taskMap.delete(e.fn),e.fn.apply(e.context,e.args)}else this.curPriorityIndex++}},PriorityQueue.prototype.isEnqueued=function(t){return this.taskMap.has(t)},PriorityQueue.prototype.flushQueuedTask=function(t){var e=this.dequeue(t);e&&("production"!==process$1.env.NODE_ENV&&this._logFlush(e),e.fn.apply(e.context,e.args))},PriorityQueue.prototype.dequeue=function(t){var e=this.taskMap.get(t);if(e){var s=e.meta.priority||0,o=this.taskContainersByPriority[s],n=o.tasks.indexOf(e,o.index);if(n>=0)return o.tasks.splice(n,1),this.tasksRemaining--,this.taskMap.delete(e.fn),e;console.warn("Task",t,"has already run")}},PriorityQueue.prototype.tasksRemainingCount=function(){return this.tasksRemaining};var priorityQueue=PriorityQueue,CompletionQueue=function(){queue.apply(this,arguments),this.flushCount=0};CompletionQueue.prototype=Object.create(queue.prototype),CompletionQueue.prototype.constructor=CompletionQueue,CompletionQueue.prototype.flush=function(){if(0===this.flushCount){for(this.flushCount++;this.index<this.tasks.length;){var t=this.tasks[this.index++];"production"!==process$1.env.NODE_ENV&&this._logFlush(t),t.fn.apply(t.context,t.args)}this.index=0,this.tasks=[],this.flushCount--,this.callbacks.onComplete(this)}};var completionQueue=CompletionQueue,canQueues=createCommonjsModule(function(t){var e,s,o,n,i,u=0,a=!1,r=0,c=["notify","derive","domUI","mutate"];s=new queue("NOTIFY",{onComplete:function(){o.flush()},onFirstTask:function(){u?a=!0:s.flush()}}),o=new priorityQueue("DERIVE",{onComplete:function(){n.flush()},onFirstTask:function(){a=!0}}),n=new completionQueue("DOM_UI",{onComplete:function(){i.flush()},onFirstTask:function(){a=!0}}),i=new queue("MUTATE",{onComplete:function(){queueState.lastTask=null},onFirstTask:function(){a=!0}});var p={Queue:queue,PriorityQueue:priorityQueue,CompletionQueue:completionQueue,notifyQueue:s,deriveQueue:o,domUIQueue:n,mutateQueue:i,batch:{start:function(){1===++u&&(e={number:++r})},stop:function(){0===--u&&a&&(a=!1,s.flush())},isCollecting:function(){return u>0},number:function(){return r},data:function(){return e}},enqueueByQueue:function(t,e,s,o,n){t&&(p.batch.start(),c.forEach(function(i){var u=p[i+"Queue"],a=t[i];void 0!==a&&a.forEach(function(t){var i=null!=o?o(t,e,s):{};i.reasonLog=n,u.enqueue(t,e,s,i)})}),p.batch.stop())},stack:function(){for(var t=queueState.lastTask,e=[];t;)e.unshift(t),t=t.meta.parentTask;return e},logStack:function(){this.stack().forEach(function(t,e){var s=t.meta;0===e&&s&&s.reasonLog&&dev.log.apply(dev,s.reasonLog);var o=s&&s.log?s.log:[t.fn.name,t];dev.log.apply(dev,[t.meta.stack.name+" ran task:"].concat(o))})},taskCount:function(){return s.tasks.length+o.tasks.length+n.tasks.length+i.tasks.length},flush:function(){s.flush()},log:function(){s.log.apply(s,arguments),o.log.apply(o,arguments),n.log.apply(n,arguments),i.log.apply(i,arguments)}};if(namespace.queues)throw new Error("You can't have two versions of can-queues, check your dependencies");t.exports=namespace.queues=p});export{canQueues as a,canQueues as b};
//# sourceMappingURL=chunk-862b179d.js.map
