import{a as canViewParser}from"./chunk-40f0cd8c.mjs";import{a as process$1}from"./chunk-bacf0c54.mjs";import{a as domMutate}from"./chunk-e442e0a9.mjs";import"./chunk-152c0627.mjs";import{a as childNodes}from"./chunk-ee0ed326.mjs";import"./chunk-f06d7b20.mjs";import"./chunk-5f1245ff.mjs";import"./chunk-0c313990.mjs";import{a as nodeLists,b as frag}from"./chunk-fd5b3ff3.mjs";import{a as canReflect}from"./chunk-7e0220de.mjs";import{a as canReflectDeps}from"./chunk-0cc812f8.mjs";import"./chunk-862b179d.mjs";import{c as attr,a as viewCallbacks}from"./chunk-c1a50ad2.mjs";import{a as queues}from"./chunk-12ed728f.mjs";import{a as domMutateNode}from"./chunk-d056b3d5.mjs";import{a as canSymbol}from"./chunk-b37d91a1.mjs";import"./chunk-660b4975.mjs";import{a as SimpleObservable}from"./chunk-65b62c71.mjs";import{a as Patcher}from"./chunk-bb7c303b.mjs";function contains(e,t){return e.contains?e.contains(t):e.nodeType===Node.DOCUMENT_NODE&&e.documentElement?contains(e.documentElement,t):(t=t.parentNode)===e}var live={setup:function(e,t,n){var s,o,r=!1,a=function(){return r||(r=!0,n(o),s&&(s(),s=void 0)),!0};return o={teardownCheck:function(e){return!e&&a()}},s=domMutate.onNodeRemoval(e,function(){contains(e.ownerDocument,e)||a()}),t(o),o},listen:function(e,t,n,s){return live.setup(e,function(){canReflect.onValue(t,n,s||"notify"),"production"!==process$1.env.NODE_ENV&&canReflectDeps.addMutatedBy(e,t)},function(o){canReflect.offValue(t,n,s||"notify"),"production"!==process$1.env.NODE_ENV&&canReflectDeps.deleteMutatedBy(e,t),o.nodeList&&nodeLists.unregister(o.nodeList)})},getAttributeParts:function(e){var t,n={};return canViewParser.parseAttrs(e,{attrStart:function(e){n[e]="",t=e},attrValue:function(e){n[t]+=e},attrEnd:function(){}}),n},isNode:function(e){return e&&e.nodeType},addTextNodeIfNoChildren:function(e){e.firstChild||e.appendChild(e.ownerDocument.createTextNode(""))},replace:function(e,t,n){var s=e.slice(0),o=frag(t);return nodeLists.register(e,n),nodeLists.update(e,childNodes(o)),nodeLists.replace(s,o),e},getParentNode:function(e,t){return t&&11===e.parentNode.nodeType?t:e.parentNode},makeString:function(e){return null==e?"":""+e}},core=live;core.attr=function(e,t,n){function s(n){queues.domUIQueue.enqueue(attr.set,attr,[e,t,n])}"production"!==process$1.env.NODE_ENV&&(canReflect.assignSymbols(s,{"can.getChangesDependencyRecord":function(){var t=new Set;return t.add(e),{valueDependencies:t}}}),Object.defineProperty(s,"name",{value:"live.attr update::"+canReflect.getName(n)})),core.listen(e,n,s),attr.set(e,t,canReflect.getValue(n))},core.attrs=function(e,t,n,s){if(canReflect.isObservableLike(t)){var o,r={};"production"!==process$1.env.NODE_ENV&&(canReflect.assignSymbols(c,{"can.getChangesDependencyRecord":function(){var t=new Set;return t.add(e),{valueDependencies:t}}}),Object.defineProperty(c,"name",{value:"live.attrs update::"+canReflect.getName(t)}),canReflectDeps.addMutatedBy(e,t)),canReflect.onValue(t,c,"domUI");o=domMutate.onNodeRemoval(e,function(){var n=e.ownerDocument;(n.contains?n:n.documentElement).contains(e)||(canReflect.offValue(t,c,"domUI"),o&&(o(),o=void 0),"production"!==process$1.env.NODE_ENV&&canReflectDeps.deleteMutatedBy(e,t))}),c(canReflect.getValue(t))}else{var a=core.getAttributeParts(t);for(var i in a)domMutateNode.setAttribute.call(e,i,a[i])}function c(t){var o,a=core.getAttributeParts(t);for(o in a){var i=a[o];if(i!==r[o]){domMutateNode.setAttribute.call(e,o,i);var c=viewCallbacks.attr(o);c&&c(e,{attributeName:o,scope:n,options:s})}delete r[o]}for(o in r)domMutateNode.removeAttribute.call(e,o);r=a}};var viewInsertSymbol=canSymbol.for("can.viewInsert");function updateNodeList(e,t,n){if(!0!==e.nodeList.isUnregistered){var s=canReflect.toArray(childNodes(t));n||nodeLists.update(e.nodeList,s,e.oldNodes);var o=e.oldNodes;e.oldNodes=s,nodeLists.replace(o,t)}}function SetObservable(e,t){this.setter=t,SimpleObservable.call(this,e)}core.html=function(e,t,n,s){var o,r,a,i,c;void 0!==s&&(Array.isArray(s)?a=s:(a=s.nodeList,c=s));var d={reasonLog:"live.html replace::"+canReflect.getName(t)};function l(e){nodeLists.first(i).parentNode&&r(e,!0);var t=nodeLists.first(i).parentNode;o.teardownCheck(t)}n=core.getParentNode(e,n),"production"!==process$1.env.NODE_ENV&&(canReflect.assignSymbols(l,{"can.getChangesDependencyRecord":function(){var e=new Set;return e.add(n),{valueDependencies:e}}}),Object.defineProperty(l,"name",{value:"live.html update::"+canReflect.getName(t)})),o=core.listen(n,t,l),i=a||[e],r=function(e,t){e&&"function"==typeof e[viewInsertSymbol]&&(e=e[viewInsertSymbol](c));var n="function"==typeof e,s=frag(n?"":e);if(core.addTextNodeIfNoChildren(s),!0===t){o.oldNodes=nodeLists.unregisterChildren(i,!0);var r=!1;n&&(e(s.firstChild),r=nodeLists.first(i)===s.firstChild),queues.domUIQueue.enqueue(updateNodeList,null,[o,s,r],d)}else o.oldNodes=nodeLists.update(i,childNodes(s)),n&&e(s.firstChild),nodeLists.replace(o.oldNodes,s)},o.nodeList=i,a?a.unregistered=o.teardownCheck:nodeLists.register(i,o.teardownCheck),r(canReflect.getValue(t))},SetObservable.prototype=Object.create(SimpleObservable.prototype),SetObservable.prototype.constructor=SetObservable,SetObservable.prototype.set=function(e){this.setter(e)},canReflect.assignSymbols(SetObservable.prototype,{"can.setValue":SetObservable.prototype.set});var setObservable=SetObservable,splice=[].splice,renderAndAddToNodeLists=function(e,t,n,s,o){var r=[];t&&(nodeLists.register(r,null,!0,!0),r.parentList=t,r.expression="#each SUBEXPRESSION");var a=n.apply(s,o.concat([r])),i=frag(a),c=canReflect.toArray(childNodes(i));return t?(nodeLists.update(r,c),e.push(r)):e.push(nodeLists.register(c)),i},removeFromNodeList=function(e,t,n){var s=e.splice(t+1,n),o=[];return s.forEach(function(e){var t=nodeLists.unregister(e);[].push.apply(o,t)}),o},onPatchesSymbol=canSymbol.for("can.onPatches"),offPatchesSymbol=canSymbol.for("can.offPatches");function ListDOMPatcher(e,t,n,s,o,r,a){this.patcher=new Patcher(t),o=core.getParentNode(e,o),this.value=t,this.render=n,this.context=s,this.parentNode=o,this.falseyRender=a,this.masterNodeList=r||nodeLists.register([e],null,!0),this.placeholder=e,this.indexMap=[],this.isValueLike=canReflect.isValueLike(this.value),this.isObservableLike=canReflect.isObservableLike(this.value),this.onPatches=this.onPatches.bind(this);var i=this.data=core.setup(o,this.setupValueBinding.bind(this),this.teardownValueBinding.bind(this));this.masterNodeList.unregistered=function(){i.teardownCheck()},"production"!==process$1.env.NODE_ENV&&Object.defineProperty(this.onPatches,"name",{value:"live.list update::"+canReflect.getName(t)})}var canViewLive;onPatchesSymbol=canSymbol.for("can.onPatches"),offPatchesSymbol=canSymbol.for("can.offPatches");ListDOMPatcher.prototype={setupValueBinding:function(){this.patcher[onPatchesSymbol](this.onPatches,"domUI"),this.patcher.currentList&&this.patcher.currentList.length?this.onPatches([{insert:this.patcher.currentList,index:0,deleteCount:0}]):this.addFalseyIfEmpty(),"production"!==process$1.env.NODE_ENV&&canReflectDeps.addMutatedBy(this.parentNode,this.patcher.observableOrList)},teardownValueBinding:function(){this.patcher[offPatchesSymbol](this.onPatches,"domUI"),this.exit=!0,this.remove({length:this.patcher.currentList.length},0,!0),"production"!==process$1.env.NODE_ENV&&canReflectDeps.deleteMutatedBy(this.parentNode,this.patcher.observableOrList)},onPatches:function(e){if(!this.exit)for(var t=0,n=e.length;t<n;t++){var s=e[t];"move"===s.type?this.move(s.toIndex,s.fromIndex):(s.deleteCount&&this.remove({length:s.deleteCount},s.index,!0),s.insert&&s.insert.length&&this.add(s.insert,s.index))}},add:function(e,t){var n=this.placeholder.ownerDocument.createDocumentFragment(),s=[],o=[],r=this.masterNodeList,a=this.render,i=this.context;e.forEach(function(e,c){var d=new SimpleObservable(c+t),l=new setObservable(e,function(e){canReflect.setKeyValue(this.patcher.currentList,d.get(),e)}.bind(this)),u=renderAndAddToNodeLists(s,r,a,i,[l,d]);n.appendChild(u),o.push(d)},this);var c=t+1;if(!this.indexMap.length){var d=removeFromNodeList(r,0,r.length-1);nodeLists.remove(d)}if(r[c]){var l=nodeLists.first(r[c]);domMutateNode.insertBefore.call(l.parentNode,n,l)}else nodeLists.after(1===c?[this.placeholder]:[nodeLists.last(this.masterNodeList[c-1])],n);splice.apply(this.masterNodeList,[c,0].concat(s)),splice.apply(this.indexMap,[t,0].concat(o));for(var u=t+o.length,p=this.indexMap.length;u<p;u++)this.indexMap[u].set(u)},remove:function(e,t){t<0&&(t=this.indexMap.length+t);var n=removeFromNodeList(this.masterNodeList,t,e.length),s=this.indexMap;s.splice(t,e.length);for(var o=t,r=s.length;o<r;o++)s[o].set(o);this.exit?nodeLists.unregister(this.masterNodeList):(this.addFalseyIfEmpty(),nodeLists.remove(n))},addFalseyIfEmpty:function(){if(this.falseyRender&&0===this.indexMap.length){var e=[],t=renderAndAddToNodeLists(e,this.masterNodeList,this.falseyRender,this.currentList,[this.currentList]);nodeLists.after([this.masterNodeList[0]],t),this.masterNodeList.push(e[0])}},move:function(e,t){e+=1,t+=1;var n,s=this.masterNodeList,o=this.indexMap,r=s[e],a=frag(nodeLists.flatten(s[t]));n=t<e?nodeLists.last(r).nextSibling:nodeLists.first(r),s[0].parentNode.insertBefore(a,n);var i=s[t];[].splice.apply(s,[t,1]),[].splice.apply(s,[e,0,i]),e-=1;var c=o[t-=1];[].splice.apply(o,[t,1]),[].splice.apply(o,[e,0,c]);for(var d=Math.min(t,e),l=o.length;d<l;d++)o[d].set(d)},set:function(e,t){this.remove({length:1},t,!0),this.add([e],t)}},core.list=function(e,t,n,s,o,r,a){var i;e.nodeType!==Node.TEXT_NODE&&(r?(i=document.createTextNode(""),nodeLists.replace(r,i),nodeLists.update(r,[i]),e=i):(i=document.createTextNode(""),e.parentNode.replaceChild(i,e),e=i));new ListDOMPatcher(e,t,n,s,o,r,a)},core.text=function(e,t,n,s){var o;e.nodeType!==Node.TEXT_NODE&&(s?(o=document.createTextNode(""),nodeLists.replace(s,o),nodeLists.update(s,[o]),e=o):(o=document.createTextNode(""),e.parentNode.replaceChild(o,e),e=o));var r=core.getParentNode(e,n);function a(t){e.nodeValue=core.makeString(t)}e.nodeValue=core.makeString(canReflect.getValue(t)),"production"!==process$1.env.NODE_ENV&&(canReflect.assignSymbols(a,{"can.getChangesDependencyRecord":function(){var e=new Set;return e.add(r),{valueDependencies:e}}}),Object.defineProperty(a,"name",{value:"live.text update::"+canReflect.getName(t)}));var i=core.listen(r,t,a,"domUI");s||(s=nodeLists.register([e],null,!0)),s.unregistered=i.teardownCheck,i.nodeList=s};export{canViewParser as a,core as b,core as c};
//# sourceMappingURL=chunk-0d409e0a.js.map
