import"./chunk-bef7c5be.mjs";import{a as SimpleMap}from"./chunk-7d5cfef0.mjs";import{a as process$1}from"./chunk-bacf0c54.mjs";import{a as singleReference}from"./chunk-072ec069.mjs";import"./chunk-5f1245ff.mjs";import{a as canReflect}from"./chunk-7e0220de.mjs";import{a as commonjsGlobal,b as commonjsRequire,c as unwrapExports,d as createCommonjsModule}from"./chunk-eae5b219.mjs";import"./chunk-805ffcb4.mjs";import{a as namespace}from"./chunk-3b4c7b38.mjs";import"./chunk-7dfeb1df.mjs";import{a as observeReader}from"./chunk-0877ccb7.mjs";import"./chunk-bd824939.mjs";import{a as canSymbol}from"./chunk-b37d91a1.mjs";import"./chunk-fa6b878a.mjs";import"./chunk-0c313990.mjs";import"./chunk-79943599.mjs";import"./chunk-660b4975.mjs";import{a as Observation}from"./chunk-c1d5d21e.mjs";import{a as assign}from"./chunk-75bea8d8.mjs";import{a as ObservationRecorder}from"./chunk-8811d387.mjs";import{a as canReflectDeps}from"./chunk-0cc812f8.mjs";import{a as valueEventBindings}from"./chunk-825526fa.mjs";import{a as SimpleObservable}from"./chunk-65b62c71.mjs";import{a as dev}from"./chunk-585d4076.mjs";import"./chunk-b1806013.mjs";import{a as defineLazyValue}from"./chunk-d2889630.mjs";var TemplateContext=function(e){e=e||{},this.vars=new SimpleMap(e.vars||{}),this.helpers=new SimpleMap(e.helpers||{}),this.partials=new SimpleMap(e.partials||{}),this.tags=new SimpleMap(e.tags||{})},templateContext=TemplateContext,Compute=function(e){return arguments.length?canReflect.setValue(this,e):canReflect.getValue(this)},makeComputeLike=function(e){var t=Compute.bind(e);return"production"!==process$1.env.NODE_ENV&&Object.defineProperty(t,"name",{value:"Compute<"+canReflect.getName(e)+">"}),t.on=t.bind=t.addEventListener=function(n,a){var o=function(e,n){a.call(t,{type:"change"},e,n)};singleReference.set(a,this,o),e.on(o)},t.off=t.unbind=t.removeEventListener=function(t,n){e.off(singleReference.getAndDelete(n,this))},canReflect.assignSymbols(t,{"can.getValue":function(){return canReflect.getValue(e)},"can.setValue":function(t){return canReflect.setValue(e,t)},"can.onValue":function(t,n){return canReflect.onValue(e,t,n)},"can.offValue":function(t,n){return canReflect.offValue(e,t,n)},"can.valueHasDependencies":function(){return canReflect.valueHasDependencies(e)},"can.getPriority":function(){return canReflect.getPriority(e)},"can.setPriority":function(t){canReflect.setPriority(e,t)},"can.isValueLike":!0,"can.isFunctionLike":!1}),t.isComputed=!0,t},canStacheHelpers=createCommonjsModule(function(e){if(namespace.stacheHelpers)throw new Error("You can't have two versions of can-stache-helpers, check your dependencies");e.exports=namespace.stacheHelpers={}}),dispatchSymbol=canSymbol.for("can.dispatch"),peekValue=ObservationRecorder.ignore(canReflect.getValue.bind(canReflect)),getFastPathRoot=ObservationRecorder.ignore(function(e){if(e.reads&&1===e.reads.length){var t=e.root;return t&&t[canSymbol.for("can.getValue")]&&(t=canReflect.getValue(t)),t&&canReflect.isObservableLike(t)&&canReflect.isMapLike(t)&&"function"!=typeof t[e.reads[0].key]&&t}}),isEventObject=function(e){return e&&"number"==typeof e.batchNum&&"string"==typeof e.type};function callMutateWithRightArgs(e,t,n,a){n.length?e.call(canReflectDeps,t,n[n.length-1].key,a):e.call(canReflectDeps,t,a)}var ScopeKeyData=function(e,t,n){this.startingScope=e,this.key=t,this.read=this.read.bind(this),this.dispatch=this.dispatch.bind(this),"debugger"===t&&(this.startingScope={_context:canStacheHelpers},this.read=function(){var t={scope:e};return(0,canStacheHelpers.debugger)(t)}),"production"!==process$1.env.NODE_ENV&&(Object.defineProperty(this.read,"name",{value:canReflect.getName(this)+".read"}),Object.defineProperty(this.dispatch,"name",{value:canReflect.getName(this)+".dispatch"}));var a=this.observation=new Observation(this.read,this);this.options=assign({observation:this.observation},n),this.fastPath=void 0,this.root=void 0,this.initialValue=void 0,this.reads=void 0,this.setRoot=void 0,this._thisArg=new SimpleObservable,this.parentHasKey=void 0;var o=new Set;o.add(a),this.dependencies={valueDependencies:o}};function fastOnBoundSet_Value(){this._value=this.newVal}function fastOnBoundSetValue(){this.value=this.newVal}valueEventBindings(ScopeKeyData.prototype),assign(ScopeKeyData.prototype,{constructor:ScopeKeyData,dispatch:function(e){var t=this.value;this.value=e,this[dispatchSymbol].call(this,this.value,t)},onBound:function(){this.bound=!0,canReflect.onValue(this.observation,this.dispatch,"notify");var e=getFastPathRoot(this);e&&this.toFastPath(e),this.value=peekValue(this.observation)},onUnbound:function(){this.bound=!1,canReflect.offValue(this.observation,this.dispatch,"notify"),this.toSlowPath()},set:function(e){var t=this.root||this.setRoot;t?this.reads.length?observeReader.write(t,this.reads,e,this.options):canReflect.setValue(t,e):this.startingScope.set(this.key,e,this.options)},get:function(){return ObservationRecorder.isRecording()&&(ObservationRecorder.add(this),this.bound||Observation.temporarilyBind(this)),!0===this.bound?this.value:this.observation.get()},toFastPath:function(e){var t=this,n=this.observation;this.fastPath=!0,n.dependencyChange=function(n,a){if(isEventObject(a))throw"no event objects!";return n===e&&"function"!=typeof a?this.newVal=a:t.toSlowPath(),Observation.prototype.dependencyChange.apply(this,arguments)},n.hasOwnProperty("_value")?n.onBound=fastOnBoundSet_Value:n.onBound=fastOnBoundSetValue},toSlowPath:function(){this.observation.dependencyChange=Observation.prototype.dependencyChange,this.observation.onBound=Observation.prototype.onBound,this.fastPath=!1},read:function(){var e;if(this.root){if(e=observeReader.read(this.root,this.reads,this.options),"production"!==process$1.env.NODE_ENV&&this.reads.length&&callMutateWithRightArgs(canReflectDeps.deleteMutatedBy,peekValue(this._thisArg)||this.root,this.reads,this),this.thisArg=e.parent,"production"!==process$1.env.NODE_ENV){var t=new Set;t.add(this),callMutateWithRightArgs(canReflectDeps.addMutatedBy,e.parent||this.root,this.reads,{valueDependencies:t})}return e.value}if(e=this.startingScope.read(this.key,this.options),"production"!==process$1.env.NODE_ENV&&e.rootObserve){var n=new Set;n.add(this),callMutateWithRightArgs(canReflectDeps.addMutatedBy,e.thisArg||e.rootObserve,e.reads,{valueDependencies:n})}return this.scope=e.scope,this.reads=e.reads,this.root=e.rootObserve,this.setRoot=e.setRoot,this.thisArg=e.thisArg,this.parentHasKey=e.parentHasKey,this.initialValue=e.value},hasDependencies:function(){return canReflect.valueHasDependencies(this.observation)}}),Object.defineProperty(ScopeKeyData.prototype,"thisArg",{get:function(){return this._thisArg.get()},set:function(e){this._thisArg.set(e)}});var scopeKeyDataPrototype={"can.getValue":ScopeKeyData.prototype.get,"can.setValue":ScopeKeyData.prototype.set,"can.valueHasDependencies":ScopeKeyData.prototype.hasDependencies,"can.getValueDependencies":function(){return this.dependencies},"can.getPriority":function(){return canReflect.getPriority(this.observation)},"can.setPriority":function(e){canReflect.setPriority(this.observation,e)}};"production"!==process$1.env.NODE_ENV&&(scopeKeyDataPrototype["can.getName"]=function(){return canReflect.getName(this.constructor)+"{{"+this.key+"}}"}),canReflect.assignSymbols(ScopeKeyData.prototype,scopeKeyDataPrototype),Object.defineProperty(ScopeKeyData.prototype,"compute",{get:function(){var e=makeComputeLike(this);return Object.defineProperty(this,"compute",{value:e,writable:!1,configurable:!1}),e},configurable:!0});var scopeKeyData=ScopeKeyData,compute_data=function(e,t,n){return new scopeKeyData(e,t,n||{args:[]})};function canHaveProperties(e){return null!=e}function returnFalse(){return!1}var LetContext=SimpleMap.extend("LetContext",{});function Scope(e,t,n){this._context=e,this._parent=t,this._meta=n||{},this.__cache={}}var parentContextSearch=/(\.\.\/)|(\.\/)|(this[\.@])/g;assign(Scope,{read:observeReader.read,TemplateContext:templateContext,keyInfo:function(e){"./"===e&&(e="this");var t={remainingKey:e};if(t.isScope="scope"===e,t.isScope)return t;var n=e.substr(0,6);return t.isInScope="scope."===n||"scope@"===n,t.isInScope?(t.remainingKey=e.substr(6),t):"scope/"===n?(t.walkScope=!0,t.remainingKey=e.substr(6),t):"@scope/"===e.substr(0,7)?(t.walkScope=!0,t.remainingKey=e.substr(7),t):(t.parentContextWalkCount=0,t.remainingKey=e.replace(parentContextSearch,function(e,n,a,o,r){return t.isContextBased=!0,void 0!==n&&t.parentContextWalkCount++,""}),".."===t.remainingKey?(t.parentContextWalkCount++,t.remainingKey="this"):"."!==t.remainingKey&&""!==t.remainingKey||(t.remainingKey="this"),"this"===t.remainingKey&&(t.isContextBased=!0),t)},isTemplateContextOrCanNotHaveProperties:function(e){var t=e._context;return t instanceof templateContext||!canHaveProperties(t)},shouldSkipIfSpecial:function(e){return!0===(!0===e._meta.special)||!!Scope.isTemplateContextOrCanNotHaveProperties(e)},shouldSkipEverythingButSpecial:function(e){return!1===(!0===e._meta.special)||!!Scope.isTemplateContextOrCanNotHaveProperties(e)},makeShouldExitOnSecondNormalContext:function(){var e=!1;return function(t){var n=!t.isSpecial(),a=n&&e;return n&&(e=!0),a}},makeShouldExitAfterFirstNormalContext:function(){var e=!1;return function(t){return!!e||(!t.isSpecial()&&(e=!0),!1)}},makeShouldSkipSpecialContexts:function(e){var t=e||0;return function(e){return!(t<0&&e._meta.notContext)&&(!!e.isSpecial()||!(--t<0))}}}),assign(Scope.prototype,{add:function(e,t){return e!==this._context?new this.constructor(e,this,t):this},find:function(e,t){var n=observeReader.reads(e),a={shouldExit:returnFalse,shouldSkip:Scope.shouldSkipIfSpecial,shouldLookForHelper:!0,read:observeReader.read};return this._walk(n,t,a).value},readFromSpecialContext:function(e){return this._walk([{key:e,at:!1}],{special:!0},{shouldExit:returnFalse,shouldSkip:Scope.shouldSkipEverythingButSpecial,shouldLookForHelper:!1,read:observeReader.read})},readFromTemplateContext:function(e,t){var n=observeReader.reads(e);return observeReader.read(this.templateContext,n,t)},read:function(e,t){return t=t||{},this.readKeyInfo(Scope.keyInfo(e),t||{})},readKeyInfo:function(e,t){var n,a,o={read:t.read||observeReader.read};if(e.isScope)return{value:this};if(e.isInScope)return a=observeReader.reads(e.remainingKey),void 0!==(n=observeReader.read(this,a,t)).value||n.parentHasKey||(n=this.readFromTemplateContext(e.remainingKey,t)),assign(n,{thisArg:a.length>0?n.parent:void 0});if(e.isContextBased)return a="this"!==e.remainingKey?observeReader.reads(e.remainingKey):[],o.shouldExit=Scope.makeShouldExitOnSecondNormalContext(),o.shouldSkip=Scope.makeShouldSkipSpecialContexts(e.parentContextWalkCount),o.shouldLookForHelper=!0,this._walk(a,t,o);if(e.walkScope)return o.shouldExit=returnFalse,o.shouldSkip=Scope.shouldSkipIfSpecial,o.shouldLookForHelper=!0,a=observeReader.reads(e.remainingKey),this._walk(a,t,o);a=observeReader.reads(e.remainingKey);var r=t&&!0===t.special;return o.shouldExit=Scope.makeShouldExitOnSecondNormalContext(),o.shouldSkip=r?Scope.shouldSkipEverythingButSpecial:Scope.shouldSkipIfSpecial,o.shouldLookForHelper=!r,this._walk(a,t,o)},_walk:function(e,t,n){for(var a,o,r,i,s,c=this,p=[],u=-1,l=assign({foundObservable:function(t,n){o=t,r=e.slice(n)},earlyExit:function(t,n){(!0===(!0===c._meta.variable)&&0===n?canReflect.hasKey(t,e[n].key):n>u||n===u&&"object"==typeof t&&canReflect.hasOwnKey(t,e[n].key))&&(s=o,i=r,u=n)}},t),h=ObservationRecorder.isRecording(),d=!1;c;)if(!0!==n.shouldSkip(c)){if(!0===n.shouldExit(c))break;d=!0,a=c._context;var f=ObservationRecorder.trap(),v=n.read(a,e,l),m=f();if(void 0!==v.value||v.parentHasKey)return!m.length&&h?(o=v.parent,r=e.slice(e.length-1)):ObservationRecorder.addMany(m),{scope:c,rootObserve:o,value:v.value,reads:r,thisArg:v.parent,parentHasKey:v.parentHasKey};p.push.apply(p,m),c=c._parent}else c=c._parent;if(n.shouldLookForHelper){var y=this.getHelperOrPartial(e);if(y&&y.value)return{value:y.value}}return ObservationRecorder.addMany(p),{setRoot:s,reads:i,value:void 0,noContextAvailable:!d}},getDataForScopeSet:function(e,t){var n,a,o=Scope.keyInfo(e),r=assign({read:function(e,a){if(void 0!==n||e instanceof LetContext||(n=e),a.length>1){var o=a.slice(0,a.length-1),r=observeReader.read(e,o,t).value;return null!=r&&canReflect.hasKey(r,a[a.length-1].key)?{parent:r,parentHasKey:!0,value:void 0}:{}}return 1===a.length?canReflect.hasKey(e,a[0].key)?{parent:e,parentHasKey:!0,value:void 0}:{}:{value:e}}},t),i=this.readKeyInfo(o,r);if("this"===o.remainingKey)return{parent:i.value,how:"setValue"};var s=o.remainingKey.split(".").pop();return i.thisArg?a=i.thisArg:n&&(a=n),void 0===a?{error:"Attempting to set a value at "+e+" where the context is undefined."}:!canReflect.isObservableLike(a)&&canReflect.isObservableLike(a[s])?canReflect.isMapLike(a[s])?{parent:a,key:s,how:"updateDeep",warn:'can-view-scope: Merging data into "'+s+'" because its parent is non-observable'}:canReflect.isValueLike(a[s])?{parent:a,key:s,how:"setValue"}:{parent:a,how:"write",key:s,passOptions:!0}:{parent:a,how:"write",key:s,passOptions:!0}},getHelper:function(e){return console.warn(".getHelper is deprecated, use .getHelperOrPartial"),this.getHelperOrPartial(e)},getHelperOrPartial:function(e){for(var t,n,a=this;a;){if((t=a._context)instanceof templateContext){if(void 0!==(n=observeReader.read(t.helpers,e,{proxyMethods:!1})).value)return n;if(void 0!==(n=observeReader.read(t.partials,e,{proxyMethods:!1})).value)return n}a=a._parent}return observeReader.read(canStacheHelpers,e,{proxyMethods:!1})},get:function(e,t){return t=assign({isArgument:!0},t),this.read(e,t).value},peek:ObservationRecorder.ignore(function(e,t){return this.get(e,t)}),peak:ObservationRecorder.ignore(function(e,t){return"production"!==process$1.env.NODE_ENV&&dev.warn("peak is deprecated, please use peek instead"),this.peek(e,t)}),getScope:function(e){for(var t=this;t;){if(e(t))return t;t=t._parent}},getContext:function(e){var t=this.getScope(e);return t&&t._context},getTemplateContext:function(){var e,t=this.getScope(function(t){return e=t,t._context instanceof templateContext});return t||(t=new Scope(new templateContext),e._parent=t),t},addTemplateContext:function(){return this.add(new templateContext)},addLetContext:function(e){return this.add(new LetContext(e||{}),{variable:!0})},getRoot:function(){for(var e=this,t=this;e._parent;)t=e,e=e._parent;return e._context instanceof templateContext&&(e=t),e._context},getViewModel:function(){var e=this.getScope(function(e){return e._meta.viewModel});return e&&e._context},getTop:function(){var e;return this.getScope(function(t){return t._meta.viewModel&&(e=t),!1}),e&&e._context},getPathsForKey:function(e){if("production"!==process$1.env.NODE_ENV){var t={},n=function(e,t){if(!e||"object"!=typeof e)return{};var n=t in e,a=canReflect.hasKey(e,t);return{isDefined:n||a,isFunction:n&&"function"==typeof e[t]}},a=observeReader.reads(e).map(function(e){return e.key}),o=a.indexOf("scope");o>-1&&a.splice(o,2);var r=a.join("."),i=this.getViewModel(),s=n(i,r);s.isDefined&&(t["scope.vm."+r+(s.isFunction?"()":"")]=i);var c=this.getTop(),p=n(c,r);p.isDefined&&(t["scope.top."+r+(p.isFunction?"()":"")]=c);var u="";return this.getScope(function(e){if(!e.isSpecial()){var a=n(e._context,r);a.isDefined&&(t[u+r+(a.isFunction?"()":"")]=e._context),u+="../"}return!1}),t}},hasKey:function(e){var t,n=observeReader.reads(e);return(t="scope"===n[0].key?observeReader.read(this,n.slice(1),e):observeReader.read(this._context,n,e)).foundLastParent&&t.parentHasKey},set:function(e,t,n){n=n||{};var a=this.getDataForScopeSet(e,n),o=a.parent;if("production"!==process$1.env.NODE_ENV&&a.error)return dev.error(a.error);switch(a.warn&&dev.warn(a.warn),a.how){case"set":o.set(a.key,t,a.passOptions?n:void 0);break;case"write":observeReader.write(o,a.key,t,n);break;case"setValue":canReflect.setValue("key"in a?o[a.key]:o,t);break;case"setKeyValue":canReflect.setKeyValue(o,a.key,t);break;case"updateDeep":canReflect.updateDeep(o[a.key],t)}},attr:ObservationRecorder.ignore(function(e,t,n){return dev.warn("can-view-scope::attr is deprecated, please use peek, get or set"),n=assign({isArgument:!0},n),2===arguments.length?this.set(e,t,n):this.get(e,n)}),computeData:function(e,t){return compute_data(this,e,t)},compute:function(e,t){return this.computeData(e,t).compute},cloneFromRef:function(){for(var e,t=[],n=this;n;){if(n._context instanceof templateContext){e=n._parent;break}t.unshift(n),n=n._parent}return e?(t.forEach(function(t){e=e.add(t._context,t._meta)}),e):this},isSpecial:function(){return this._meta.notContext||this._meta.special||this._context instanceof templateContext||this._meta.variable}}),Scope.prototype._read=Scope.prototype._walk,canReflect.assignSymbols(Scope.prototype,{"can.hasKey":Scope.prototype.hasKey});var templateContextPrimitives=["filename","lineNumber"];templateContextPrimitives.forEach(function(e){Object.defineProperty(Scope.prototype,e,{get:function(){return this.readFromTemplateContext(e).value},set:function(t){this.templateContext[e]=t}})}),defineLazyValue(Scope.prototype,"templateContext",function(){return this.getTemplateContext()._context}),defineLazyValue(Scope.prototype,"root",function(){return dev.warn("`scope.root` is deprecated. Use either `scope.top` or `scope.vm` instead."),this.getRoot()}),defineLazyValue(Scope.prototype,"vm",function(){return this.getViewModel()}),defineLazyValue(Scope.prototype,"top",function(){return this.getTop()}),defineLazyValue(Scope.prototype,"helpers",function(){return canStacheHelpers});var specialKeywords=["index","key","element","event","viewModel","arguments","helperOptions"];specialKeywords.forEach(function(e){Object.defineProperty(Scope.prototype,e,{get:function(){return this.readFromSpecialContext(e).value}})}),"production"!==process$1.env.NODE_ENV&&(Scope.prototype.log=function(){for(var e=this,t="",n="";e;)n=e._meta.notContext?" (notContext)":e._meta.special?" (special)":"",console.log(t,canReflect.getName(e._context)+n,e._context),e=e._parent,t+=" "}),namespace.view=namespace.view||{};var canViewScope=namespace.view.Scope=Scope;export{canViewScope as a,makeComputeLike as b,templateContext as c,canStacheHelpers as d,canViewScope as e};
//# sourceMappingURL=chunk-ea559428.js.map
