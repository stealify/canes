{"version":3,"file":"chunk-fd5b3ff3.js","sources":["../node_modules/can-view-callbacks/can-view-callbacks.js"],"sourcesContent":["\"use strict\";\nvar ObservationRecorder = require('can-observation-recorder');\n\nvar dev = require('can-log/dev/dev');\nvar getGlobal = require('can-globals/global/global');\nvar domMutate = require('can-dom-mutate/node');\nvar namespace = require('can-namespace');\nvar nodeLists = require('can-view-nodelist');\nvar makeFrag = require(\"can-fragment\");\nvar globals = require('can-globals');\nvar canSymbol = require('can-symbol');\nvar canReflect = require('can-reflect');\n\nvar callbackMapSymbol = canSymbol.for('can.callbackMap');\n\n//!steal-remove-start\nif (process.env.NODE_ENV !== 'production') {\n\tvar requestedAttributes = {};\n}\n//!steal-remove-end\n\nvar tags = {};\n\n// WeakSet containing elements that have been rendered already\n// and therefore do not need to be rendered again\n\nvar automountEnabled = function(){\n\tvar document = globals.getKeyValue(\"document\");\n\tif(document == null || document.documentElement == null) {\n\t\treturn false;\n\t}\n\treturn document.documentElement.getAttribute(\"data-can-automount\") !== \"false\";\n};\n\nvar renderedElements = new WeakMap();\n\nvar renderNodeAndChildren = function(node) {\n\tvar tagName = node.tagName && node.tagName.toLowerCase();\n\tvar tagHandler = tags[tagName];\n\tvar children;\n\n\t// skip elements that already have a viewmodel or elements whose tags don't match a registered tag\n\t// or elements that have already been rendered\n\tif (tagHandler && !renderedElements.has(node)) {\n\t\ttagHandler(node, {});\n\t}\n\n\tif (node.getElementsByTagName) {\n\t\tchildren = node.getElementsByTagName(\"*\");\n\t\tfor (var k=0, child; (child = children[k]) !== undefined; k++) {\n\t\t\trenderNodeAndChildren(child);\n\t\t}\n\t}\n};\n\nvar mutationObserverEnabled = false;\nvar globalMutationObserver;\nvar enableMutationObserver = function() {\n\tif (mutationObserverEnabled) {\n\t\treturn;\n\t}\n\n\tvar mutationHandler = function(mutationsList) {\n\t\tvar addedNodes;\n\n\t\tfor (var i=0, mutation; (mutation = mutationsList[i]) !== undefined; i++) {\n\t\t\tif (mutation.type === \"childList\") {\n\t\t\t\taddedNodes = mutation.addedNodes;\n\n\t\t\t\tfor (var j=0, addedNode; (addedNode = addedNodes[j]) !== undefined; j++) {\n\t\t\t\t\t// skip elements that have already been rendered\n\t\t\t\t\tif (!renderedElements.has(addedNode)) {\n\t\t\t\t\t\trenderNodeAndChildren(addedNode);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tvar MutationObserver = globals.getKeyValue(\"MutationObserver\");\n\tif(MutationObserver) {\n\t\tglobalMutationObserver = new MutationObserver(mutationHandler);\n\t\tglobalMutationObserver.observe(getGlobal().document.documentElement, {\n\t\t\tchildList: true,\n\t\t\tsubtree: true\n\t\t});\n\n\t\tmutationObserverEnabled = true;\n\t}\n};\n\nvar renderTagsInDocument = function(tagName) {\n\tvar nodes = getGlobal().document.getElementsByTagName(tagName);\n\n\tfor (var i=0, node; (node = nodes[i]) !== undefined; i++) {\n\t\trenderNodeAndChildren(node);\n\t}\n};\n\nvar attr = function (attributeName, attrHandler) {\n\tif(attrHandler) {\n\t\tif (typeof attributeName === \"string\") {\n\t\t\tattributes[attributeName] = attrHandler;\n\t\t\t//!steal-remove-start\n\t\t\tif (process.env.NODE_ENV !== 'production') {\n\t\t\t\tif(requestedAttributes[attributeName]) {\n\t\t\t\t\tdev.warn(\"can-view-callbacks: \" + attributeName+ \" custom attribute behavior requested before it was defined.  Make sure \"+attributeName+\" is defined before it is needed.\");\n\t\t\t\t}\n\t\t\t}\n\t\t\t//!steal-remove-end\n\t\t} else {\n\t\t\tregExpAttributes.push({\n\t\t\t\tmatch: attributeName,\n\t\t\t\thandler: attrHandler\n\t\t\t});\n\n\t\t\t//!steal-remove-start\n\t\t\tif (process.env.NODE_ENV !== 'production') {\n\t\t\t\tObject.keys(requestedAttributes).forEach(function(requested){\n\t\t\t\t\tif(attributeName.test(requested)) {\n\t\t\t\t\t\tdev.warn(\"can-view-callbacks: \" + requested+ \" custom attribute behavior requested before it was defined.  Make sure \"+requested+\" is defined before it is needed.\");\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\t//!steal-remove-end\n\t\t}\n\t} else {\n\t\tvar cb = attributes[attributeName];\n\t\tif( !cb ) {\n\n\t\t\tfor( var i = 0, len = regExpAttributes.length; i < len; i++) {\n\t\t\t\tvar attrMatcher = regExpAttributes[i];\n\t\t\t\tif(attrMatcher.match.test(attributeName)) {\n\t\t\t\t\treturn attrMatcher.handler;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t//!steal-remove-start\n\t\tif (process.env.NODE_ENV !== 'production') {\n\t\t\trequestedAttributes[attributeName] = true;\n\t\t}\n\t\t//!steal-remove-end\n\n\t\treturn cb;\n\t}\n};\n\nvar attrs = function(attrMap) {\n\tvar map = canReflect.getKeyValue(attrMap, callbackMapSymbol) || attrMap;\n\n\t// Only add bindings once.\n\tif(attrMaps.has(map)) {\n\t\treturn;\n\t} else {\n\t\t// Would prefer to use WeakSet but IE11 doesn't support it.\n\t\tattrMaps.set(map, true);\n\t}\n\n\tcanReflect.eachKey(map, function(callback, exp){\n\t\tattr(exp, callback);\n\t});\n};\n\nvar attributes = {},\n\tregExpAttributes = [],\n\tattrMaps = new WeakMap(),\n\tautomaticCustomElementCharacters = /[-\\:]/;\nvar defaultCallback = function () {};\n\nvar tag = function (tagName, tagHandler) {\n\tif(tagHandler) {\n\t\tvar GLOBAL = getGlobal();\n\n\t\tvar validCustomElementName = automaticCustomElementCharacters.test(tagName),\n\t\t\ttagExists = typeof tags[tagName.toLowerCase()] !== 'undefined',\n\t\t\tcustomElementExists;\n\n\t\t//!steal-remove-start\n\t\tif (process.env.NODE_ENV !== 'production') {\n\t\t\tif (tagExists) {\n\t\t\t\tdev.warn(\"Custom tag: \" + tagName.toLowerCase() + \" is already defined\");\n\t\t\t}\n\n\t\t\tif (!validCustomElementName && tagName !== \"content\") {\n\t\t\t\tdev.warn(\"Custom tag: \" + tagName.toLowerCase() + \" hyphen missed\");\n\t\t\t}\n\t\t}\n\t\t//!steal-remove-end\n\n\t\t// if we have html5shiv ... re-generate\n\t\tif (GLOBAL.html5) {\n\t\t\tGLOBAL.html5.elements += \" \" + tagName;\n\t\t\tGLOBAL.html5.shivDocument();\n\t\t}\n\n\t\ttags[tagName.toLowerCase()] = tagHandler;\n\n\t\tif(automountEnabled()) {\n\t\t\tvar customElements = globals.getKeyValue(\"customElements\");\n\n\t\t\t// automatically render elements that have tagHandlers\n\t\t\t// If browser supports customElements, register the tag as a custom element\n\t\t\tif (customElements) {\n\t\t\t\tcustomElementExists = customElements.get(tagName.toLowerCase());\n\n\t\t\t\tif (validCustomElementName && !customElementExists) {\n\t\t\t\t\tvar CustomElement = function() {\n\t\t\t\t\t\treturn Reflect.construct(HTMLElement, [], CustomElement);\n\t\t\t\t\t};\n\n\t\t\t\t\tCustomElement.prototype = Object.create(HTMLElement.prototype);\n\n\t\t\t\t\tCustomElement.prototype.connectedCallback = function() {\n\t\t\t\t\t\t// don't re-render an element that has been rendered already\n\t\t\t\t\t\tif (!renderedElements.has(this)) {\n\t\t\t\t\t\t\ttags[tagName.toLowerCase()](this, {});\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tcustomElements.define(tagName, CustomElement);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// If browser doesn't support customElements, set up MutationObserver for\n\t\t\t// rendering elements when they are inserted in the page\n\t\t\t// and rendering elements that are already in the page\n\t\t\telse {\n\t\t\t\tenableMutationObserver();\n\t\t\t\trenderTagsInDocument(tagName);\n\t\t\t}\n\t\t} else if(mutationObserverEnabled) {\n\t\t\tglobalMutationObserver.disconnect();\n\t\t}\n\t} else {\n\t\tvar cb;\n\n\t\t// if null is passed as tagHandler, remove tag\n\t\tif (tagHandler === null) {\n\t\t\tdelete tags[tagName.toLowerCase()];\n\t\t} else {\n\t\t\tcb = tags[tagName.toLowerCase()];\n\t\t}\n\n\t\tif(!cb && automaticCustomElementCharacters.test(tagName)) {\n\t\t\t// empty callback for things that look like special tags\n\t\t\tcb = defaultCallback;\n\t\t}\n\t\treturn cb;\n\t}\n\n};\n\nvar callbacks = {\n\t_tags: tags,\n\t_attributes: attributes,\n\t_regExpAttributes: regExpAttributes,\n\tdefaultCallback: defaultCallback,\n\ttag: tag,\n\tattr: attr,\n\tattrs: attrs,\n\t// handles calling back a tag callback\n\ttagHandler: function(el, tagName, tagData){\n\t\tvar scope = tagData.scope,\n\t\t\thelperTagCallback = scope && scope.templateContext.tags.get(tagName),\n\t\t\ttagCallback = helperTagCallback || tags[tagName],\n\t\t\tres;\n\n\t\t// If this was an element like <foo-bar> that doesn't have a component, just render its content\n\t\tif(tagCallback) {\n\t\t\tres = ObservationRecorder.ignore(tagCallback)(el, tagData);\n\n\t\t\t// add the element to the Set of elements that have had their handlers called\n\t\t\t// this will prevent the handler from being called again when the element is inserted\n\t\t\trenderedElements.set(el, true);\n\t\t} else {\n\t\t\tres = scope;\n\t\t}\n\n\t\t//!steal-remove-start\n\t\tif (process.env.NODE_ENV !== 'production') {\n\t\t\tif (!tagCallback) {\n\t\t\t\tvar GLOBAL = getGlobal();\n\t\t\t\tvar ceConstructor = GLOBAL.document.createElement(tagName).constructor;\n\t\t\t\t// If not registered as a custom element, the browser will use default constructors\n\t\t\t\tif (ceConstructor === GLOBAL.HTMLElement || ceConstructor === GLOBAL.HTMLUnknownElement) {\n\t\t\t\t\tdev.warn('can-view-callbacks: No custom element found for ' + tagName);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t//!steal-remove-end\n\n\t\t// If the tagCallback gave us something to render with, and there is content within that element\n\t\t// render it!\n\t\tif (res && tagData.subtemplate) {\n\t\t\tif (scope !== res) {\n\t\t\t\tscope = scope.add(res);\n\t\t\t}\n\n\t\t\tvar nodeList = nodeLists.register([], undefined, tagData.parentNodeList || true, false);\n\t\t\tnodeList.expression = \"<\" + el.tagName + \">\";\n\n\t\t\tvar result = tagData.subtemplate(scope, tagData.options, nodeList);\n\t\t\tvar frag = typeof result === \"string\" ? makeFrag(result) : result;\n\t\t\tdomMutate.appendChild.call(el, frag);\n\t\t}\n\t}\n};\n\nnamespace.view = namespace.view || {};\n\nif (namespace.view.callbacks) {\n\tthrow new Error(\"You can't have two versions of can-view-callbacks, check your dependencies\");\n} else {\n\tmodule.exports = namespace.view.callbacks = callbacks;\n}\n"],"names":["callbackMapSymbol","canSymbol","for","process","env","NODE_ENV","requestedAttributes","globalMutationObserver","tags","renderedElements","WeakMap","renderNodeAndChildren","node","children","tagName","toLowerCase","tagHandler","has","getElementsByTagName","child","k","undefined","mutationObserverEnabled","attr","attributeName","attrHandler","cb","attributes","i","len","regExpAttributes","length","attrMatcher","match","test","handler","dev","warn","push","Object","keys","forEach","requested","attrMaps","automaticCustomElementCharacters","defaultCallback","callbacks","_tags","_attributes","_regExpAttributes","tag","customElementExists","document","GLOBAL","getGlobal","validCustomElementName","tagExists","html5","elements","shivDocument","globals","getKeyValue","documentElement","getAttribute","customElements","get","CustomElement","Reflect","construct","HTMLElement","prototype","create","connectedCallback","this","define","MutationObserver","mutationsList","addedNodes","mutation","type","addedNode","j","observe","childList","subtree","enableMutationObserver","nodes","renderTagsInDocument","disconnect","attrs","attrMap","map","canReflect","set","eachKey","callback","exp","el","tagData","res","scope","tagCallback","templateContext","ObservationRecorder","ignore","ceConstructor","createElement","constructor","HTMLUnknownElement","subtemplate","add","nodeList","nodeLists","register","parentNodeList","expression","result","options","frag","makeFrag","domMutate","appendChild","call","namespace","view","Error","module"],"mappings":"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"}