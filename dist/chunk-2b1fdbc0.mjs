import{a as process$1}from"./chunk-bacf0c54.mjs";import"./chunk-5f1245ff.mjs";import{a as canSymbol}from"./chunk-b37d91a1.mjs";import"./chunk-fa6b878a.mjs";import"./chunk-862b179d.mjs";import"./chunk-2c9f11a8.mjs";import{a as dev}from"./chunk-585d4076.mjs";import{a as canReflect}from"./chunk-7e0220de.mjs";import{a as ObservationRecorder}from"./chunk-8811d387.mjs";import{a as queues}from"./chunk-12ed728f.mjs";import{a as KeyTree}from"./chunk-8d049599.mjs";var canReflectPromise,getKeyValueSymbol=canSymbol.for("can.getKeyValue"),observeDataSymbol=canSymbol.for("can.meta"),promiseDataPrototype={isPending:!0,state:"pending",isResolved:!1,isRejected:!1,value:void 0,reason:void 0};function setVirtualProp(e,t,a){var o=e[observeDataSymbol],s=o[t];o[t]=a,queues.enqueueByQueue(o.handlers.getNode([t]),e,[a,s],function(){return{}},["Promise",e,"resolved with value",a,"and changed virtual property: "+t])}function initPromise(e){var t=e[observeDataSymbol];t||(Object.defineProperty(e,observeDataSymbol,{enumerable:!1,configurable:!1,writable:!1,value:Object.create(promiseDataPrototype)}),(t=e[observeDataSymbol]).handlers=new KeyTree([Object,Object,Array])),e.then(function(t){queues.batch.start(),setVirtualProp(e,"isPending",!1),setVirtualProp(e,"isResolved",!0),setVirtualProp(e,"value",t),setVirtualProp(e,"state","resolved"),queues.batch.stop()},function(t){queues.batch.start(),setVirtualProp(e,"isPending",!1),setVirtualProp(e,"isRejected",!0),setVirtualProp(e,"reason",t),setVirtualProp(e,"state","rejected"),queues.batch.stop(),"production"!==process$1.env.NODE_ENV&&dev.error("Failed promise:",t)})}function setupPromise(e){var t,a="getPrototypeOf"in Object?Object.getPrototypeOf(e):e.__proto__;e[getKeyValueSymbol]&&e[observeDataSymbol]||(null!==a&&a!==Object.prototype||"function"==typeof(a=e).promise&&(t=a.promise,a.promise=function(){var e=t.call(a);return setupPromise(e),e}),canReflect.assignSymbols(a,{"can.getKeyValue":function(e){switch(this[observeDataSymbol]||initPromise(this),ObservationRecorder.add(this,e),e){case"state":case"isPending":case"isResolved":case"isRejected":case"value":case"reason":return this[observeDataSymbol][e];default:return this[e]}},"can.getValue":function(){return this[getKeyValueSymbol]("value")},"can.isValueLike":!1,"can.onKeyValue":function(e,t,a){this[observeDataSymbol]||initPromise(this),this[observeDataSymbol].handlers.add([e,a||"mutate",t])},"can.offKeyValue":function(e,t,a){this[observeDataSymbol]||initPromise(this),this[observeDataSymbol].handlers.delete([e,a||"mutate",t])},"can.hasOwnKey":function(e){return this[observeDataSymbol]||initPromise(this),e in this[observeDataSymbol]}}))}export{setupPromise as a,setupPromise as b};
//# sourceMappingURL=chunk-2b1fdbc0.js.map
