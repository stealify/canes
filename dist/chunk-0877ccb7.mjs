import{a as canReflectPromise}from"./chunk-2b1fdbc0.mjs";import{a as process$1}from"./chunk-bacf0c54.mjs";import"./chunk-fa6b878a.mjs";import{a as dev}from"./chunk-585d4076.mjs";import{a as canSymbol}from"./chunk-b37d91a1.mjs";import"./chunk-5f1245ff.mjs";import{a as ObservationRecorder}from"./chunk-8811d387.mjs";import{a as canReflect}from"./chunk-7e0220de.mjs";var observeReader,getValueSymbol=canSymbol.for("can.getValue"),setValueSymbol=canSymbol.for("can.setValue"),isValueLikeSymbol=canSymbol.for("can.isValueLike"),peek=ObservationRecorder.ignore(canReflect.getKeyValue.bind(canReflect)),bindName=Function.prototype.bind;"production"!==process$1.env.NODE_ENV&&(bindName=function(e){var a=Function.prototype.bind.call(this,e);return Object.defineProperty(a,"name",{value:canReflect.getName(e)+"."+canReflect.getName(this)}),a});var isAt=function(e,a){var r=a[e-1];return r&&r.at},readValue=function(e,a,r,t,n,o){for(var s=0,c=observeReader.valueReaders.length;s<c;s++)observeReader.valueReaders[s].test(e,a,r,t)&&(e=observeReader.valueReaders[s].read(e,a,r,t,n,o));return e},specialRead={index:!0,key:!0,event:!0,element:!0,viewModel:!0},checkForObservableAndNotify=function(e,a,r,t,n){e.foundObservable&&!a.foundObservable&&ObservationRecorder.trapsCount()&&(ObservationRecorder.addMany(r()),e.foundObservable(t,n),a.foundObservable=!0)},objHasKeyAtIndex=function(e,a,r){return!!(a&&a.length&&canReflect.hasKey(e,a[r].key))};(observeReader={read:function(e,a,r){var t,n={foundObservable:!1};(r=r||{}).foundObservable&&(t=ObservationRecorder.trap());var o,s,c=readValue(e,0,a,r,n),l=a.length,i=0;for(checkForObservableAndNotify(r,n,t,e,0);i<l;){o=c;for(var d=0,u=observeReader.propertyReaders.length;d<u;d++){var b=observeReader.propertyReaders[d];if(b.test(c)){c=b.read(c,a[i],i,r,n);break}}if(checkForObservableAndNotify(r,n,t,o,i),c=readValue(c,i+=1,a,r,n,o),checkForObservableAndNotify(r,n,t,o,i-1),i<a.length&&null==c)return s=objHasKeyAtIndex(o,a,i-1),r.earlyExit&&!s&&r.earlyExit(o,i-1,c),{value:void 0,parent:o,parentHasKey:s,foundLastParent:!1}}return s=objHasKeyAtIndex(o,a,a.length-1),void 0!==c||s||r.earlyExit&&r.earlyExit(o,i-1),{value:c,parent:o,parentHasKey:s,foundLastParent:!0}},get:function(e,a,r){return observeReader.read(e,observeReader.reads(a),r||{}).value},valueReadersMap:{},valueReaders:[{name:"function",test:function(e){return e&&canReflect.isFunctionLike(e)&&!canReflect.isConstructorLike(e)},read:function(e,a,r,t,n,o){return t.callMethodsOnObservables&&canReflect.isObservableLike(o)&&canReflect.isMapLike(o)?(dev.warn("can-stache-key: read() called with `callMethodsOnObservables: true`."),e.apply(o,t.args||[])):!1!==t.proxyMethods?bindName.call(e,o):e}},{name:"isValueLike",test:function(e,a,r,t){return e&&e[getValueSymbol]&&!1!==e[isValueLikeSymbol]&&(t.foundAt||!isAt(a,r))},read:function(e,a,r,t){return!1===t.readCompute&&a===r.length?e:canReflect.getValue(e)},write:function(e,a){e[setValueSymbol]?e[setValueSymbol](a):e.set?e.set(a):e(a)}}],propertyReadersMap:{},propertyReaders:[{name:"map",test:function(e){return(canReflect.isPromise(e)||"object"==typeof e&&e&&"function"==typeof e.then)&&canReflectPromise(e),canReflect.isObservableLike(e)&&canReflect.isMapLike(e)},read:function(e,a){var r=canReflect.getKeyValue(e,a.key);return void 0!==r?r:e[a.key]},write:canReflect.setKeyValue},{name:"object",test:function(){return!0},read:function(e,a,r,t){if(null!=e)return"object"!=typeof e?e[a.key]:a.key in e?e[a.key]:"production"!==process$1.env.NODE_ENV&&a.at&&specialRead[a.key]&&"@"+a.key in e?(t.foundAt=!0,void dev.warn("Use %"+a.key+" in place of @"+a.key+".")):void 0},write:function(e,a,r){var t=e[a];null!=r&&"object"==typeof r&&canReflect.isMapLike(t)?(dev.warn('can-stache-key: Merging data into "'+a+'" because its parent is non-observable'),canReflect.update(t,r)):null!=t&&void 0!==t[setValueSymbol]?canReflect.setValue(t,r):e[a]=r}}],reads:function(e){var a=""+e,r=[],t=0,n=!1;"@"===a.charAt(0)&&(t=1,n=!0);for(var o="",s=t;s<a.length;s++){var c=a.charAt(s);"."===c||"@"===c?"\\"!==a.charAt(s-1)?(r.push({key:o,at:n}),n="@"===c,o=""):o=o.substr(0,o.length-1)+".":o+=c}return r.push({key:o,at:n}),r},write:function(e,a,r,t){var n,o="string"==typeof a?observeReader.reads(a):a;if(t=t||{},o.length>1?(n=o.pop(),e=observeReader.read(e,o,t).value,o.push(n)):n=o[0],e){var s=peek(e,n.key);observeReader.valueReadersMap.isValueLike.test(s,o.length-1,o,t)?observeReader.valueReadersMap.isValueLike.write(s,r,t):(observeReader.valueReadersMap.isValueLike.test(e,o.length-1,o,t)&&(e=e[getValueSymbol]()),observeReader.propertyReadersMap.map.test(e)?observeReader.propertyReadersMap.map.write(e,n.key,r,t):observeReader.propertyReadersMap.object.test(e)&&(observeReader.propertyReadersMap.object.write(e,n.key,r,t),t.observation&&t.observation.update()))}}}).propertyReaders.forEach(function(e){observeReader.propertyReadersMap[e.name]=e}),observeReader.valueReaders.forEach(function(e){observeReader.valueReadersMap[e.name]=e}),observeReader.set=observeReader.write;var canStacheKey=observeReader;export{canStacheKey as a};
//# sourceMappingURL=chunk-0877ccb7.js.map
