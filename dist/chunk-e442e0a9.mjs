import{a as getDocument}from"./chunk-14877182.mjs";import{a as getMutationObserver}from"./chunk-fea13b24.mjs";import{a as getGlobal}from"./chunk-cc1f8896.mjs";import"./chunk-805ffcb4.mjs";import{a as globals}from"./chunk-185a1a27.mjs";import{a as namespace}from"./chunk-3b4c7b38.mjs";var push=Array.prototype.push;function eliminate(e,t){var a=e.indexOf(t);a>=0&&e.splice(a,1)}function isInDocument(e){var t=getDocument();return t===e||t.contains(e)}function isDocumentElement(e){return getDocument().documentElement===e}function isFragment(e){return!(!e||11!==e.nodeType)}function getChildren(e){for(var t=[],a=e.firstChild;a;)t.push(a),a=a.nextSibling;return t}function getParents(e){return isFragment(e)?getChildren(e):[e]}function getAllNodes(e){for(var t=getParents(e),a=t.length,n=0;n<a;n++){var r=t[n];if(r.getElementsByTagName){var o=r.getElementsByTagName("*");push.apply(t,o)}}return t}function subscription(e){return function(){var t=e.apply(this,arguments),a=!1;return function(){if(a){var n=e.name||e.displayName||"an anonymous function";throw new Error("Disposal function returned by "+n+" called more than once.")}t.apply(this,arguments),a=!0}}}var domMutate,Util={eliminate:eliminate,isInDocument:isInDocument,getDocument:getDocument,isDocumentElement:isDocumentElement,isFragment:isFragment,getParents:getParents,getAllNodes:getAllNodes,getChildren:getChildren,subscription:subscription},setImmediate=getGlobal().setImmediate||function(e){return setTimeout(e,0)},getDocument$1=Util.getDocument,eliminate$1=Util.eliminate,subscription$1=Util.subscription,isDocumentElement$1=Util.isDocumentElement,getAllNodes$1=Util.getAllNodes,push$1=Array.prototype.push,slice=Array.prototype.slice,dataStore=new WeakMap;function getRelatedData(e,t){var a=dataStore.get(e);if(a)return a[t]}function setRelatedData(e,t,a){var n=dataStore.get(e);n||(n={},dataStore.set(e,n)),n[t]=a}function deleteRelatedData(e,t){return delete dataStore.get(e)[t]}function batch(e,t){var a=[],n=[],r=new Set,o=!1;return function(i,s){if(t)for(var u=0;u<i.length;u++){var d=i[u],l=d.target;r.has(l)||(a.push(d),r.add(l))}else push$1.apply(a,i);s&&n.push(s),!o&&a.length>0&&(o=!0,setImmediate(function(){var i=a;a=[];var s=n;n=[],t&&(r=new Set),o=!1,e(i);for(var u=s.length,d=0;d<u;d++)s[d]()}))}}function getDocumentListeners(e,t){var a=getRelatedData(getDocument$1(),t);if(a)return a.listeners}function getTargetListeners(e,t){var a=getRelatedData(getDocument$1(),t);if(a)return a.get(e)}function addTargetListener(e,t,a){var n=getDocument$1(),r=getRelatedData(n,t);r||setRelatedData(n,t,r=new Map);var o=r.get(e);o||(o=[],r.set(e,o)),o.push(a)}function removeTargetListener(e,t,a){var n=getDocument$1(),r=getRelatedData(n,t);if(r){var o=r.get(e);o&&(eliminate$1(o,a),0===o.length&&(r.delete(e),0===r.size&&deleteRelatedData(n,t)))}}function fire(e,t){for(var a=slice.call(e,0),n=a.length,r=0;r<n;r++)a[r](t)}function dispatch(e,t){return function(a){for(var n=0;n<a.length;n++){var r=a[n],o=r.target,i=getTargetListeners(o,e);if(i&&fire(i,r),t){var s=getDocumentListeners(o,t);s&&fire(s,r)}}}}function observeMutations(e,t,a,n){var r=getRelatedData(e,t);r||setRelatedData(e,t,r={observingCount:0});var o=function(){var t=getMutationObserver();if(t){var o=getGlobal().Node;if(!!(o&&e instanceof o)){var i=new t(n);i.observe(e,a),r.observer=i}}else r.observer&&(r.observer.disconnect(),r.observer=null)};return 0===r.observingCount&&(globals.onKeyValue("MutationObserver",o),o()),r.observingCount++,function(){var a=getRelatedData(e,t);a&&(a.observingCount--,a.observingCount<=0&&(a.observer&&a.observer.disconnect(),deleteRelatedData(e,t),globals.offKeyValue("MutationObserver",o)))}}function handleTreeMutations(e){for(var t=e.length,a=0;a<t;a++){for(var n=e[a],r=n.addedNodes,o=r.length,i=0;i<o;i++)domMutate.dispatchNodeInsertion(r[i]);for(var s=n.removedNodes,u=s.length,d=0;d<u;d++)domMutate.dispatchNodeRemoval(s[d])}}function handleAttributeMutations(e){for(var t=e.length,a=0;a<t;a++){var n=e[a];if("attributes"===n.type){var r=n.target,o=n.attributeName,i=n.oldValue;domMutate.dispatchNodeAttributeChange(r,o,i)}}}var treeMutationConfig={subtree:!0,childList:!0},attributeMutationConfig={attributes:!0,attributeOldValue:!0};function addNodeListener(e,t,a){return subscription$1(function(n,r){return 11===n.nodeType?Function.prototype:(o=a?observeMutations(n,t,attributeMutationConfig,handleAttributeMutations):observeMutations(getDocument$1(),t,treeMutationConfig,handleTreeMutations),addTargetListener(n,e,r),function(){o(),removeTargetListener(n,e,r)});var o})}function addGlobalListener(e,t){return subscription$1(function(a,n){if(!isDocumentElement$1(a))throw new Error("Global mutation listeners must pass a documentElement");var r=getDocument$1(),o=getRelatedData(r,e);o||setRelatedData(r,e,o={listeners:[]});var i=o.listeners;return 0===i.length&&(o.removeListener=t(r,function(){})),i.push(n),function(){var t=getRelatedData(r,e);if(t){var a=t.listeners;eliminate$1(a,n),0===a.length&&(t.removeListener(),deleteRelatedData(r,e))}}})}function toMutationEvents(e){for(var t=[],a=0;a<e.length;a++)t.push({target:e[a]});return t}var domMutationPrefix="domMutation",insertionDataKey=domMutationPrefix+"InsertionData",removalDataKey=domMutationPrefix+"RemovalData",attributeChangeDataKey=domMutationPrefix+"AttributeChangeData",documentInsertionDataKey=domMutationPrefix+"DocumentInsertionData",documentRemovalDataKey=domMutationPrefix+"DocumentRemovalData",documentAttributeChangeDataKey=domMutationPrefix+"DocumentAttributeChangeData",treeDataKey=domMutationPrefix+"TreeData",attributeDataKey=domMutationPrefix+"AttributeData",dispatchInsertion=batch(dispatch(insertionDataKey,documentInsertionDataKey),!0),dispatchRemoval=batch(dispatch(removalDataKey,documentRemovalDataKey),!0),dispatchAttributeChange=batch(dispatch(attributeChangeDataKey,documentAttributeChangeDataKey)),addNodeInsertionListener=addNodeListener(insertionDataKey,treeDataKey),addNodeRemovalListener=addNodeListener(removalDataKey,treeDataKey),addNodeAttributeChangeListener=addNodeListener(attributeChangeDataKey,attributeDataKey,!0),addInsertionListener=addGlobalListener(documentInsertionDataKey,addNodeInsertionListener),addRemovalListener=addGlobalListener(documentRemovalDataKey,addNodeRemovalListener),addAttributeChangeListener=addGlobalListener(documentAttributeChangeDataKey,addNodeAttributeChangeListener);domMutate={dispatchNodeInsertion:function(e,t){var a=toMutationEvents(getAllNodes$1(e));dispatchInsertion(a,t)},dispatchNodeRemoval:function(e,t){var a=toMutationEvents(getAllNodes$1(e));dispatchRemoval(a,t)},dispatchNodeAttributeChange:function(e,t,a,n){dispatchAttributeChange([{target:e,attributeName:t,oldValue:a}],n)},onNodeInsertion:addNodeInsertionListener,onNodeRemoval:addNodeRemovalListener,onNodeAttributeChange:addNodeAttributeChangeListener,onRemoval:addRemovalListener,onInsertion:addInsertionListener,onAttributeChange:addAttributeChangeListener};var canDomMutate=namespace.domMutate=domMutate;export{canDomMutate as a,Util as b};
//# sourceMappingURL=chunk-e442e0a9.js.map
