import{a as process$1}from"./chunk-bacf0c54.mjs";import"./chunk-5f1245ff.mjs";import{a as canReflect}from"./chunk-7e0220de.mjs";import{a as canSymbol}from"./chunk-b37d91a1.mjs";import"./chunk-dc356f62.mjs";import{a as DefineMap}from"./chunk-65a1c0b6.mjs";import"./chunk-660b4975.mjs";import{a as SimpleObservable}from"./chunk-65b62c71.mjs";import{a as dev}from"./chunk-585d4076.mjs";import{a as diff}from"./chunk-3f0a7243.mjs";import{a as diffObject}from"./chunk-59303698.mjs";import"./chunk-88d0c417.mjs";import{a as deparam}from"./chunk-d3aaf861.mjs";import"./chunk-27026eab.mjs";import{a as param}from"./chunk-27ff5bb0.mjs";import"./chunk-04598776.mjs";import{b as require$$0}from"./chunk-a97d251a.mjs";import{b as globals}from"./chunk-cc1f8896.mjs";import{a as canRouteHash}from"./chunk-0d15ce09.mjs";import"./chunk-91f0208e.mjs";import"./chunk-862b179d.mjs";import"./chunk-7dfeb1df.mjs";import"./chunk-805ffcb4.mjs";import{a as isBrowserWindow}from"./chunk-e7f43bec.mjs";import{a as Bind}from"./chunk-a73c65cc.mjs";import{a as queues}from"./chunk-12ed728f.mjs";import{a as Observation}from"./chunk-c1d5d21e.mjs";import{a as namespace}from"./chunk-3b4c7b38.mjs";var Compute=function(e){return arguments.length?canReflect.setValue(this,e):canReflect.getValue(this)},translationHelpers=new WeakMap,makeCompute=function(e){var t=Compute.bind(e);return t.on=t.bind=t.addEventListener=function(a,n){var r=translationHelpers.get(n);r||(r=function(e,a){n.call(t,{type:"change"},e,a)},"production"!==process$1.env.NODE_ENV&&Object.defineProperty(r,"name",{value:"translationHandler("+a+")::"+canReflect.getName(e)+".onValue("+canReflect.getName(n)+")"}),translationHelpers.set(n,r)),canReflect.onValue(e,r)},t.off=t.unbind=t.removeEventListener=function(t,a){canReflect.offValue(e,translationHelpers.get(a))},canReflect.assignSymbols(t,{"can.getValue":function(){return canReflect.getValue(e)},"can.setValue":function(t){return canReflect.setValue(e,t)},"can.onValue":function(t,a){return canReflect.onValue(e,t,a)},"can.offValue":function(t,a){return canReflect.offValue(e,t,a)},"can.valueHasDependencies":function(){return canReflect.valueHasDependencies(e)},"can.getPriority":function(){return canReflect.getPriority(e)},"can.setPriority":function(t){canReflect.setPriority(e,t)},"can.isValueLike":!0,"can.isFunctionLike":!1}),t.isComputed=!0,t},stringify=function(e){return e&&"object"==typeof e?(e=e&&"object"==typeof e&&"serialize"in e?e.serialize():"function"==typeof e.slice?e.slice():canReflect.assign({},e),canReflect.eachKey(e,function(t,a){e[a]=stringify(t)})):null!=e&&"function"==typeof e.toString&&(e=e.toString()),e},stringCoercingMapDecorator=function(e){var t=canSymbol.for("can.route.stringCoercingMapDecorator");if(!e.attr[t]){var a=e.attr;e.attr=function(e,t){var n;return n="string"==typeof e&&(void 0===this.define||void 0===this.define[e]||!!this.define[e].serialize)?stringify(Array.apply(null,arguments)):arguments,a.apply(this,n)},canReflect.setKeyValue(e.attr,t,!0)}return e},stringCoercingMapDecorator_1=stringCoercingMapDecorator,stringify_1=stringify,stringCoercion={stringCoercingMapDecorator:stringCoercingMapDecorator_1,stringify:stringify_1},stringify$1=stringCoercion.stringify,routedata=DefineMap.extend("RouteData",{seal:!1},{"*":{type:stringify$1}}),urlDataObservable=new SimpleObservable(null);canReflect.setName(urlDataObservable,"route.urlData");var bindingProxy={defaultBinding:null,urlDataObservable:urlDataObservable,bindings:{},call:function(){var e=canReflect.toArray(arguments),t=e.shift(),a=urlDataObservable.value;if(null===a)throw new Error("there is no current binding!!!");var n=a[0===t.indexOf("can.")?canSymbol.for(t):t];return n.apply?n.apply(a,e):n}},bindingProxy_1=bindingProxy,regexps={curlies:/\{\s*([\w.]+)\s*\}/g,colon:/\:([\w.]+)/g},removeBackslash=function(e){return e.replace(/\\/g,"")},wrapQuote=function(e){return(e+"").replace(/([.?*+\^$\[\]\\(){}|\-])/g,"\\$1")},RouteRegistry={routes:{},register:function(e,t){var a=bindingProxy_1.call("root");a.lastIndexOf("/")===a.length-1&&0===e.indexOf("/")&&(e=e.substr(1)),t=t||{};var n,r,o,c=[],i="",u=bindingProxy_1.call("querySeparator"),s=bindingProxy_1.call("matchSlashes");for(regexps.colon.test(e)?(r=regexps.colon,"production"!==process$1.env.NODE_ENV&&dev.warn('update route "'+e+'" to "'+e.replace(regexps.colon,function(e,t){return"{"+t+"}"})+'"')):r=regexps.curlies,o=r.lastIndex=0;n=r.exec(e);)c.push(n[1]),i+=removeBackslash(e.substring(o,r.lastIndex-n[0].length)),i+="([^"+("\\"+(removeBackslash(e.substr(r.lastIndex,1))||u+(s?"":"|/")))+"]"+(t[n[1]]?"*":"+")+")",o=r.lastIndex;if(i+=e.substr(o).replace("\\",""),"production"!==process$1.env.NODE_ENV&&canReflect.eachKey(RouteRegistry.routes,function(a){var n=a.names.concat(Object.keys(a.defaults)).sort(),r=c.concat(Object.keys(t)).sort(),o=!diff(n,r).length,i=!diffObject(a.defaults,t).length,u=a.route.replace(/\/$/,"")===e.replace(/\/$/,"");o&&i&&!u&&dev.warn('two routes were registered with matching keys:\n\t(1) route.register("'+a.route+'", '+JSON.stringify(a.defaults)+')\n\t(2) route.register("'+e+'", '+JSON.stringify(t)+")\n(1) will always be chosen since it was registered first")}),this.data instanceof routedata){var l=this.data;canReflect.eachIndex(c,function(e){var a="string",n=t[e];null!=n&&(a=typeof n),canReflect.defineInstanceKey(l.constructor,e,{type:a})})}return RouteRegistry.routes[e]={test:new RegExp("^"+i+"($|"+wrapQuote(u)+")"),route:e,names:c,defaults:t,length:e.split("/").length}}},register=RouteRegistry,decode=function(e){try{return decodeURIComponent(e)}catch(t){return unescape(e)}};function toURLFragment(e){var t=bindingProxy_1.call("root");return t.lastIndexOf("/")===t.length-1&&0===e.indexOf("/")&&(e=e.substr(1)),e}function canRoute_getRule(e){e=toURLFragment(e);var t={length:-1};if(canReflect.eachKey(register.routes,function(a,n){a.test.test(e)&&a.length>t.length&&(t=a)}),t.length>-1)return t}function canRoute_deparam(e){var t=canRoute_getRule(e),a=bindingProxy_1.call("querySeparator"),n=bindingProxy_1.call("paramsMatcher");if(e=toURLFragment(e),t){var r=e.match(t.test),o=r.shift(),c=e.substr(o.length-(r[r.length-1]===a?1:0)),i=c&&n.test(c)?deparam(c.slice(1)):{};return i=canReflect.assignDeep(canReflect.assignDeep({},t.defaults),i),r.forEach(function(e,n){e&&e!==a&&(i[t.names[n]]=decode(e))}),i}return e.charAt(0)!==a&&(e=a+e),n.test(e)?deparam(e.slice(1)):{}}canRoute_deparam.getRule=canRoute_getRule;var deparam_1=canRoute_deparam,matchesData=function(e,t){var a=0,n=0,r={};for(var o in e.defaults)e.defaults[o]===t[o]&&(r[o]=1,a++);for(;n<e.names.length;n++){if(!t.hasOwnProperty(e.names[n]))return-1;r[e.names[n]]||a++}return a};function getMatchedRoute(e,t){var a,n,r=0,o=0;return delete e.route,canReflect.eachKey(e,function(){o++}),canReflect.eachKey(register.routes,function(t,c){if((n=matchesData(t,e))>r&&(a=t,r=n),n>=o)return!1}),register.routes[t]&&matchesData(register.routes[t],e)===r&&(a=register.routes[t]),a}function paramFromRoute(e,t){var a,n,r,o;return e?(a=canReflect.assignMap({},t),o=regexps.colon.test(e.route)?regexps.colon:regexps.curlies,n=e.route.replace(o,function(n,r){return delete a[r],t[r]===e.defaults[r]?"":encodeURIComponent(t[r])}).replace("\\",""),canReflect.eachKey(e.defaults,function(e,t){a[t]===e&&delete a[t]}),n+((r=param(a))?bindingProxy_1.call("querySeparator")+r:"")):0===canReflect.size(t)?"":bindingProxy_1.call("querySeparator")+param(t)}function canRoute_param(e,t){return paramFromRoute(getMatchedRoute(e,t),e)}var param_1=canRoute_param;canRoute_param.paramFromRoute=paramFromRoute,canRoute_param.getMatchedRoute=getMatchedRoute;var makeProps=function(e){var t=[];return canReflect.eachKey(e,function(e,a){t.push(("className"===a?"class":a)+'="'+("href"===a?e:require$$0.esc(e))+'"')}),t.join(" ")},matchCheck=function(e,t){for(var a in e){var n=e[a],r=t[a];if(n&&r&&"object"==typeof n&&"object"==typeof t)return matchCheck(n,r);if(n!=r)return!1}return!0};function canRoute_url(e,t){if(t){var a=deparam_1(bindingProxy_1.call("can.getValue"));e=canReflect.assignMap(canReflect.assignMap({},a),e)}return bindingProxy_1.call("root")+param_1(e)}var urlHelpers={url:canRoute_url,link:function(e,t,a,n){return"<a "+makeProps(canReflect.assignMap({href:canRoute_url(t,n)},a))+">"+e+"</a>"},isCurrent:function(e,t){if(t){var a=deparam_1(bindingProxy_1.call("can.getValue"));return matchCheck(e,a)}return bindingProxy_1.call("can.getValue")===param_1(e)}},funcConstructor=Function;globals.define("isWebWorker",function(){var e=funcConstructor("return this")();return"undefined"!=typeof WorkerGlobalScope&&e instanceof WorkerGlobalScope});var timer,isWebWorker=globals.makeExport("isWebWorker"),stringCoercingMapDecorator$1=stringCoercion.stringCoercingMapDecorator,hashchangeObservable=new canRouteHash;function canRoute(e,t){return"production"!==process$1.env.NODE_ENV&&dev.warn("Call route.register(url,defaults) instead of calling route(url, defaults)"),register.register(e,t),canRoute}bindingProxy_1.bindings.hashchange=hashchangeObservable,bindingProxy_1.defaultBinding="hashchange",bindingProxy_1.urlDataObservable.value=hashchangeObservable;var currentRuleObservable=new Observation(function(){var e=bindingProxy_1.call("can.getValue");return canRoute.rule(e)});function updateUrl(e){clearTimeout(timer),timer=setTimeout(function(){var e=canReflect.serialize(canRoute.data),t=currentRuleObservable.get(),a=param_1.getMatchedRoute(e,t),n=param_1.paramFromRoute(a,e);bindingProxy_1.call("can.setValue",n);var r=canRoute._onStartComplete;r&&(canRoute._onStartComplete=void 0,r())},10)}function updateRouteData(){var e=bindingProxy_1.call("can.getValue");queues.batch.start();var t=canRoute.deparam(e);delete t.route,canReflect.update(canRoute.data,t),queues.batch.stop()}Object.defineProperty(canRoute,"routes",{get:function(){return register.routes},set:function(e){return register.routes=e}}),Object.defineProperty(canRoute,"defaultBinding",{get:function(){return bindingProxy_1.defaultBinding},set:function(e){bindingProxy_1.defaultBinding=e;var t=bindingProxy_1.bindings[bindingProxy_1.defaultBinding];t&&(bindingProxy_1.urlDataObservable.value=t)}}),Object.defineProperty(canRoute,"urlData",{get:function(){return bindingProxy_1.urlDataObservable.value},set:function(e){canRoute._teardown(),bindingProxy_1.urlDataObservable.value=e}}),canReflect.assignMap(canRoute,{param:param_1,deparam:deparam_1,map:function(e){"production"!==process$1.env.NODE_ENV&&dev.warn("Set route.data directly instead of calling route.map"),canRoute.data=e},start:function(e){if(!0!==e&&(canRoute._setup(),isBrowserWindow()||isWebWorker())){var t=bindingProxy_1.call("can.getValue");queues.batch.start();var a=canRoute.deparam(t);delete a.route,canReflect.assign(canRoute.data,a),queues.batch.stop(),updateUrl()}return canRoute},url:urlHelpers.url,link:urlHelpers.link,isCurrent:urlHelpers.isCurrent,bindings:bindingProxy_1.bindings,_setup:function(){if(!canRoute._canBinding){var e={parent:bindingProxy_1.urlDataObservable.value,setParent:updateUrl,child:canRoute.serializedObservation,setChild:updateRouteData,onInitDoNotUpdateChild:!0,cycles:1,queue:"notify"};"production"!==process$1.env.NODE_ENV&&(e.updateChildName="can-route.updateRouteData",e.updateParentName="can-route.updateUrl"),canRoute._canBinding=new Bind(e),canRoute._canBinding.start()}},_teardown:function(){canRoute._canBinding&&(canRoute._canBinding.stop(),canRoute._canBinding=null),clearTimeout(timer)},stop:function(){return this._teardown(),canRoute},currentRule:makeCompute(currentRuleObservable),register:register.register,rule:function(e){var t=deparam_1.getRule(e);if(t)return t.route}});var routeData,bindToCanRouteData=function(e,t){return canRoute.data[e]?canRoute.data[e].apply(canRoute.data,t):canRoute.data.addEventListener.apply(canRoute.data,t)};["addEventListener","removeEventListener","bind","unbind","on","off"].forEach(function(e){canRoute[e]=function(t,a){return"__url"===t?bindingProxy_1.call("can.onValue",a):bindToCanRouteData(e,arguments)}}),["delegate","undelegate","removeAttr","compute","_get","___get","each"].forEach(function(e){canRoute[e]=function(){return bindToCanRouteData(e,arguments)}});var serializedObservation,serializedCompute,setRouteData=function(e){return routeData=e};Object.defineProperty(canRoute,"serializedObservation",{get:function(){return serializedObservation||(serializedObservation=new Observation(function(){return canReflect.serialize(canRoute.data)})),serializedObservation}}),Object.defineProperty(canRoute,"serializedCompute",{get:function(){return serializedCompute||(serializedCompute=makeCompute(canRoute.serializedObservation)),serializedCompute}});var viewModelSymbol=canSymbol.for("can.viewModel");Object.defineProperty(canRoute,"data",{get:function(){return routeData||setRouteData(new routedata)},set:function(e){canReflect.isConstructorLike(e)&&(e=new e),e&&void 0!==e[viewModelSymbol]&&(e=e[viewModelSymbol]),setRouteData("attr"in e?stringCoercingMapDecorator$1(e):e)}}),canRoute.attr=function(e,t){return console.warn("can-route: can-route.attr is deprecated. Use methods on can-route.data instead."),"attr"in canRoute.data?canRoute.data.attr.apply(canRoute.data,arguments):arguments.length>1?(canReflect.setKeyValue(canRoute.data,e,t),canRoute.data):"object"==typeof e?(canReflect.assignDeep(canRoute.data,e),canRoute.data):1===arguments.length?canReflect.getKeyValue(canRoute.data,e):canReflect.unwrap(canRoute.data)},canReflect.setKeyValue(canRoute,canSymbol.for("can.isFunctionLike"),!1),canRoute.matched=canRoute.currentRule,canRoute.current=canRoute.isCurrent;var canRoute_1=namespace.route=canRoute;export{canRoute_1 as a,bindingProxy_1 as b,canRoute_1 as c};
//# sourceMappingURL=chunk-2fc7c20b.js.map
