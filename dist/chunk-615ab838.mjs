import{a as SettableObservable}from"./chunk-576d20b1.mjs";import{a as observeReader}from"./chunk-0877ccb7.mjs";import{a as canViewScope,b as makeComputeLike}from"./chunk-ea559428.mjs";import"./chunk-fa6b878a.mjs";import"./chunk-5f1245ff.mjs";import{a as canSymbol}from"./chunk-b37d91a1.mjs";import{a as ObservationRecorder}from"./chunk-8811d387.mjs";import{a as canReflect}from"./chunk-7e0220de.mjs";import{a as process$1}from"./chunk-bacf0c54.mjs";import"./chunk-7dfeb1df.mjs";import"./chunk-79943599.mjs";import{a as Observation}from"./chunk-c1d5d21e.mjs";import{a as valueEventBindings}from"./chunk-825526fa.mjs";import"./chunk-bd824939.mjs";import{a as assign}from"./chunk-75bea8d8.mjs";import{a as dev}from"./chunk-585d4076.mjs";function KeyObservable(e,t){t=""+t,this.key=t,this.root=e,SettableObservable.call(this,function(){return observeReader.get(this,t)},e)}KeyObservable.prototype=Object.create(SettableObservable.prototype),KeyObservable.prototype.set=function(e){observeReader.set(this.root,this.key,e)};var keyObservable=KeyObservable,isViewSymbol=canSymbol.for("can.isView"),createNoOpRenderer=function(e){return function(){e&&(e.rendered=!0)}},utils={last:function(e){return null!=e&&e[e.length-1]},emptyHandler:function(){},jsonParse:function(e){return"'"===e[0]?e.substr(1,e.length-2):"undefined"===e?void 0:JSON.parse(e)},mixins:{last:function(){return this.stack[this.stack.length-1]},add:function(e){this.last().add(e)},subSectionDepth:function(){return this.stack.length-1}},createRenderers:function(e,t,r,o,s,n){e.fn=o?this.makeRendererConvertScopes(o,t,r,n,e.metadata):createNoOpRenderer(e.metadata),e.inverse=s?this.makeRendererConvertScopes(s,t,r,n,e.metadata):createNoOpRenderer(e.metadata),e.isSection=!(!o&&!s)},makeRendererConvertScopes:function(e,t,r,o,s){var n=function(o,n,a){return void 0===o||o instanceof canViewScope||(o=t?t.add(o):new canViewScope(o||{})),s&&(s.rendered=!0),e(o||t,a||r)};return o?n:ObservationRecorder.ignore(n)},makeView:function(e){var t=ObservationRecorder.ignore(function(t,r){return t instanceof canViewScope||(t=new canViewScope(t)),e(t,r)});return t[isViewSymbol]=!0,t},getItemsStringContent:function(e,t,r){for(var o="",s=observeReader.get(e,"length"),n=canReflect.isObservableLike(e),a=0;a<s;a++){var i=n?new keyObservable(e,a):e[a];o+=r.fn(i)}return o},getItemsFragContent:function(e,t,r){var o,s=[],n=observeReader.get(e,"length"),a=canReflect.isObservableLike(e),i=t.exprData&&t.exprData.hashExprs;canReflect.size(i)>0&&(o={},canReflect.eachKey(i,function(e,t){o[e.key]=t}));for(var p=0;p<n;p++){var l={},c=a?new keyObservable(e,p):e[p];canReflect.size(o)>0&&(o.value&&(l[o.value]=c),o.index&&(l[o.index]=p)),s.push(t.fn(r.add(l,{notContext:!0}).add({index:p},{special:!0}).add(c)))}return s}},Arg=function(e,t){this.expr=e,this.modifiers=t||{},this.isCompute=!1};Arg.prototype.value=function(){return this.expr.value.apply(this.expr,arguments)},"production"!==process$1.env.NODE_ENV&&(Arg.prototype.sourceText=function(){return(this.modifiers.compute?"~":"")+this.expr.sourceText()});var arg=Arg,Literal=function(e){this._value=e};Literal.prototype.value=function(){return this._value},"production"!==process$1.env.NODE_ENV&&(Literal.prototype.sourceText=function(){return JSON.stringify(this._value)});var literal=Literal;function SetterObservable(e,t){this.setter=t,this.observation=new Observation(e),this.handler=this.handler.bind(this),"production"!==process$1.env.NODE_ENV&&(canReflect.assignSymbols(this,{"can.getName":function(){return canReflect.getName(this.constructor)+"<"+canReflect.getName(e)+">"}}),Object.defineProperty(this.handler,"name",{value:canReflect.getName(this)+".handler"}))}SetterObservable.prototype=Object.create(SettableObservable.prototype),SetterObservable.prototype.constructor=SetterObservable,SetterObservable.prototype.set=function(e){this.setter(e)},SetterObservable.prototype.hasDependencies=function(){return canReflect.valueHasDependencies(this.observation)},canReflect.assignSymbols(SetterObservable.prototype,{"can.setValue":SetterObservable.prototype.set,"can.valueHasDependencies":SetterObservable.prototype.hasDependencies});var setter=SetterObservable;function getObservableValue_fromKey(e,t,r){var o=t.computeData(e,r);return Observation.temporarilyBind(o),o}function computeHasDependencies(e){return e[canSymbol.for("can.valueHasDependencies")]?canReflect.valueHasDependencies(e):e.computeInstance.hasDependencies}function getObservableValue_fromDynamicKey_fromObservable(e,t,r,o){var s,n=function(){return observeReader.reads((""+canReflect.getValue(e)).replace(/\./g,"\\."))},a=new setter(function(){var e=observeReader.read(canReflect.getValue(t),n());return s=e.parentHasKey,e.value},function(e){observeReader.write(canReflect.getValue(t),n(),e)});return Observation.temporarilyBind(a),a.initialValue=canReflect.getValue(a),a.parentHasKey=s,a}function convertToArgExpression(e){return e instanceof arg||e instanceof literal?e:new arg(e)}function toComputeOrValue(e){return canReflect.isObservableLike(e)?canReflect.isValueLike(e)&&!1===canReflect.valueHasDependencies(e)?canReflect.getValue(e):e.compute?e.compute:makeComputeLike(e):e}function toCompute(e){return e?e.isComputed?e:e.compute?e.compute:makeComputeLike(e):e}var expressionHelpers={getObservableValue_fromKey:getObservableValue_fromKey,computeHasDependencies:computeHasDependencies,getObservableValue_fromDynamicKey_fromObservable:getObservableValue_fromDynamicKey_fromObservable,convertToArgExpression:convertToArgExpression,toComputeOrValue:toComputeOrValue,toCompute:toCompute},Hashes=function(e){this.hashExprs=e};Hashes.prototype.value=function(e,t){var r={};for(var o in this.hashExprs){var s=expressionHelpers.convertToArgExpression(this.hashExprs[o]),n=s.value.apply(s,arguments);r[o]={call:!s.modifiers||!s.modifiers.compute,value:n}}return new Observation(function(){var e={};for(var t in r)e[t]=r[t].call?canReflect.getValue(r[t].value):expressionHelpers.toComputeOrValue(r[t].value);return e})},"production"!==process$1.env.NODE_ENV&&(Hashes.prototype.sourceText=function(){var e=[];return canReflect.eachKey(this.hashExprs,function(t,r){e.push(r+"="+t.sourceText())}),e.join(" ")});var hashes=Hashes;if("production"!==process$1.env.NODE_ENV)var canSymbol$1=canSymbol;var Bracket=function(e,t,r){this.root=t,this.key=e,"production"!==process$1.env.NODE_ENV&&(this[canSymbol$1.for("can-stache.originalKey")]=r)};Bracket.prototype.value=function(e,t){var r=this.root?this.root.value(e,t):e.peek("this");return expressionHelpers.getObservableValue_fromDynamicKey_fromObservable(this.key.value(e,t),r,e,t,{})},"production"!==process$1.env.NODE_ENV&&(Bracket.prototype.sourceText=function(){return this.rootExpr?this.rootExpr.sourceText()+"["+this.key+"]":"["+this.key+"]"}),Bracket.prototype.closingTag=function(){if("production"!==process$1.env.NODE_ENV)return this[canSymbol$1.for("can-stache.originalKey")]||""};var bracket=Bracket,setIdentifier=function(e){this.value=e},sourceTextSymbol=canSymbol.for("can-stache.sourceText"),isViewSymbol$1=canSymbol.for("can.isView"),Call=function(e,t){this.methodExpr=e,this.argExprs=t.map(expressionHelpers.convertToArgExpression)};Call.prototype.args=function(e,t){for(var r={},o=[],s="function"==typeof t,n=0,a=this.argExprs.length;n<a;n++){var i=this.argExprs[n];if(i.expr instanceof hashes&&assign(r,i.expr.hashExprs),!s||!t(n)){var p=i.value.apply(i,arguments);o.push({call:!i.modifiers||!i.modifiers.compute,value:p})}}return function(e){var t=[];canReflect.size(r)>0&&(t.hashExprs=r);for(var s=0,n=o.length;s<n;s++)t[s]=e?o[s].value:o[s].call?canReflect.getValue(o[s].value):expressionHelpers.toCompute(o[s].value);return t}},Call.prototype.value=function(e,t){var r=this.methodExpr.value(e,{proxyMethods:!1}),o=canReflect.getValue(r),s=this.args(e,o&&o.ignoreArgLookup),n=function(o){var n=canReflect.getValue(r);if("function"==typeof n){var a=s(n.isLiveBound);return n.requiresOptionsArgument&&(a.hashExprs&&t&&t.exprData&&(t.exprData.hashExprs=a.hashExprs),void 0!==t&&a.push(t)),!0===n[isViewSymbol$1]&&a.push(t.nodeList),arguments.length&&a.unshift(new setIdentifier(o)),n.apply(r.thisArg||e.peek("this"),a)}};return"production"!==process$1.env.NODE_ENV&&Object.defineProperty(n,"name",{value:"{{"+this.sourceText()+"}}"}),t&&t.doNotWrapInObservation?n():new setter(n,n)},"production"!==process$1.env.NODE_ENV&&(Call.prototype.sourceText=function(){var e=this.argExprs.map(function(e){return e.sourceText()});return this.methodExpr.sourceText()+"("+e.join(",")+")"}),Call.prototype.closingTag=function(){return"production"!==process$1.env.NODE_ENV&&this.methodExpr[sourceTextSymbol]?this.methodExpr[sourceTextSymbol]:this.methodExpr.key};var call=Call,Helper=function(e,t,r){this.methodExpr=e,this.argExprs=t,this.hashExprs=r,this.mode=null};Helper.prototype.args=function(e){for(var t=[],r=0,o=this.argExprs.length;r<o;r++){var s=this.argExprs[r];t.push(expressionHelpers.toComputeOrValue(s.value.apply(s,arguments)))}return t},Helper.prototype.hash=function(e){var t={};for(var r in this.hashExprs){var o=this.hashExprs[r];t[r]=expressionHelpers.toComputeOrValue(o.value.apply(o,arguments))}return t},Helper.prototype.value=function(e,t){var r=this.methodExpr instanceof literal?""+this.methodExpr._value:this.methodExpr.key,o=this,s=expressionHelpers.getObservableValue_fromKey(r,e,{proxyMethods:!1}),n=s&&s.initialValue,a=s&&s.thisArg;if("function"==typeof n)s=function(){var r=o.args(e),s=assign(assign({},t),{hash:o.hash(e),exprData:o});return r.push(s),n.apply(a||e.peek("this"),r)},"production"!==process$1.env.NODE_ENV&&Object.defineProperty(s,"name",{configurable:!0,value:canReflect.getName(this)});else if("production"!==process$1.env.NODE_ENV){var i=e.peek("scope.filename"),p=e.peek("scope.lineNumber");dev.warn((i?i+":":"")+(p?p+": ":"")+'Unable to find helper "'+r+'".')}return s},Helper.prototype.closingTag=function(){return this.methodExpr.key},"production"!==process$1.env.NODE_ENV&&(Helper.prototype.sourceText=function(){var e=[this.methodExpr.sourceText()];return this.argExprs.length&&e.push(this.argExprs.map(function(e){return e.sourceText()}).join(" ")),canReflect.size(this.hashExprs)>0&&e.push(hashes.prototype.sourceText.call(this)),e.join(" ")}),"production"!==process$1.env.NODE_ENV&&canReflect.assignSymbols(Helper.prototype,{"can.getName":function(){return canReflect.getName(this.constructor)+"{{"+this.sourceText()+"}}"}});var helper=Helper,sourceTextSymbol$1=canSymbol.for("can-stache.sourceText"),Lookup=function(e,t,r){this.key=e,this.rootExpr=t,canReflect.setKeyValue(this,sourceTextSymbol$1,r)};Lookup.prototype.value=function(e,t){var r;if(r=this.rootExpr?expressionHelpers.getObservableValue_fromDynamicKey_fromObservable(this.key,this.rootExpr.value(e),e,{},{}):expressionHelpers.getObservableValue_fromKey(this.key,e,t),"production"!==process$1.env.NODE_ENV&&void 0===r.initialValue&&"debugger"!==this.key&&!r.parentHasKey){var o=e.peek("scope.filename"),s=e.peek("scope.lineNumber"),n=observeReader.reads(this.key),a=n[0].key,i=n.map(function(e){return e.key+(e.at?"()":"")}).join("."),p=e.getPathsForKey(a),l=Object.keys(p),c=l.length&&!l.includes(a),u=[(o?o+":":"")+(s?s+": ":"")+'Unable to find key "'+i+'".'+(c?" Did you mean"+(l.length>1?" one of these":"")+"?\n":"\n")];c&&l.forEach(function(e){u.push('\t"'+e+'" which will read from'),u.push(p[e]),u.push("\n")}),u.push("\n"),dev.warn.apply(dev,u)}return r},"production"!==process$1.env.NODE_ENV&&(Lookup.prototype.sourceText=function(){return this[sourceTextSymbol$1]?this[sourceTextSymbol$1]:this.rootExpr?this.rootExpr.sourceText()+"."+this.key:this.key});var lookup=Lookup,last=utils.last,sourceTextSymbol$2=canSymbol.for("can-stache.sourceText"),Hash=function(){},keyRegExp=/[\w\.\\\-_@\/\&%]+/,tokensRegExp=/('.*?'|".*?"|=|[\w\.\\\-_@\/*%\$]+|[\(\)]|,|\~|\[|\]\s*|\s*(?=\[))/g,bracketSpaceRegExp=/\]\s+/,literalRegExp=/^('.*?'|".*?"|-?[0-9]+\.?[0-9]*|true|false|null|undefined)$/,isTokenKey=function(e){return keyRegExp.test(e)},testDot=/^[\.@]\w/,isAddingToExpression=function(e){return isTokenKey(e)&&testDot.test(e)},ensureChildren=function(e){return e.children||(e.children=[]),e},Stack=function(){this.root={children:[],type:"Root"},this.current=this.root,this.stack=[this.root]};assign(Stack.prototype,{top:function(){return last(this.stack)},isRootTop:function(){return this.top()===this.root},popTo:function(e){this.popUntil(e),this.pop()},pop:function(){this.isRootTop()||this.stack.pop()},first:function(e){for(var t=this.stack.length-1;t>0&&-1===e.indexOf(this.stack[t].type);)t--;return this.stack[t]},firstParent:function(e){for(var t=this.stack.length-2;t>0&&-1===e.indexOf(this.stack[t].type);)t--;return this.stack[t]},popUntil:function(e){for(;-1===e.indexOf(this.top().type)&&!this.isRootTop();)this.stack.pop();return this.top()},addTo:function(e,t){var r=this.popUntil(e);ensureChildren(r).children.push(t)},addToAndPush:function(e,t){this.addTo(e,t),this.stack.push(t)},push:function(e){this.stack.push(e)},topLastChild:function(){return last(this.top().children)},replaceTopLastChild:function(e){var t=ensureChildren(this.top()).children;return t.pop(),t.push(e),e},replaceTopLastChildAndPush:function(e){this.replaceTopLastChild(e),this.stack.push(e)},replaceTopAndPush:function(e){var t;return this.top()===this.root?t=ensureChildren(this.top()).children:(this.stack.pop(),t=ensureChildren(this.top()).children),t.pop(),t.push(e),this.stack.push(e),e}});var convertKeyToLookup=function(e){var t=e.lastIndexOf("./"),r=e.lastIndexOf(".");if(r>t)return e.substr(0,r)+"@"+e.substr(r+1);var o=-1===t?0:t+2,s=e.charAt(o);return"."===s||"@"===s?e.substr(0,o)+"@"+e.substr(o+1):e.substr(0,o)+"@"+e.substr(o)},convertToAtLookup=function(e){return"Lookup"===e.type&&(canReflect.setKeyValue(e,sourceTextSymbol$2,e.key),e.key=convertKeyToLookup(e.key)),e},convertToHelperIfTopIsLookup=function(e){var t=e.top();if(t&&"Lookup"===t.type){var r=e.stack[e.stack.length-2];"Helper"!==r.type&&r&&e.replaceTopAndPush({type:"Helper",method:t})}},expression={toComputeOrValue:expressionHelpers.toComputeOrValue,convertKeyToLookup:convertKeyToLookup,Literal:literal,Lookup:lookup,Arg:arg,Hash:Hash,Hashes:hashes,Call:call,Helper:helper,Bracket:bracket,SetIdentifier:setIdentifier,tokenize:function(e){var t=[];return(e.trim()+" ").replace(tokensRegExp,function(e,r){bracketSpaceRegExp.test(r)?(t.push(r[0]),t.push(r.slice(1))):t.push(r)}),t},lookupRules:{default:function(e,t,r){return"Helper"===e.type?helper:lookup},method:function(e,t,r){return lookup}},methodRules:{default:function(e){return"Call"===e.type?call:helper},call:function(e){return call}},parse:function(e,t){t=t||{};var r=this.ast(e);return t.lookupRule||(t.lookupRule="default"),"string"==typeof t.lookupRule&&(t.lookupRule=expression.lookupRules[t.lookupRule]),t.methodRule||(t.methodRule="default"),"string"==typeof t.methodRule&&(t.methodRule=expression.methodRules[t.methodRule]),this.hydrateAst(r,t,t.baseMethodType||"Helper")},hydrateAst:function(e,t,r,o){var s,n;if("Lookup"===e.type)return new(t.lookupRule(e,r,o))(e.key,e.root&&this.hydrateAst(e.root,t,r),e[sourceTextSymbol$2]);if("Literal"===e.type)return new literal(e.value);if("Arg"===e.type)return new arg(this.hydrateAst(e.children[0],t,r,o),{compute:!0});if("Hash"===e.type)throw new Error("");if("Hashes"===e.type)return s={},e.children.forEach(function(e){s[e.prop]=this.hydrateAst(e.children[0],t,r,!0)},this),new hashes(s);if("Call"===e.type||"Helper"===e.type){s={};var a=[],i=e.children,p=t.methodRule(e);if(i)for(var l=0;l<i.length;l++){var c=i[l];"Hashes"===c.type&&"Helper"===e.type&&p!==call?c.children.forEach(function(r){s[r.prop]=this.hydrateAst(r.children[0],t,e.type,!0)},this):a.push(this.hydrateAst(c,t,e.type,!0))}return new p(this.hydrateAst(e.method,t,e.type),a,s)}return"Bracket"===e.type?("production"!==process$1.env.NODE_ENV&&(n=e[canSymbol.for("can-stache.originalKey")]),new bracket(this.hydrateAst(e.children[0],t),e.root?this.hydrateAst(e.root,t):void 0,n)):void 0},ast:function(e){var t=this.tokenize(e);return this.parseAst(t,{index:0})},parseAst:function(e,t){for(var r,o,s,n=new Stack;t.index<e.length;){var a=e[t.index],i=e[t.index+1];if(t.index++,"="===i){(r=n.top())&&"Lookup"===r.type&&("Call"!==(o=n.firstParent(["Call","Helper","Hash"])).type&&"Root"!==o.type||(n.popUntil(["Call"]),r=n.top(),n.replaceTopAndPush({type:"Helper",method:"Root"===r.type?last(r.children):r})));var p={type:"Hash",prop:a};"Hashes"===(o=n.first(["Call","Helper","Hashes","Root"])).type?n.addToAndPush(["Hashes"],p):(n.addToAndPush(["Helper","Call","Root"],{type:"Hashes",children:[p]}),n.push(p)),t.index++}else if(literalRegExp.test(a))convertToHelperIfTopIsLookup(n),"Hash"===(o=n.first(["Helper","Call","Hash","Bracket"])).type&&o.children&&o.children.length>0?n.addTo(["Helper","Call","Bracket"],{type:"Literal",value:utils.jsonParse(a)}):"Bracket"===o.type&&o.children&&o.children.length>0?n.addTo(["Helper","Call","Hash"],{type:"Literal",value:utils.jsonParse(a)}):n.addTo(["Helper","Call","Hash","Bracket"],{type:"Literal",value:utils.jsonParse(a)});else if(keyRegExp.test(a))s=n.topLastChild(),o=n.first(["Helper","Call","Hash","Bracket"]),s&&("Call"===s.type||"Bracket"===s.type)&&isAddingToExpression(a)?n.replaceTopLastChildAndPush({type:"Lookup",root:s,key:a.slice(1)}):"Bracket"===o.type?o.children&&o.children.length>0?"Helper"===n.first(["Helper","Call","Hash","Arg"]).type&&"."!==a[0]?n.addToAndPush(["Helper"],{type:"Lookup",key:a}):n.replaceTopAndPush({type:"Lookup",key:a.slice(1),root:o}):n.addToAndPush(["Bracket"],{type:"Lookup",key:a}):(convertToHelperIfTopIsLookup(n),n.addToAndPush(["Helper","Call","Hash","Arg","Bracket"],{type:"Lookup",key:a}));else if("~"===a)convertToHelperIfTopIsLookup(n),n.addToAndPush(["Helper","Call","Hash"],{type:"Arg",key:a});else if("("===a){if("Lookup"!==(r=n.top()).type)throw new Error("Unable to understand expression "+e.join(""));n.replaceTopAndPush({type:"Call",method:convertToAtLookup(r)})}else if(")"===a)n.popTo(["Call"]);else if(","===a){"Call"!==n.first(["Call"]).type?n.popUntil(["Hash"]):n.popUntil(["Call"])}else if("["===a)if(r=n.top(),!(s=n.topLastChild())||"Call"!==s.type&&"Bracket"!==s.type)if("Lookup"===r.type||"Bracket"===r.type){var l={type:"Bracket",root:r};"production"!==process$1.env.NODE_ENV&&canReflect.setKeyValue(l,canSymbol.for("can-stache.originalKey"),r.key),n.replaceTopAndPush(l)}else"Call"===r.type?n.addToAndPush(["Call"],{type:"Bracket"}):" "===r?(n.popUntil(["Lookup","Call"]),convertToHelperIfTopIsLookup(n),n.addToAndPush(["Helper","Call","Hash"],{type:"Bracket"})):n.replaceTopAndPush({type:"Bracket"});else n.replaceTopAndPush({type:"Bracket",root:s});else"]"===a?n.pop():" "===a&&n.push(a)}return n.root.children[0]}},expression_1=expression;export{canViewScope as a,setter as b,utils as c,expression_1 as d,setIdentifier as e,keyObservable as f};
//# sourceMappingURL=chunk-615ab838.js.map
