import{a as process$1}from"./chunk-bacf0c54.mjs";import{a as commonjsGlobal,b as commonjsRequire,c as unwrapExports,d as createCommonjsModule}from"./chunk-eae5b219.mjs";import{a as connect}from"./chunk-52b41786.mjs";import"./chunk-5f1245ff.mjs";import{a as require$$0,b as WeakReferenceMap}from"./chunk-4c04edbb.mjs";import{a as canReflect}from"./chunk-7e0220de.mjs";import{a as canLocalStore}from"./chunk-e89b2ed5.mjs";import{a as sortedSetJSON}from"./chunk-6f2a5c16.mjs";import{a as canLog}from"./chunk-a661b1ce.mjs";import"./chunk-fa6b878a.mjs";import{a as constructorStore}from"./chunk-3b983740.mjs";import{a as define}from"./chunk-707fbcc4.mjs";import{a as ObservationRecorder}from"./chunk-8811d387.mjs";var getItems=function(e){return Array.isArray(e)?e:e.data},callbacksCache=createCommonjsModule(function(e){var t=canReflect.assignMap,n=canReflect.each,a={createdData:"createData",updatedData:"updateData",destroyedData:"destroyData"},s=connect.behavior("data/callbacks-cache",function(e){var s={};return n(a,function(n,a){s[a]=function(s,r,c){return this.cacheConnection[n](t(t({},r),s)),e[a]?e[a].call(this,s,r,c):s}}),s});if(e.exports=s,"production"!==process$1.env.NODE_ENV){var r=require$$0;e.exports=r(s,[])}}),deferred=function(){var e={};return e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),e},forEach=[].forEach,combineRequests=connect.behavior("data/combine-requests",function(e){var t;return{unionPendingRequests:function(e){var t=this;e.sort(function(e,n){return t.queryLogic.isSubset(e.set,n.set)?1:t.queryLogic.isSubset(n.set,e.set)?-1:0});var n,a=[];return doubleLoop(e,{start:function(e){n={set:e.set,pendingRequests:[e]},a.push(n)},iterate:function(e){var a=t.queryLogic.union(n.set,e.set);if(t.queryLogic.isDefinedAndHasMembers(a))return n.set=a,n.pendingRequests.push(e),!0}}),Promise.resolve(a)},time:1,getListData:function(n){n=n||{};var a=this;t||(t=[],setTimeout(function(){var n=a.unionPendingRequests(t);t=null,n.then(function(t){forEach.call(t,function(t){var n=canReflect.serialize(t.set);e.getListData(n).then(function(e){1===t.pendingRequests.length?t.pendingRequests[0].deferred.resolve(e):forEach.call(t.pendingRequests,function(n){n.deferred.resolve({data:a.queryLogic.filterMembers(n.set,t.set,getItems(e))})})},function(e){1===t.pendingRequests.length?t.pendingRequests[0].deferred.reject(e):forEach.call(t.pendingRequests,function(t){t.deferred.reject(e)})})})})},this.time||1));var s=deferred();return t.push({deferred:s,set:n}),s.promise}}}),combineRequests_1=combineRequests,doubleLoop=(combineRequests_1=require$$0(combineRequests,["getListData"]),function(e,t){for(var n=0;n<e.length;){t.start(e[n]);for(var a=n+1;a<e.length;)!0===t.iterate(e[a])?e.splice(a,1):a++;n++}}),localstorageCache=canLocalStore,fallThroughCache_1=createCommonjsModule(function(e){var t=connect.behavior("fall-through-cache",function(e){return{hydrateList:function(t,n){n=n||this.listQuery(t);var a=sortedSetJSON(n),s=e.hydrateList.call(this,t,n);return this._getHydrateListCallbacks[a]&&(this._getHydrateListCallbacks[a].shift()(s),this._getHydrateListCallbacks[a].length||delete this._getHydrateListCallbacks[a]),s},_getHydrateListCallbacks:{},_getHydrateList:function(e,t){var n=sortedSetJSON(e);this._getHydrateListCallbacks[n]||(this._getHydrateListCallbacks[n]=[]),this._getHydrateListCallbacks[n].push(t)},getListData:function(t){t=t||{};var n=this;return this.cacheConnection.getListData(t).then(function(a){return n._getHydrateList(t,function(a){n.addListReference(a,t),setTimeout(function(){e.getListData.call(n,t).then(function(e){n.cacheConnection.updateListData(e,t),n.updatedList(a,e,t),n.deleteListReference(a,t)},function(e){canLog.log("REJECTED",e)})},1)}),a},function(){var a=e.getListData.call(n,t);return a.then(function(e){n.cacheConnection.updateListData(e,t)}),a})},hydrateInstance:function(t){var n=this.id(t),a=e.hydrateInstance.apply(this,arguments);return this._getMakeInstanceCallbacks[n]&&(this._getMakeInstanceCallbacks[n].shift()(a),this._getMakeInstanceCallbacks[n].length||delete this._getMakeInstanceCallbacks[n]),a},_getMakeInstanceCallbacks:{},_getMakeInstance:function(e,t){this._getMakeInstanceCallbacks[e]||(this._getMakeInstanceCallbacks[e]=[]),this._getMakeInstanceCallbacks[e].push(t)},getData:function(t){var n=this;return this.cacheConnection.getData(t).then(function(a){return n._getMakeInstance(n.id(a)||n.id(t),function(a){n.addInstanceReference(a),setTimeout(function(){e.getData.call(n,t).then(function(e){n.cacheConnection.updateData(e),n.updatedInstance(a,e),n.deleteInstanceReference(a)},function(e){canLog.log("REJECTED",e)})},1)}),a},function(){var a=e.getData.call(n,t);return a.then(function(e){n.cacheConnection.updateData(e)}),a})}}});if(e.exports=t,"production"!==process$1.env.NODE_ENV){var n=require$$0;e.exports=n(t,["hydrateList","hydrateInstance","getListData","getData"])}}),makeRef=function(e){var t=canReflect.getSchema(e.queryLogic).identity[0],n=function(a,s){"object"==typeof a&&(a=(s=a)[t]);var r=n.store.get(a);if(r)return s&&!r._value&&(s instanceof e.Map?r._value=s:r._value=e.hydrateInstance(s)),r;this[t]=a,s&&(s instanceof e.Map?this._value=s:this._value=e.hydrateInstance(s)),constructorStore.requests.count()>0&&(n._requestInstances[a]||(n.store.addReference(a,this),n._requestInstances[a]=this))};n.store=new WeakReferenceMap,n._requestInstances={},n.type=function(e){return e&&"object"!=typeof e?new n(e):new n(e[t],e)};var a={promise:{get:function(){if(this._value)return Promise.resolve(this._value);var n={};return n[t]=this[t],e.Map.get(n)}},_state:{get:function(e,t){return t&&this.promise.then(function(){t("resolved")},function(){t("rejected")}),"pending"}},value:{get:function(e,t){if(this._value)return this._value;t&&this.promise.then(function(e){t(e)})}},reason:{get:function(e,t){this._value||this.promise.catch(function(e){t(e)})}}};a[t]={type:"*",set:function(){this._value=void 0}},define(n.prototype,a),n.prototype.unobservedId=ObservationRecorder.ignore(function(){return this[t]}),n.prototype.isResolved=function(){return!!this._value||"resolved"===this._state},n.prototype.isRejected=function(){return"rejected"===this._state},n.prototype.isPending=function(){return!this._value&&("resolved"!==this._state||"rejected"!==this._state)},n.prototype.serialize=function(){return this[t]},canReflect.assignSymbols(n.prototype,{"can.serialize":n.prototype.serialize,"can.getName":function(){return canReflect.getName(this.constructor)+"{"+this[t]+"}"}});var s=n.prototype._eventSetup;n.prototype._eventSetup=function(){return n.store.addReference(this.unobservedId(),this),s.apply(this,arguments)};var r=n.prototype._eventTeardown;return n.prototype._eventTeardown=function(){return n.store.deleteReference(this.unobservedId(),this),r.apply(this,arguments)},constructorStore.requests.on("end",function(){for(var e in n._requestInstances)n.store.deleteReference(e);n._requestInstances={}}),Object.defineProperty(n,"name",{value:canReflect.getName(e.Map)+"Ref",configurable:!0}),n},ref=connect.behavior("can/ref",function(e){return{init:function(){e.init.apply(this,arguments),this.Map.Ref=makeRef(this)}}}),combineRequests$1=combineRequests_1;export{getItems as a,ref as b,callbacksCache as c,combineRequests$1 as d,localstorageCache as e,fallThroughCache_1 as f};
//# sourceMappingURL=chunk-9da91868.js.map
