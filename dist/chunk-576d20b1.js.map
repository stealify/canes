{"version":3,"file":"chunk-576d20b1.js","sources":["../node_modules/can-simple-observable/settable/settable.js"],"sourcesContent":["\"use strict\";\nvar canReflect = require(\"can-reflect\");\nvar ObservationRecorder = require(\"can-observation-recorder\");\nvar SimpleObservable = require(\"../can-simple-observable\");\nvar Observation = require(\"can-observation\");\nvar queues = require(\"can-queues\");\nvar log = require(\"../log\");\nvar valueEventBindings = require(\"can-event-queue/value/value\");\n\nvar peek = ObservationRecorder.ignore(canReflect.getValue.bind(canReflect));\n\n// This supports an \"internal\" settable value that the `fn` can derive its value from.\n// It's useful to `can-define`.\n// ```\n// new SettableObservable(function(lastSet){\n//   return lastSet * 5;\n// }, null, 5)\n// ```\nfunction SettableObservable(fn, context, initialValue) {\n\n\tthis.lastSetValue = new SimpleObservable(initialValue);\n\tfunction observe() {\n\t\treturn fn.call(context, this.lastSetValue.get());\n\t}\n\tthis.handler = this.handler.bind(this);\n\n\t//!steal-remove-start\n\tif (process.env.NODE_ENV !== 'production') {\n\t\tcanReflect.assignSymbols(this, {\n\t\t\t\"can.getName\": function() {\n\t\t\t\treturn (\n\t\t\t\t\tcanReflect.getName(this.constructor) +\n\t\t\t\t\t\"<\" +\n\t\t\t\t\tcanReflect.getName(fn) +\n\t\t\t\t\t\">\"\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(this.handler, \"name\", {\n\t\t\tvalue: canReflect.getName(this) + \".handler\"\n\t\t});\n\t\tObject.defineProperty(observe, \"name\", {\n\t\t\tvalue: canReflect.getName(fn) + \"::\" + canReflect.getName(this.constructor)\n\t\t});\n\t}\n\t//!steal-remove-end\n\n\tthis.observation = new Observation(observe, this);\n}\n\nvalueEventBindings(SettableObservable.prototype);\n\ncanReflect.assignMap(SettableObservable.prototype, {\n\t// call `obs.log()` to log observable changes to the browser console\n\t// The observable has to be bound for `.log` to be called\n\tlog: log,\n\tconstructor: SettableObservable,\n\thandler: function(newVal) {\n\t\tvar old = this._value, reasonLog;\n\t\tthis._value = newVal;\n\n\t\t//!steal-remove-start\n\t\tif (process.env.NODE_ENV !== 'production') {\n\t\t\tif (typeof this._log === \"function\") {\n\t\t\t\tthis._log(old, newVal);\n\t\t\t}\n\t\t\treasonLog = [canReflect.getName(this),\"set to\", newVal, \"from\", old];\n\t\t}\n\t\t//!steal-remove-end\n\n\t\t// adds callback handlers to be called w/i their respective queue.\n\t\tqueues.enqueueByQueue(\n\t\t\tthis.handlers.getNode([]),\n\t\t\tthis,\n\t\t\t[newVal, old],\n\t\t\tnull,\n\t\t\treasonLog\n\t\t);\n\t},\n\tonBound: function() {\n\t\t// onBound can be called by `.get` and then later called through\n\t\t// a keyTree binding.\n\t\tif(!this.bound) {\n\t\t\tthis.bound = true;\n\t\t\tthis.activate();\n\t\t}\n\t},\n\tactivate: function(){\n\t\tcanReflect.onValue(this.observation, this.handler, \"notify\");\n\t\tthis._value = peek(this.observation);\n\t},\n\tonUnbound: function() {\n\t\tthis.bound = false;\n\t\tcanReflect.offValue(this.observation, this.handler, \"notify\");\n\t},\n\tset: function(newVal) {\n\t\tvar oldVal =  this.lastSetValue.get();\n\n\t\tif (\n\t\t\tcanReflect.isObservableLike(oldVal) &&\n\t\t\tcanReflect.isValueLike(oldVal) &&\n\t\t\t!canReflect.isObservableLike(newVal)\n\t\t) {\n\t\t\tcanReflect.setValue(oldVal, newVal);\n\t\t} else {\n\t\t\tif (newVal !== oldVal) {\n\t\t\t\tthis.lastSetValue.set(newVal);\n\t\t\t}\n\t\t}\n\t},\n\tget: function() {\n\t\tif (ObservationRecorder.isRecording()) {\n\t\t\tObservationRecorder.add(this);\n\t\t\tif (!this.bound) {\n\t\t\t\t// proactively setup bindings\n\t\t\t\tthis.onBound();\n\t\t\t}\n\t\t}\n\n\t\tif (this.bound === true) {\n\t\t\treturn this._value;\n\t\t} else {\n\t\t\treturn this.observation.get();\n\t\t}\n\t},\n\thasDependencies: function() {\n\t\treturn canReflect.valueHasDependencies(this.observation);\n\t},\n\tgetValueDependencies: function() {\n\t\treturn canReflect.getValueDependencies(this.observation);\n\t}\n});\n\nObject.defineProperty(SettableObservable.prototype,\"value\",{\n\tset: function(value){\n\t\treturn this.set(value);\n\t},\n\tget: function(){\n\t\treturn this.get();\n\t}\n});\n\ncanReflect.assignSymbols(SettableObservable.prototype, {\n\t\"can.getValue\": SettableObservable.prototype.get,\n\t\"can.setValue\": SettableObservable.prototype.set,\n\t\"can.isMapLike\": false,\n\t\"can.getPriority\": function() {\n\t\treturn canReflect.getPriority(this.observation);\n\t},\n\t\"can.setPriority\": function(newPriority) {\n\t\tcanReflect.setPriority(this.observation, newPriority);\n\t},\n\t\"can.valueHasDependencies\": SettableObservable.prototype.hasDependencies,\n\t\"can.getValueDependencies\": SettableObservable.prototype.getValueDependencies\n});\n\nmodule.exports = SettableObservable;\n"],"names":["peek","ObservationRecorder","ignore","canReflect","getValue","bind","SettableObservable","fn","context","initialValue","observe","call","this","lastSetValue","get","SimpleObservable","handler","process","env","NODE_ENV","assignSymbols","can.getName","getName","constructor","Object","defineProperty","value","observation","Observation","valueEventBindings","prototype","assignMap","log","newVal","reasonLog","old","_value","_log","queues","enqueueByQueue","handlers","getNode","onBound","bound","activate","onValue","onUnbound","offValue","set","oldVal","isObservableLike","isValueLike","setValue","isRecording","add","hasDependencies","valueHasDependencies","getValueDependencies","can.getValue","can.setValue","can.isMapLike","can.getPriority","getPriority","can.setPriority","newPriority","setPriority","can.valueHasDependencies","can.getValueDependencies"],"mappings":"giBASA,IAAIA,KAAOC,oBAAoBC,OAAOC,WAAWC,SAASC,KAAKF,aAS/D,SAASG,mBAAmBC,EAAIC,EAASC,GAGxC,SAASC,IACR,OAAOH,EAAGI,KAAKH,EAASI,KAAKC,aAAaC,OAF3CF,KAAKC,aAAe,IAAIE,iBAAiBN,GAIzCG,KAAKI,QAAUJ,KAAKI,QAAQX,KAAKO,MAGJ,eAAzBK,UAAQC,IAAIC,WACfhB,WAAWiB,cAAcR,KAAM,CAC9BS,cAAe,WACd,OACClB,WAAWmB,QAAQV,KAAKW,aACxB,IACApB,WAAWmB,QAAQf,GACnB,OAIHiB,OAAOC,eAAeb,KAAKI,QAAS,OAAQ,CAC3CU,MAAOvB,WAAWmB,QAAQV,MAAQ,aAEnCY,OAAOC,eAAef,EAAS,OAAQ,CACtCgB,MAAOvB,WAAWmB,QAAQf,GAAM,KAAOJ,WAAWmB,QAAQV,KAAKW,gBAKjEX,KAAKe,YAAc,IAAIC,YAAYlB,EAASE,MAG7CiB,mBAAmBvB,mBAAmBwB,WAEtC3B,WAAW4B,UAAUzB,mBAAmBwB,UAAW,CAGlDE,IAAKA,IACLT,YAAajB,mBACbU,QAAS,SAASiB,GACjB,IAAuBC,EAAnBC,EAAMvB,KAAKwB,OACfxB,KAAKwB,OAASH,EAGe,eAAzBhB,UAAQC,IAAIC,WACU,mBAAdP,KAAKyB,MACfzB,KAAKyB,KAAKF,EAAKF,GAEhBC,EAAY,CAAC/B,WAAWmB,QAAQV,MAAM,SAAUqB,EAAQ,OAAQE,IAKjEG,OAAOC,eACN3B,KAAK4B,SAASC,QAAQ,IACtB7B,KACA,CAACqB,EAAQE,GACT,KACAD,IAGFQ,QAAS,WAGJ9B,KAAK+B,QACR/B,KAAK+B,OAAQ,EACb/B,KAAKgC,aAGPA,SAAU,WACTzC,WAAW0C,QAAQjC,KAAKe,YAAaf,KAAKI,QAAS,UACnDJ,KAAKwB,OAASpC,KAAKY,KAAKe,cAEzBmB,UAAW,WACVlC,KAAK+B,OAAQ,EACbxC,WAAW4C,SAASnC,KAAKe,YAAaf,KAAKI,QAAS,WAErDgC,IAAK,SAASf,GACb,IAAIgB,EAAUrC,KAAKC,aAAaC,MAG/BX,WAAW+C,iBAAiBD,IAC5B9C,WAAWgD,YAAYF,KACtB9C,WAAW+C,iBAAiBjB,GAE7B9B,WAAWiD,SAASH,EAAQhB,GAExBA,IAAWgB,GACdrC,KAAKC,aAAamC,IAAIf,IAIzBnB,IAAK,WASJ,OARIb,oBAAoBoD,gBACvBpD,oBAAoBqD,IAAI1C,MACnBA,KAAK+B,OAET/B,KAAK8B,YAIY,IAAf9B,KAAK+B,MACD/B,KAAKwB,OAELxB,KAAKe,YAAYb,OAG1ByC,gBAAiB,WAChB,OAAOpD,WAAWqD,qBAAqB5C,KAAKe,cAE7C8B,qBAAsB,WACrB,OAAOtD,WAAWsD,qBAAqB7C,KAAKe,gBAI9CH,OAAOC,eAAenB,mBAAmBwB,UAAU,QAAQ,CAC1DkB,IAAK,SAAStB,GACb,OAAOd,KAAKoC,IAAItB,IAEjBZ,IAAK,WACJ,OAAOF,KAAKE,SAIdX,WAAWiB,cAAcd,mBAAmBwB,UAAW,CACtD4B,eAAgBpD,mBAAmBwB,UAAUhB,IAC7C6C,eAAgBrD,mBAAmBwB,UAAUkB,IAC7CY,iBAAiB,EACjBC,kBAAmB,WAClB,OAAO1D,WAAW2D,YAAYlD,KAAKe,cAEpCoC,kBAAmB,SAASC,GAC3B7D,WAAW8D,YAAYrD,KAAKe,YAAaqC,IAE1CE,2BAA4B5D,mBAAmBwB,UAAUyB,gBACzDY,2BAA4B7D,mBAAmBwB,UAAU2B,uBAG1D,aAAiBnD"}