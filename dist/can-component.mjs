import{a as canControl}from"./chunk-d6693ee9.mjs";import"./chunk-5f1245ff.mjs";import{a as canReflect}from"./chunk-7e0220de.mjs";import{a as list}from"./chunk-b9130a6e.mjs";import{a as process$1}from"./chunk-bacf0c54.mjs";import"./chunk-805ffcb4.mjs";import"./chunk-91f0208e.mjs";import{a as Construct,b as require$$0}from"./chunk-a97d251a.mjs";import"./chunk-336f4df9.mjs";import"./chunk-cfd80976.mjs";import"./chunk-ea559428.mjs";import{a as nodeLists}from"./chunk-fd5b3ff3.mjs";import"./chunk-152c0627.mjs";import{a as observeReader}from"./chunk-0877ccb7.mjs";import{a as Scope,b as SetterObservable}from"./chunk-615ab838.mjs";import"./chunk-660b4975.mjs";import"./chunk-bef7c5be.mjs";import"./chunk-dc356f62.mjs";import{a as canLog}from"./chunk-a661b1ce.mjs";import{a as dev}from"./chunk-585d4076.mjs";import"./chunk-bd824939.mjs";import"./chunk-fa6b878a.mjs";import"./chunk-2a7704ed.mjs";import{a as viewCallbacks,b as setData}from"./chunk-c1a50ad2.mjs";import"./chunk-f06d7b20.mjs";import"./chunk-04598776.mjs";import"./chunk-037c51df.mjs";import{a as domMutate}from"./chunk-e442e0a9.mjs";import{a as domMutateNode}from"./chunk-d056b3d5.mjs";import{a as canSymbol}from"./chunk-b37d91a1.mjs";import{a as getDocument}from"./chunk-14877182.mjs";import{a as namespace}from"./chunk-3b4c7b38.mjs";import{a as Bind}from"./chunk-a73c65cc.mjs";import{a as stache}from"./chunk-8f05dc6b.mjs";import{a as stacheBindings}from"./chunk-0ad2b99e.mjs";import{a as SimpleObservable}from"./chunk-65b62c71.mjs";import{a as SimpleMap}from"./chunk-7d5cfef0.mjs";import{a as DefineMap}from"./chunk-65a1c0b6.mjs";import{a as assign}from"./chunk-75bea8d8.mjs";import{a as ObservationRecorder}from"./chunk-8811d387.mjs";import"./chunk-cc261c5e.mjs";import{a as childNodes}from"./chunk-ee0ed326.mjs";import{a as domEvents}from"./chunk-cb75b84f.mjs";import"./chunk-7dfeb1df.mjs";import"./chunk-862b179d.mjs";import"./chunk-eae5b219.mjs";import"./chunk-79943599.mjs";import"./chunk-2c9f11a8.mjs";import"./chunk-b1806013.mjs";import"./chunk-a9b254be.mjs";import"./chunk-12ed728f.mjs";import"./chunk-8d049599.mjs";import"./chunk-d2889630.mjs";import"./chunk-825526fa.mjs";import"./chunk-f8a6947c.mjs";import"./chunk-b09dcf0e.mjs";import"./chunk-c1d5d21e.mjs";import"./chunk-910f3205.mjs";import"./chunk-707fbcc4.mjs";import"./chunk-8a3a072d.mjs";import"./chunk-8f9d5c6d.mjs";import"./chunk-576d20b1.mjs";import"./chunk-b2e1c1d8.mjs";import"./chunk-541940e7.mjs";import"./chunk-321b6aa1.mjs";import"./chunk-3f0a7243.mjs";import"./chunk-072ec069.mjs";import"./chunk-e85142ea.mjs";import"./chunk-cb265e10.mjs";import"./chunk-0c313990.mjs";import"./chunk-0cc812f8.mjs";import"./chunk-6b486a2d.mjs";import"./chunk-fea13b24.mjs";import"./chunk-cc1f8896.mjs";import"./chunk-932cc7dc.mjs";import"./chunk-e7f43bec.mjs";import"./chunk-0d409e0a.mjs";import"./chunk-40f0cd8c.mjs";import"./chunk-faffd3b3.mjs";import"./chunk-8faf33f1.mjs";import"./chunk-bb7c303b.mjs";import"./chunk-3bb7ab49.mjs";import"./chunk-17b31772.mjs";import"./chunk-ac75a622.mjs";import"./chunk-39576e37.mjs";import"./chunk-fb25cf5d.mjs";import"./chunk-185a1a27.mjs";import"./chunk-2b1fdbc0.mjs";var paramReplacer=/\{([^\}]+)\}/g,ComponentControl=canControl.extend({_lookup:function(e){return[e.scope,e,window]},_removeDelegateFromKey:function(e){return e.replace(/^(scope|^viewModel)\./,"")},_isDelegate:function(e,t){return"scope"===t||"viewModel"===t},_getDelegate:function(e,t){return e[t]},_action:function(e,t,o){var n;return paramReplacer.lastIndex=0,n=paramReplacer.test(e),!o&&n?void 0:canControl._action.apply(this,arguments)}},{setup:function(e,t){return this.scope=t.scope,this.viewModel=t.viewModel,canControl.prototype.setup.call(this,e,t)},off:function(){this._bindings&&canReflect.eachKey(this._bindings.readyComputes||{},function(e){canReflect.offValue(e.compute,e.handler)}),canControl.prototype.off.apply(this,arguments),this._bindings.readyComputes={}},destroy:function(){canControl.prototype.destroy.apply(this,arguments),"function"==typeof this.options.destroy&&this.options.destroy.apply(this,arguments)}}),control=ComponentControl,createdByCanComponentSymbol=canSymbol("can.createdByCanComponent"),getValueSymbol=canSymbol.for("can.getValue"),setValueSymbol=canSymbol.for("can.setValue"),viewInsertSymbol=canSymbol.for("can.viewInsert"),viewModelSymbol=canSymbol.for("can.viewModel");function addContext(e,t,o){var n;setData.set.call(e,"preventDataBindings",!0);var i=stacheBindings.behaviors.viewModel(e,o,function(e,t,o){return n=o&&!0===o.isSettingOnViewModel?new SimpleMap(e):new SimpleObservable(e)},void 0,!0);return i?assign(assign({},t),{teardown:i,scope:t.scope.add(n)}):t}function makeInsertionTagCallback(e,t,o,n,i){var s=o.options;return function o(a,r){var c=i(a)||r.subtemplate,p=c!==r.subtemplate;if(c){var d;delete s.tags[e],d=p?n.toLightContent?addContext(a,{scope:r.scope.cloneFromRef(),options:r.options},r):addContext(a,t,r):addContext(a,r,r);var l=nodeLists.register([a],function(){d.teardown&&d.teardown()},r.parentNodeList||!0,r.directlyNested);l.expression="<can-slot name='"+a.getAttribute("name")+"'/>";var u=c(d.scope,d.options,l),m=canReflect.toArray(childNodes(u)),h=nodeLists.update(l,m);nodeLists.replace(h,u),s.tags[e]=o}}}function getSetupFunctionForComponentVM(e){return ObservationRecorder.ignore(function(t,o,n){var i,s=[],a=[];canReflect.eachKey(e,function(e,o){var r=null!=e&&!!e[getValueSymbol],c=null!=e&&!!e[setValueSymbol];if(!0===r||c){var p=observeReader.reads(o),d=new SetterObservable(function(){return observeReader.read(i,p).value},function(e){canReflect.setKeyValue(i,o,e)}),l=new Bind({child:d,parent:e,queue:"domUI",updateChildName:"update viewModel."+o+" of <"+t.nodeName.toLowerCase()+">",updateParentName:"update "+canReflect.getName(e)+" of <"+t.nodeName.toLowerCase()+">"});l.startParent(),!0===r&&(n[o]=l.parentValue),s.push(l.start.bind(l)),a.push(l.stop.bind(l))}else n[o]=e}),i=o(n);for(var r=0,c=s.length;r<c;r++)s[r]();return function(){a.forEach(function(e){e()})}})}stache.addBindings(stacheBindings);var Component=Construct.extend({setup:function(){if(Construct.setup.apply(this,arguments),Component){var e=this;void 0!==this.prototype.events&&0!==canReflect.size(this.prototype.events)&&(this.Control=control.extend(this.prototype.events)),"production"!==process$1.env.NODE_ENV&&this.prototype.viewModel&&canReflect.isConstructorLike(this.prototype.viewModel)&&dev.warn("can-component: Assigning a DefineMap or constructor type to the viewModel property may not be what you intended. Did you mean ViewModel instead? More info: https://canjs.com/doc/can-component.prototype.ViewModel.html");var t=this.prototype.viewModel||this.prototype.scope;if(t&&this.prototype.ViewModel)throw new Error("Cannot provide both a ViewModel and a viewModel property");var o=require$$0.capitalize(require$$0.camelize(this.prototype.tag))+"VM";if(this.prototype.ViewModel?"function"==typeof this.prototype.ViewModel?this.ViewModel=this.prototype.ViewModel:this.ViewModel=DefineMap.extend(o,{},this.prototype.ViewModel):t?"function"==typeof t?canReflect.isObservableLike(t.prototype)&&canReflect.isMapLike(t.prototype)?this.ViewModel=t:this.viewModelHandler=t:canReflect.isObservableLike(t)&&canReflect.isMapLike(t)?("production"!==process$1.env.NODE_ENV&&canLog.warn("can-component: "+this.prototype.tag+" is sharing a single map across all component instances"),this.viewModelInstance=t):(canLog.warn("can-component: "+this.prototype.tag+" is extending the viewModel into a can-simple-map"),this.ViewModel=SimpleMap.extend(o,{},t)):this.ViewModel=SimpleMap.extend(o,{},{}),this.prototype.template&&("production"!==process$1.env.NODE_ENV&&canLog.warn("can-component.prototype.template: is deprecated and will be removed in a future release. Use can-component.prototype.view"),this.renderer=this.prototype.template),this.prototype.view&&(this.renderer=this.prototype.view),"string"==typeof this.renderer){var n=require$$0.capitalize(require$$0.camelize(this.prototype.tag))+"View";this.renderer=stache(n,this.renderer)}viewCallbacks.tag(this.prototype.tag,function(t,o){void 0===t[createdByCanComponentSymbol]&&new e(t,o)})}}},{setup:function(e,t){this._initialArgs=[e,t];var o=this,n={helpers:{},tags:{}};void 0===t&&(void 0===e?t={}:(t=e,e=void 0)),void 0===e&&((e=getDocument().createElement(this.tag))[createdByCanComponentSymbol]=!0),this.element=e;var i=t.content;void 0!==i&&("function"==typeof i?t.subtemplate=i:"string"==typeof i&&(t.subtemplate=stache(i)));var s=t.scope;void 0!==s&&s instanceof Scope==!1&&(t.scope=new Scope(s));var a=t.templates;void 0!==a&&canReflect.eachKey(a,function(e,t){if("string"==typeof e){var o=t+" template";a[t]=stache(o,e)}});var r,c,p,d,l=[],u=function(){for(var e=0,t=l.length;e<t;e++)l[e]()};setData.get.call(e,"preventDataBindings")?r=e[viewModelSymbol]:(d=t.setupBindings?t.setupBindings:t.viewModel?getSetupFunctionForComponentVM(t.viewModel):function(e,o,n){return stacheBindings.behaviors.viewModel(e,t,o,n)},p=d(e,function(n){var i=o.constructor.ViewModel,s=o.constructor.viewModelHandler,a=o.constructor.viewModelInstance;if(s){var c=s.call(o,n,t.scope,e);canReflect.isObservableLike(c)&&canReflect.isMapLike(c)?a=c:i=canReflect.isObservableLike(c.prototype)&&canReflect.isMapLike(c.prototype)?c:SimpleMap.extend(c)}return i&&(a=new o.constructor.ViewModel(n)),r=a,a},{}));if(this.viewModel=r,e[viewModelSymbol]=r,e.viewModel=r,setData.set.call(e,"preventDataBindings",!0),void 0!==this.helpers&&canReflect.eachKey(this.helpers,function(e,t){"function"==typeof e&&(n.helpers[t]=e.bind(r))}),this.constructor.Control)this._control=new this.constructor.Control(e,{scope:this.viewModel,viewModel:this.viewModel,destroy:u});else var m=domMutate.onNodeRemoval(e,function(){var t=e.ownerDocument;(t.contains?t:t.documentElement).contains(e)||(m(),u())});var h,f,b,v,k={toLightContent:!0===this.leakScope,intoShadowContent:!0===this.leakScope};!this.constructor.renderer?(f={scope:t.scope.add(this.viewModel,{viewModel:!0}),options:n},h=t.subtemplate||e.ownerDocument.createDocumentFragment.bind(e.ownerDocument)):(b=k.intoShadowContent?{scope:t.scope.add(this.viewModel,{viewModel:!0}),options:n}:{scope:new Scope(this.viewModel,null,{viewModel:!0}),options:n},n.tags["can-slot"]=makeInsertionTagCallback("can-slot",t,b,k,function(e){var o=t.templates;if(o)return o[e.getAttribute("name")]}),n.tags.content=makeInsertionTagCallback("content",t,b,k,function(){return t.subtemplate}),h=this.constructor.renderer,f=b);var w=nodeLists.register([],function(){o._torndown=!0,domEvents.dispatch(e,"beforeremove",!1),p&&p(),v?v(e):"function"==typeof r.stopListening&&r.stopListening()},t.parentNodeList||!0,!1);if(w.expression="<"+this.tag+">",l.push(function(){nodeLists.unregister(w)}),this.nodeList=w,c=h(f.scope,f.options,w),domMutateNode.appendChild.call(e,c),nodeLists.update(w,childNodes(e)),r&&r.connectedCallback)if(getDocument().body.contains(e))v=r.connectedCallback(e);else var y=domMutate.onNodeInsertion(e,function(){y(),v=r.connectedCallback(e)});o._torndown=!1}});Component.prototype[viewInsertSymbol]=function(e){return this._torndown&&this.setup.apply(this,this._initialArgs),e.nodeList.newDeepChildren.push(this.nodeList),this.element};var canComponent=namespace.Component=Component;export default canComponent;export{canComponent as Component};
//# sourceMappingURL=can-component.js.map
