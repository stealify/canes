import{a as process$1}from"./chunk-bacf0c54.mjs";import{a as dev}from"./chunk-585d4076.mjs";import"./chunk-862b179d.mjs";import"./chunk-5f1245ff.mjs";import{a as canSymbol}from"./chunk-b37d91a1.mjs";import"./chunk-2c9f11a8.mjs";import{b as require$$0}from"./chunk-037c51df.mjs";import{a as mergeDependencyRecords}from"./chunk-a9b254be.mjs";import{a as queues}from"./chunk-12ed728f.mjs";import{a as canReflect}from"./chunk-7e0220de.mjs";import{a as KeyTree}from"./chunk-8d049599.mjs";import{a as domEvents}from"./chunk-cb75b84f.mjs";var legacyMapBindings,isDomEventTarget=require$$0.isDomEventTarget,metaSymbol=canSymbol.for("can.meta"),dispatchBoundChangeSymbol=canSymbol.for("can.dispatchInstanceBoundChange"),dispatchInstanceOnPatchesSymbol=canSymbol.for("can.dispatchInstanceOnPatches"),onKeyValueSymbol=canSymbol.for("can.onKeyValue"),offKeyValueSymbol=canSymbol.for("can.offKeyValue"),onEventSymbol=canSymbol.for("can.onEvent"),offEventSymbol=canSymbol.for("can.offEvent"),onValueSymbol=canSymbol.for("can.onValue"),offValueSymbol=canSymbol.for("can.offValue");function addHandlers(e,n){n.handlers||(n.handlers=new KeyTree([Object,Object,Object,Array],{onFirst:function(){void 0!==e._eventSetup&&e._eventSetup();var n=e.constructor;void 0!==n[dispatchBoundChangeSymbol]&&e instanceof n&&n[dispatchBoundChangeSymbol](e,!0)},onEmpty:function(){void 0!==e._eventTeardown&&e._eventTeardown();var n=e.constructor;void 0!==n[dispatchBoundChangeSymbol]&&e instanceof n&&n[dispatchBoundChangeSymbol](e,!1)}})),n.listenHandlers||(n.listenHandlers=new KeyTree([Map,Map,Object,Array]))}var ensureMeta=function(e){var n=e[metaSymbol];return n||(n={},canReflect.setKeyValue(e,metaSymbol,n)),addHandlers(e,n),n};function stopListeningArgumentsToKeys(e,n,t,a){arguments.length&&canReflect.isPrimitive(e)&&(a=t,t=n,n=e,e=this.context),"function"==typeof n&&(a=t,t=n,n=void 0),"string"==typeof t&&(a=t,t=void 0);var s=[];return e&&(s.push(e),(n||t||a)&&(s.push(n),(a||t)&&(s.push(a||this.defaultQueue),t&&s.push(t)))),s}var map,props={dispatch:function(e,n){if("production"!==process$1.env.NODE_ENV&&(arguments.length>4&&(dev.warn("Arguments to dispatch should be an array, not multiple arguments."),n=Array.prototype.slice.call(arguments,1)),n&&!Array.isArray(n)&&(dev.warn("Arguments to dispatch should be an array."),n=[n])),!this.__inSetup){"string"==typeof e&&(e={type:e});var t=ensureMeta(this);"production"!==process$1.env.NODE_ENV&&(e.reasonLog||(e.reasonLog=[canReflect.getName(this),"dispatched",'"'+e.type+'"',"with"].concat(n))),"function"==typeof t._log&&t._log.call(this,e,n);var a=t.handlers,s=void 0!==e.type&&a.getNode([e.type]),o=e.patches&&this.constructor[dispatchInstanceOnPatchesSymbol],i=void 0!==e.patches&&a.getNode(["can.patches","onKeyValue"]),r=void 0!==e.keyChanged&&a.getNode(["can.keys","onKeyValue"]),u=o||s||i||r;if(u&&queues.batch.start(),s&&(s.onKeyValue&&queues.enqueueByQueue(s.onKeyValue,this,n,e.makeMeta,e.reasonLog),s.event)){e.batchNum=queues.batch.number();var c=[e].concat(n);queues.enqueueByQueue(s.event,this,c,e.makeMeta,e.reasonLog)}r&&queues.enqueueByQueue(r,this,[e.keyChanged],e.makeMeta,e.reasonLog),i&&queues.enqueueByQueue(i,this,[e.patches],e.makeMeta,e.reasonLog),o&&this.constructor[dispatchInstanceOnPatchesSymbol](this,e.patches),u&&queues.batch.stop()}return e},addEventListener:function(e,n,t){return ensureMeta(this).handlers.add([e,"event",t||"mutate",n]),this},removeEventListener:function(e,n,t){if(void 0===e){var a=ensureMeta(this).handlers,s=a.getNode([]);Object.keys(s).forEach(function(e){a.delete([e,"event"])})}else n||t?n?ensureMeta(this).handlers.delete([e,"event",t||"mutate",n]):ensureMeta(this).handlers.delete([e,"event",t||"mutate"]):ensureMeta(this).handlers.delete([e,"event"]);return this},one:function(e,n){var t=function(){return legacyMapBindings.off.call(this,e,t),n.apply(this,arguments)};return legacyMapBindings.on.call(this,e,t),this},listenTo:function(e,n,t,a){return canReflect.isPrimitive(e)&&(a=t,t=n,n=e,e=this),"function"==typeof n&&(a=t,t=n,n=void 0),ensureMeta(this).listenHandlers.add([e,n,a||"mutate",t]),legacyMapBindings.on.call(e,n,t,a||"mutate"),this},stopListening:function(){var e=stopListeningArgumentsToKeys.apply({context:this,defaultQueue:"mutate"},arguments);return ensureMeta(this).listenHandlers.delete(e,function(e,n,t,a){legacyMapBindings.off.call(e,n,a,t)}),this},on:function(e,n,t){if(isDomEventTarget(this))"string"==typeof n?domEvents.addDelegateListener(this,e,n,t):domEvents.addEventListener(this,e,n,t);else if("addEventListener"in this)this.addEventListener(e,n,t);else if(this[onKeyValueSymbol])canReflect.onKeyValue(this,e,n,t);else if(this[onEventSymbol])this[onEventSymbol](e,n,t);else{if(e||!this[onValueSymbol])throw new Error("can-event-queue: Unable to bind "+e);canReflect.onValue(this,n,t)}return this},off:function(e,n,t){if(isDomEventTarget(this))"string"==typeof n?domEvents.removeDelegateListener(this,e,n,t):domEvents.removeEventListener(this,e,n,t);else if("removeEventListener"in this)this.removeEventListener(e,n,t);else if(this[offKeyValueSymbol])canReflect.offKeyValue(this,e,n,t);else if(this[offEventSymbol])this[offEventSymbol](e,n,t);else{if(e||!this[offValueSymbol])throw new Error("can-event-queue: Unable to unbind "+e);canReflect.offValue(this,n,t)}return this}},symbols={"can.onKeyValue":function(e,n,t){ensureMeta(this).handlers.add([e,"onKeyValue",t||"mutate",n])},"can.offKeyValue":function(e,n,t){ensureMeta(this).handlers.delete([e,"onKeyValue",t||"mutate",n])},"can.isBound":function(){return!ensureMeta(this).handlers.isEmpty()},"can.getWhatIChange":function(e){if("production"!==process$1.env.NODE_ENV){var n={},t=ensureMeta(this),a=[].concat(t.handlers.get([e,"event","notify"]),t.handlers.get([e,"onKeyValue","notify"])),s=[].concat(t.handlers.get([e,"event","mutate"]),t.handlers.get([e,"event","domUI"]),t.handlers.get([e,"onKeyValue","mutate"]),t.handlers.get([e,"onKeyValue","domUI"]));return a.length&&a.forEach(function(e){var t=canReflect.getChangesDependencyRecord(e);if(t){var a=n.derive;a||(a=n.derive={}),mergeDependencyRecords(a,t)}}),s.length&&s.forEach(function(e){var t=canReflect.getChangesDependencyRecord(e);if(t){var a=n.mutate;a||(a=n.mutate={}),mergeDependencyRecords(a,t)}}),Object.keys(n).length?n:void 0}},"can.onPatches":function(e,n){ensureMeta(this).handlers.add(["can.patches","onKeyValue",n||"notify",e])},"can.offPatches":function(e,n){ensureMeta(this).handlers.delete(["can.patches","onKeyValue",n||"notify",e])}};function defineNonEnumerable(e,n,t){Object.defineProperty(e,n,{enumerable:!1,value:t})}defineNonEnumerable(legacyMapBindings=function(e){return canReflect.assignMap(e,props),canReflect.assignSymbols(e,symbols)},"addHandlers",addHandlers),defineNonEnumerable(legacyMapBindings,"stopListeningArgumentsToKeys",stopListeningArgumentsToKeys),props.bind=props.addEventListener,props.unbind=props.removeEventListener,canReflect.assignMap(legacyMapBindings,props),canReflect.assignSymbols(legacyMapBindings,symbols),defineNonEnumerable(legacyMapBindings,"start",function(){console.warn("use can-queues.batch.start()"),queues.batch.start()}),defineNonEnumerable(legacyMapBindings,"stop",function(){console.warn("use can-queues.batch.stop()"),queues.batch.stop()}),defineNonEnumerable(legacyMapBindings,"flush",function(){console.warn("use can-queues.flush()"),queues.flush()}),defineNonEnumerable(legacyMapBindings,"afterPreviousEvents",function(e){console.warn("don't use afterPreviousEvents"),queues.mutateQueue.enqueue(function(){queues.mutateQueue.enqueue(e)}),queues.flush()}),defineNonEnumerable(legacyMapBindings,"after",function(e){console.warn("don't use after"),queues.mutateQueue.enqueue(e),queues.flush()});export{legacyMapBindings as a,legacyMapBindings as b};
//# sourceMappingURL=chunk-f8a6947c.js.map
