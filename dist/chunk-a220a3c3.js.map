{"version":3,"file":"chunk-a220a3c3.js","sources":["../node_modules/can-stream-kefir/can-stream-kefir.js"],"sourcesContent":["\"use strict\";\nvar Kefir = require('can-kefir');\nvar compute = require('can-compute');\nvar canStream = require('can-stream');\nvar canSymbol = require('can-symbol');\nvar namespace = require('can-namespace');\n\nvar getValueDependenciesSymbol = canSymbol.for('can.getValueDependencies');\nvar getKeyDependenciesSymbol = canSymbol.for('can.getKeyDependencies');\n\nvar canStreamKefir = {};\n\n/*\n * Converts all arguments passed into a single stream and resolves the resulting\n * streams into a single stream. Assumes all arguments are computes and last\n * argument is optionally a function.\n */\ncanStreamKefir.toStream = function (compute) {\n\tvar stream = Kefir.stream(function (emitter) {\n\t\tvar changeHandler = function (ev, newVal) {\n\t\t\temitter.emit(newVal);\n\t\t};\n\n\t\tcompute.on('change', changeHandler);\n\n\t\tvar currentValue = compute();\n\t\tif(currentValue !== undefined) {\n\t\t\temitter.emit(currentValue);\n\t\t}\n\n\t\treturn function () {\n\t\t\tcompute.off('change', changeHandler);\n\t\t};\n\t});\n\n\tstream[getValueDependenciesSymbol] = function getValueDependencies() {\n\t\treturn {\n\t\t\tvalueDependencies: new Set([compute])\n\t\t};\n\t};\n\n\treturn stream;\n};\n\ncanStreamKefir.toCompute = function(makeStream, context){\n\tvar emitter,\n\t\tlastValue,\n\t\tstreamHandler,\n\t\tlastSetValue;\n\n\tvar setterStream = Kefir.stream(function (e) {\n\t\temitter = e;\n\t\tif (lastSetValue !== undefined) {\n\t\t\temitter.emit(lastSetValue);\n\t\t}\n\t});\n\tvar valueStream = makeStream.call(context, setterStream);\n\n\t// Create a compute that will bind to the resolved stream when bound\n\tvar streamCompute = compute(undefined, {\n\t\t// When the compute is read, use that last value\n\t\tget: function () {\n\t\t\treturn lastValue;\n\t\t},\n\t\tset: function (val) {\n\t\t\tif(emitter) {\n\t\t\t\temitter.emit(val);\n\t\t\t} else {\n\t\t\t\tlastSetValue = val;\n\t\t\t}\n\t\t\treturn val;\n\t\t},\n\n\t\t// When the compute is bound, bind to the resolved stream\n\t\ton: function (updated) {\n\n\t\t\t// When the stream passes a new values, save a reference to it and call\n\t\t\t// the compute's internal `updated` method (which ultimately calls `get`)\n\t\t\tstreamHandler = function (val) {\n\t\t\t\tlastValue = val;\n\t\t\t\tupdated();\n\t\t\t};\n\t\t\tvalueStream.onValue(streamHandler);\n\t\t},\n\n\t\t// When the compute is unbound, unbind from the resolved stream\n\t\toff: function () {\n\t\t\tvalueStream.offValue(streamHandler);\n\t\t}\n\t});\n\n\t// the symbol should ideally be implemented in the compute wrapper instead of\n\t// the internal instance, this should be fixed once can-compute is removed\n\tvar _compute = streamCompute.computeInstance;\n\t_compute[getKeyDependenciesSymbol] = function getKeyDependencies(key) {\n\t\tif (key === 'change') {\n\t\t\treturn {\n\t\t\t\tvalueDependencies: new Set([valueStream])\n\t\t\t};\n\t\t}\n\t};\n\n\treturn streamCompute;\n};\n\nif (!namespace.streamKefir) {\n\t/*\n\t * Exposes a simple toStream method that takes an observable and event or propname and returns a Kefir stream object\n\t */\n\tmodule.exports = namespace.streamKefir = canStream(canStreamKefir);\n}\n\n"],"names":["getValueDependenciesSymbol","canSymbol","for","getKeyDependenciesSymbol","canStreamKefir","toStream","compute","stream","Kefir","emitter","changeHandler","ev","newVal","emit","on","currentValue","undefined","off","valueDependencies","Set","toCompute","makeStream","context","lastValue","streamHandler","lastSetValue","setterStream","e","valueStream","call","streamCompute","get","set","val","updated","onValue","offValue","computeInstance","key","namespace","streamKefir","module","canStream"],"mappings":"kdAOA,IAAIA,EAA6BC,UAAUC,IAAI,4BAC3CC,EAA2BF,UAAUC,IAAI,0BAEzCE,EAAiB,CAOrBC,SAA0B,SAAUC,GACnC,IAAIC,EAASC,SAAMD,OAAO,SAAUE,GACnC,IAAIC,EAAgB,SAAUC,EAAIC,GACjCH,EAAQI,KAAKD,IAGdN,EAAQQ,GAAG,SAAUJ,GAErB,IAAIK,EAAeT,IAKnB,YAJoBU,IAAjBD,GACFN,EAAQI,KAAKE,GAGP,WACNT,EAAQW,IAAI,SAAUP,MAUxB,OANAH,EAAOP,GAA8B,WACpC,MAAO,CACNkB,kBAAmB,IAAIC,IAAI,CAACb,MAIvBC,GAGRa,UAA2B,SAASC,EAAYC,GAC/C,IAAIb,EACHc,EACAC,EACAC,EAEGC,EAAelB,SAAMD,OAAO,SAAUoB,GACzClB,EAAUkB,OACWX,IAAjBS,GACHhB,EAAQI,KAAKY,KAGXG,EAAcP,EAAWQ,KAAKP,EAASI,GAGvCI,EAAgBxB,aAAQU,EAAW,CAEtCe,IAAK,WACJ,OAAOR,GAERS,IAAK,SAAUC,GAMd,OALGxB,EACFA,EAAQI,KAAKoB,GAEbR,EAAeQ,EAETA,GAIRnB,GAAI,SAAUoB,GAIbV,EAAgB,SAAUS,GACzBV,EAAYU,EACZC,KAEDN,EAAYO,QAAQX,IAIrBP,IAAK,WACJW,EAAYQ,SAASZ,MAevB,OATeM,EAAcO,gBACpBlC,GAA4B,SAA4BmC,GAChE,GAAY,WAARA,EACH,MAAO,CACNpB,kBAAmB,IAAIC,IAAI,CAACS,MAKxBE,IAGHS,UAAUC,cAIdC,UAAiBF,UAAUC,YAAcE,UAAUtC"}