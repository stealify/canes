{"version":3,"file":"can-view-autorender.js","sources":["../node_modules/can-view-autorender/can-view-autorender.js"],"sourcesContent":["var namespace = require(\"can-namespace\");\nvar canViewModel = require(\"can-view-model\");\nvar canReflect = require(\"can-reflect\");\nvar camelize = require(\"can-string\").camelize;\nvar load = require(\"can-import-module\");\nvar domEvents = require(\"can-dom-events\");\n\nvar ignoreAttributesRegExp = /^(dataViewId|class|id|type|src)$/i;\n\nvar typeMatch = /\\s*text\\/(stache)\\s*/;\nfunction isIn(element, type) {\n\twhile(element.parentNode) {\n\t\telement = element.parentNode;\n\t\tif(element.nodeName.toLowerCase() === type.toLowerCase()) {\n\t\t\treturn true;\n\t\t}\n\t}\n}\nfunction setAttr(el, attr, scope){\n\tvar camelized = camelize(attr);\n\tif (!ignoreAttributesRegExp.test(camelized) ) {\n\t\tvar value = el.getAttribute(attr);\n\t\tif(scope.attr) {\n\t\t\tscope.attr(camelized, value);\n\t\t} else if(scope.set) {\n\t\t\tscope.set(camelized, value);\n\t\t} else {\n\t\t\tscope[camelized] = value;\n\t\t}\n\t}\n}\nfunction insertAfter(ref, element) {\n\tif(ref.nextSibling){\n\t\tref.parentNode.insertBefore(element, ref.nextSibling);\n\t} else {\n\t\tref.parentNode.appendChild(element);\n\t}\n}\n\nfunction render(renderer, scope, el) {\n\tvar frag = renderer(scope);\n\tif( isIn(el, \"head\") ) {\n\t\tdocument.body.appendChild(frag);\n\t} else if(el.nodeName.toLowerCase() === \"script\") {\n\t\tinsertAfter(el, frag);\n\t} else {\n\t\tinsertAfter(el, frag);\n\t\tel.parentNode.removeChild(el);\n\t}\n}\nfunction setupScope(el) {\n\tvar scope = canViewModel(el);\n\n\tcanReflect.each(el.attributes || [], function(attr) {\n\t\tsetAttr(el, attr.name, scope);\n\t});\n\n\tdomEvents.addEventListener(el, \"attributes\", function(ev) {\n\t\tsetAttr(el, ev.attributeName, scope);\n\t});\n\n\treturn scope;\n}\n\nvar promise = new Promise(function(resolve, reject) {\n\tfunction autoload(){\n\t\tvar promises = [];\n\n\t\tcanReflect.each(document.querySelectorAll(\"[can-autorender]\"), function( el, i){\n\t\t\tel.style.display = \"none\";\n\n\t\t\tvar text = el.innerHTML || el.text,\n\t\t\t\ttypeAttr = el.getAttribute(\"type\"),\n\t\t\t\ttypeInfo = typeAttr.match( typeMatch ),\n\t\t\t\ttype = typeInfo && typeInfo[1],\n\t\t\t\ttypeModule = \"can-\" + type;\n\n\t\t\tpromises.push(load(typeModule).then(function(engine){\n\t\t\t\tif(engine.async) {\n\t\t\t\t\treturn engine.async(text).then(function(renderer){\n\t\t\t\t\t\trender(renderer, setupScope(el), el);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tvar renderer = engine(text);\n\t\t\t\t\trender(renderer, setupScope(el), el);\n\t\t\t\t}\n\t\t\t}));\n\n\t\t});\n\n\t\tPromise.all(promises).then(resolve, reject);\n\t}\n\n\tif (document.readyState === \"complete\") {\n\t\tautoload();\n\t} else {\n\t\tdomEvents.addEventListener(window, \"load\", autoload);\n\t}\n});\n\nmodule.exports = namespace.autorender = function autorender(success, error){\n\treturn promise.then(success, error);\n};\n"],"names":["camelize","require$$0","ignoreAttributesRegExp","typeMatch","isIn","element","type","parentNode","nodeName","toLowerCase","setAttr","el","attr","scope","camelized","test","value","getAttribute","set","insertAfter","ref","nextSibling","insertBefore","appendChild","render","renderer","frag","document","body","removeChild","setupScope","canViewModel","canReflect","each","attributes","name","domEvents","addEventListener","ev","attributeName","promise","Promise","resolve","reject","autoload","promises","querySelectorAll","i","style","display","text","innerHTML","typeInfo","match","typeModule","push","load","then","engine","async","all","readyState","window","namespace","autorender","success","error"],"mappings":"49BAGA,IAAIA,SAAWC,WAAsBD,SAIjCE,uBAAyB,oCAEzBC,UAAY,uBAChB,SAASC,KAAKC,EAASC,GACtB,KAAMD,EAAQE,YAEb,IADAF,EAAUA,EAAQE,YACPC,SAASC,gBAAkBH,EAAKG,cAC1C,OAAO,EAIV,SAASC,QAAQC,EAAIC,EAAMC,GAC1B,IAAIC,EAAYd,SAASY,GACzB,IAAKV,uBAAuBa,KAAKD,GAAa,CAC7C,IAAIE,EAAQL,EAAGM,aAAaL,GACzBC,EAAMD,KACRC,EAAMD,KAAKE,EAAWE,GACbH,EAAMK,IACfL,EAAMK,IAAIJ,EAAWE,GAErBH,EAAMC,GAAaE,GAItB,SAASG,YAAYC,EAAKf,GACtBe,EAAIC,YACND,EAAIb,WAAWe,aAAajB,EAASe,EAAIC,aAEzCD,EAAIb,WAAWgB,YAAYlB,GAI7B,SAASmB,OAAOC,EAAUZ,EAAOF,GAChC,IAAIe,EAAOD,EAASZ,GAChBT,KAAKO,EAAI,QACZgB,SAASC,KAAKL,YAAYG,GACa,WAA9Bf,EAAGH,SAASC,cACrBU,YAAYR,EAAIe,IAEhBP,YAAYR,EAAIe,GAChBf,EAAGJ,WAAWsB,YAAYlB,IAG5B,SAASmB,WAAWnB,GACnB,IAAIE,EAAQkB,aAAapB,GAUzB,OARAqB,WAAWC,KAAKtB,EAAGuB,YAAc,GAAI,SAAStB,GAC7CF,QAAQC,EAAIC,EAAKuB,KAAMtB,KAGxBuB,UAAUC,iBAAiB1B,EAAI,aAAc,SAAS2B,GACrD5B,QAAQC,EAAI2B,EAAGC,cAAe1B,KAGxBA,EAGR,IAAI2B,QAAU,IAAIC,QAAQ,SAASC,EAASC,GAC3C,SAASC,IACR,IAAIC,EAAW,GAEfb,WAAWC,KAAKN,SAASmB,iBAAiB,oBAAqB,SAAUnC,EAAIoC,GAC5EpC,EAAGqC,MAAMC,QAAU,OAEnB,IAAIC,EAAOvC,EAAGwC,WAAaxC,EAAGuC,KAE7BE,EADWzC,EAAGM,aAAa,QACPoC,MAAOlD,WAE3BmD,EAAa,QADNF,GAAYA,EAAS,IAG7BP,EAASU,KAAKC,KAAKF,GAAYG,KAAK,SAASC,GAC5C,GAAGA,EAAOC,MACT,OAAOD,EAAOC,MAAMT,GAAMO,KAAK,SAAShC,GACvCD,OAAOC,EAAUK,WAAWnB,GAAKA,KAIlCa,OADekC,EAAOR,GACLpB,WAAWnB,GAAKA,QAMpC8B,QAAQmB,IAAIf,GAAUY,KAAKf,EAASC,GAGT,aAAxBhB,SAASkC,WACZjB,IAEAR,UAAUC,iBAAiByB,OAAQ,OAAQlB,uBAI5BmB,UAAUC,WAAa,SAAoBC,EAASC,GACpE,OAAO1B,QAAQiB,KAAKQ,EAASC"}