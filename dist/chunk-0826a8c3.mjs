import{a as canSymbol}from"./chunk-b37d91a1.mjs";import"./chunk-5f1245ff.mjs";import{a as canReflect}from"./chunk-7e0220de.mjs";import"./chunk-bd824939.mjs";import{a as get}from"./chunk-b09dcf0e.mjs";import{a as assign}from"./chunk-75bea8d8.mjs";import"./chunk-b1806013.mjs";import{a as defineLazyValue}from"./chunk-d2889630.mjs";import{a as process$1}from"./chunk-bacf0c54.mjs";import{a as dev}from"./chunk-585d4076.mjs";var set,addSerializeToThis=function(e){return canReflect.assignSymbols(e,{"can.serialize":function(){return this}})};function reverseArgs(e){return function(n,t){return e.call(this,t,n)}}var setComparisonsSymbol=canSymbol.for("can.setComparisons");function addComparators(e,n,t){var r=e[setComparisonsSymbol];e[setComparisonsSymbol]||(r=e[setComparisonsSymbol]=new Map);var s=r.get(e);s||(s=new Map,r.set(e,s));var i=s.get(n);if(i)for(var a in t)i.hasOwnProperty(a)&&console.warn("Overwriting "+e.name+" "+a+" "+n.name+" comparitor"),i[a]=t[a];else s.set(n,t)}function Identity(){}var typeMap={number:Identity,string:Identity,undefined:Identity,boolean:Identity},get$1={};function identityIntersection(e,n){return e===n?e:set.EMPTY}function identityDifference(e,n){return e===n?set.EMPTY:e}function identityUnion(e,n){return e===n?e:set.UNDEFINABLE}["intersection","difference","union"].forEach(function(e){get$1[e]=function(n,t,r){if(r===set.UNIVERSAL){if("intersection"===e)return t;if("union"===e)return set.UNIVERSAL;if("difference"===e)return set.EMPTY}if(t===set.UNIVERSAL){if("intersection"===e)return t;if("union"===e)return set.UNIVERSAL}if(n&&n[e]){var s=n[e](t,r);return void 0===s&&!0===n.undefinedIsEmptySet?set.EMPTY:s}throw new Error("Unable to perform "+e+" between "+set.getType(t).name+" and "+set.getType(r).name)}});var identityComparitor={intersection:identityIntersection,difference:identityDifference,union:identityUnion};(set={UNIVERSAL:canReflect.assignSymbols({name:"UNIVERSAL"},{"can.serialize":function(){return this},"can.isMember":function(){return!0}}),EMPTY:canReflect.assignSymbols({name:"EMPTY"},{"can.serialize":function(){return this},"can.isMember":function(){return!1}}),UNDEFINABLE:addSerializeToThis({name:"UNDEFINABLE"}),UNKNOWABLE:addSerializeToThis({name:"UNKNOWABLE"}),Identity:Identity,isSpecial:function(e){return e===set.UNIVERSAL||e===set.EMPTY||e===set.UNDEFINABLE||e===set.UNKNOWABLE},isDefinedAndHasMembers:function(e){return e!==set.EMPTY&&e!==set.UNDEFINABLE&&e!==set.UNKNOWABLE&&e},getType:function(e){return e===set.UNIVERSAL?set.UNIVERSAL:e===set.EMPTY?set.EMPTY:e===set.UNKNOWABLE?set.UNKNOWABLE:null===e?Identity:typeMap.hasOwnProperty(typeof e)?typeMap[typeof e]:e.constructor},ownAndMemberValue:function(e,n){if(null!=e||null!=n){var t=null!=e?e.valueOf():e,r=null!=n?n.valueOf():n;return null==e||null==n?{own:t,member:r}:(t.constructor!==r.constructor&&(r=new e.constructor(r).valueOf()),{own:t,member:r})}return{own:n,member:e}},getComparisons:function(e,n){var t=e[setComparisonsSymbol];if(t){var r=t.get(e);if(r)return r.get(n)}},hasComparisons:function(e){return!!e[setComparisonsSymbol]},defineComparison:function(e,n,t){if(addComparators(e,n,t),e!==n){var r={};for(var s in t)"difference"!==s&&(r[s]=reverseArgs(t[s]));addComparators(n,e,r)}},isSubset:function(e,n){if(e===n)return!0;var t=set.getType(e),r=set.getType(n),s=set.getComparisons(t,r);if(s){var i=get$1.intersection(s,e,n),a=get$1.difference(s,e,n);return i===set.UNKNOWABLE||a===set.UNKNOWABLE?void 0:i!==set.EMPTY&&a===set.EMPTY}throw new Error("Unable to perform subset comparison between "+t.name+" and "+r.name)},isProperSubset:function(e,n){return set.isSubset(e,n)&&!set.isEqual(e,n)},isEqual:function(e,n){if(e===set.UNKNOWABLE||n===set.UNKNOWABLE)return set.UNKNOWABLE;var t=set.isSpecial(e),r=set.isSpecial(n);if(t&&r)return t===r;var s=set.getType(e),i=set.getType(n);if(e===n)return!0;var a=set.getComparisons(s,i),u=set.getComparisons(i,s);if(a&&u){var o=get$1.intersection(a,e,n),c=get$1.difference(a,e,n);if(o!==set.EMPTY&&c===set.EMPTY){var f=get$1.intersection(u,n,e),l=get$1.difference(u,n,e);return f!==set.EMPTY&&l===set.EMPTY}return!1}var m=set.ownAndMemberValue(e,n);if(canReflect.isPrimitive(m.own)&&canReflect.isPrimitive(m.member))return m.own===m.member;throw new Error("Unable to perform equal comparison between "+s.name+" and "+i.name)},union:function(e,n){if(e===set.UNIVERSAL||n===set.UNIVERSAL)return set.UNIVERSAL;if(e===set.EMPTY)return n;if(n===set.EMPTY)return e;if(e===set.UNKNOWABLE||n===set.UNKNOWABLE)return set.UNKNOWABLE;var t=set.getType(e),r=set.getType(n),s=set.getComparisons(t,r);return get$1.union(s,e,n)},intersection:function(e,n){if(e===set.UNIVERSAL)return n;if(n===set.UNIVERSAL)return e;if(e===set.EMPTY||n===set.EMPTY)return set.EMPTY;if(e===set.UNKNOWABLE||n===set.UNKNOWABLE)return set.UNKNOWABLE;var t=set.getType(e),r=set.getType(n),s=set.getComparisons(t,r);if(s)return get$1.intersection(s,e,n);throw new Error("Unable to perform intersection comparison between "+t.name+" and "+r.name)},difference:function(e,n){if(e===set.EMPTY)return set.EMPTY;if(n===set.EMPTY)return e;if(e===set.UNKNOWABLE||n===set.UNKNOWABLE)return set.UNKNOWABLE;var t=set.getType(e),r=set.getType(n),s=set.getComparisons(t,r);if(s)return get$1.difference(s,e,n);throw new Error("Unable to perform difference comparison between "+t.name+" and "+r.name)},indexWithEqual:function(e,n){for(var t=0,r=e.length;t<r;t++)if(set.isEqual(e[t],n))return t;return-1}}).defineComparison(Identity,Identity,identityComparitor),set.defineComparison(set.UNIVERSAL,set.UNIVERSAL,identityComparitor);var set_1=set;function getValue(e){return null==e?e:e.valueOf()}var arrayUnionIntersectionDifference=function(e,n){var t=new Set,r=[],s=[],i=e.slice(0);return e.forEach(function(e){t.add(getValue(e)),s.push(e)}),n.forEach(function(e){if(t.has(getValue(e))){r.push(e);var n=set_1.indexWithEqual(i,e);-1!==n&&i.splice(n,1)}else s.push(e)}),{intersection:r,union:s,difference:i}},isMemberSymbol=canSymbol.for("can.isMember"),comparisons={In:function(e){this.values=e},NotIn:function(e){this.values=e},GreaterThan:function(e){this.value=e},GreaterThanEqual:function(e){this.value=e},LessThan:function(e){this.value=e},LessThanEqual:function(e){this.value=e},And:function(e){this.values=e},Or:function(e){this.values=e}};function nullIsFalse(e){return function(n,t){return null!=n&&null!=t&&e(n,t)}}function nullIsFalseTwoIsOk(e){return function(n,t){return n===t||null!=n&&null!=t&&e(n,t)}}function isMemberThatUsesTest(e){var n=set_1.ownAndMemberValue(this.value,e);return this.constructor.test(n.member,n.own)}function isMemberThatUsesTestOnValues(e){return this.constructor.test(this.values,e)}function makeNot(e){return{test:function(n,t){return!e.test(n,t)}}}function makeEnum(e,n,t){return function(r,s){var i=arrayUnionIntersectionDifference(r.values,s.values);return i[e].length?new n(i[e]):t||set_1.EMPTY}}function swapArgs(e){return function(n,t){return e(t,n)}}function makeSecondValue(e,n){return function(t,r){return new e(r[n||"value"])}}function returnBiggerValue(e,n){return e.value<n.value?n:e}function returnSmallerValue(e,n){return e.value>n.value?n:e}function makeAndIf(e,n){return function(t,r){return e.test(t.value,r.value)?makeAnd([t,new n(r.value)]):set_1.EMPTY}}function make_InIfEqual_else_andIf(e,n){var t=makeAndIf(e,n);return function(e,n){return e.value===n.value?new is.In([e.value]):t(e,n)}}function make_filterFirstValueAgainstSecond(e,n,t){return function(r,s){var i=r.values.filter(function(n){return e.test(s,n)});return i.length?new n(i):t||set_1.EMPTY}}comparisons.Or.prototype.orValues=function(){return this.values},comparisons.In.test=function(e,n){return e.some(function(e){var t=set_1.ownAndMemberValue(e,n);return t.own===t.member})},comparisons.NotIn.test=function(e,n){return!comparisons.In.test(e,n)},comparisons.NotIn.testValue=function(e,n){return!comparisons.In.testValue(e,n)},comparisons.GreaterThan.test=nullIsFalse(function(e,n){return e>n}),comparisons.GreaterThanEqual.test=nullIsFalseTwoIsOk(function(e,n){return e>=n}),comparisons.LessThan.test=nullIsFalse(function(e,n){return e<n}),comparisons.LessThanEqual.test=nullIsFalseTwoIsOk(function(e,n){return e<=n}),[comparisons.GreaterThan,comparisons.GreaterThanEqual,comparisons.LessThan,comparisons.LessThanEqual,comparisons.LessThan].forEach(function(e){e.prototype.isMember=isMemberThatUsesTest}),[comparisons.In,comparisons.NotIn].forEach(function(e){e.prototype.isMember=isMemberThatUsesTestOnValues}),comparisons.And.prototype.isMember=function(e){return this.values.every(function(n){return n.isMember(e)})},comparisons.Or.prototype.isMember=function(e){return this.values.some(function(n){return n.isMember(e)})},Object.keys(comparisons).forEach(function(e){comparisons[e].prototype[isMemberSymbol]=comparisons[e].prototype.isMember});var isMemberTest={test:function(e,n){return e.isMember(n)}};function isOr(e){return e instanceof is.Or}function isAnd(e){return e instanceof is.And}function isAndOrOr(e){return isAnd(e)||isOr(e)}function combineFilterFirstValuesAgainstSecond(e){return function(n,t){var r,s=n.values.filter(function(n){return e.values.test(t,n)});return r=e.complement?set_1.difference(set_1.UNIVERSAL,t):e.with?new e.with(t.value):t,s.length?e.combinedUsing([new e.arePut(s),r]):r}}function makeOrUnless(e,n){return function(t,r){return e.test(t.value,r.value)?n||set_1.UNIVERSAL:makeOr([t,r])}}function makeAndUnless(e,n){return function(t,r){return e.test(t.value,r.value)?n||set_1.EMPTY:makeAnd([t,r])}}function makeComplementSecondArgIf(e){return function(n,t){return e.test(n.value,t.value)?set_1.difference(set_1.UNIVERSAL,t):n}}function makeAnd(e){return comparisons.And?new comparisons.And(e):set_1.UNDEFINABLE}function makeOr(e){return comparisons.Or?new comparisons.Or(e):set_1.UNDEFINABLE}var is=comparisons;function combineValueWithRangeCheck(e,n,t){var r=new t(n.value),s=e.values.filter(function(e){return!r.isMember(e)});return s.length?s.length<e.values.length?makeOr([new is.In(s),r]):makeOr([e,n]):r}function makeOrWithInAndRange(e,n){if(n instanceof is.Or){var t=makeOrWithInAndRange(e,n.values[0]);if(!(t instanceof is.Or))return set_1.union(t,n.values[1]);var r=makeOrWithInAndRange(e,n.values[1]);return r instanceof is.Or?makeOr([e,n]):set_1.union(r,n.values[0])}return n instanceof is.GreaterThan?combineValueWithRangeCheck(e,n,is.GreaterThanEqual):n instanceof is.LessThan?combineValueWithRangeCheck(e,n,is.LessThanEqual):makeOr([e,n])}var In_RANGE={union:combineFilterFirstValuesAgainstSecond({values:makeNot(isMemberTest),arePut:is.In,combinedUsing:function(e){return makeOrWithInAndRange(e[0],e[1])}}),intersection:make_filterFirstValueAgainstSecond(isMemberTest,is.In,set_1.EMPTY),difference:make_filterFirstValueAgainstSecond(makeNot(isMemberTest),is.In,set_1.EMPTY)},RANGE_IN={difference:swapArgs(combineFilterFirstValuesAgainstSecond({values:isMemberTest,arePut:is.NotIn,combinedUsing:makeAnd}))},NotIn_RANGE=function(){return{union:make_filterFirstValueAgainstSecond(makeNot(isMemberTest),is.NotIn,set_1.UNIVERSAL),intersection:combineFilterFirstValuesAgainstSecond({values:isMemberTest,arePut:is.NotIn,combinedUsing:makeAnd}),difference:combineFilterFirstValuesAgainstSecond({values:makeNot(isMemberTest),arePut:is.NotIn,combinedUsing:makeAnd,complement:!0})}},RANGE_NotIn={difference:swapArgs(make_filterFirstValueAgainstSecond(isMemberTest,is.In,set_1.EMPTY))},RANGE_And_Union=function(e,n){var t=set_1.union(e,n.values[0]),r=set_1.union(e,n.values[1]);return isAndOrOr(t)||isAndOrOr(r)?new is.Or([e,n]):set_1.intersection(t,r)},RANGE_And_Intersection=function(e,n){var t=n.values[0],r=n.values[1],s=set_1.intersection(e,t),i=set_1.intersection(e,r);return s===set_1.EMPTY||i===set_1.EMPTY?set_1.EMPTY:isAndOrOr(s)?isAndOrOr(i)?new is.And([e,n]):new set_1.intersection(i,t):new set_1.intersection(s,r)},RANGE_And_Difference=function(e,n){var t=n.values[0],r=n.values[1],s=set_1.difference(e,t),i=set_1.difference(e,r);return s===set_1.EMPTY?i:i===set_1.EMPTY?s:new is.Or([s,i])},And_RANGE_Difference=function(e,n){var t=e.values[0],r=e.values[1],s=set_1.difference(t,n),i=set_1.difference(r,n);return set_1.intersection(s,i)},RANGE_Or={union:function(e,n){var t=n.values[0],r=n.values[1],s=set_1.union(e,t);if(!isAndOrOr(s))return set_1.union(s,r);var i=set_1.union(e,r);return isAndOrOr(i)?new is.Or([e,n]):set_1.union(t,i)},intersection:function(e,n){var t=n.values[0],r=n.values[1],s=set_1.intersection(e,t),i=set_1.intersection(e,r);return s===set_1.EMPTY?i:i===set_1.EMPTY?s:set_1.union(s,i)},difference:function(e,n){var t=n.values[0],r=n.values[1],s=set_1.difference(e,t),i=set_1.difference(e,r);return set_1.intersection(s,i)}},Or_RANGE={difference:function(e,n){var t=e.values[0],r=e.values[1],s=set_1.difference(t,n),i=set_1.difference(r,n);return set_1.union(s,i)}},comparators={In_In:{union:makeEnum("union",is.In),intersection:makeEnum("intersection",is.In),difference:makeEnum("difference",is.In)},UNIVERSAL_In:{difference:makeSecondValue(is.NotIn,"values")},In_NotIn:{union:swapArgs(makeEnum("difference",is.NotIn,set_1.UNIVERSAL)),intersection:makeEnum("difference",is.In),difference:makeEnum("intersection",is.In)},NotIn_In:{difference:makeEnum("union",is.NotIn)},In_GreaterThan:In_RANGE,GreaterThan_In:RANGE_IN,In_GreaterThanEqual:In_RANGE,GreaterThanEqual_In:RANGE_IN,In_LessThan:In_RANGE,LessThan_In:RANGE_IN,In_LessThanEqual:In_RANGE,LessThanEqual_In:RANGE_IN,In_And:In_RANGE,And_In:RANGE_IN,In_Or:In_RANGE,Or_In:RANGE_IN,NotIn_NotIn:{union:makeEnum("intersection",is.NotIn,set_1.UNIVERSAL),intersection:makeEnum("union",is.NotIn),difference:makeEnum("difference",is.In)},UNIVERSAL_NotIn:{difference:makeSecondValue(is.In,"values")},NotIn_GreaterThan:NotIn_RANGE(),GreaterThan_NotIn:RANGE_NotIn,NotIn_GreaterThanEqual:NotIn_RANGE(),GreaterThanEqual_NotIn:RANGE_NotIn,NotIn_LessThan:NotIn_RANGE(),LessThan_NotIn:RANGE_NotIn,NotIn_LessThanEqual:NotIn_RANGE(),LessThanEqual_NotIn:RANGE_NotIn,NotIn_And:NotIn_RANGE(),And_NotIn:RANGE_NotIn,NotIn_Or:NotIn_RANGE(),Or_NotIn:RANGE_NotIn,GreaterThan_GreaterThan:{union:returnSmallerValue,intersection:returnBiggerValue,difference:makeAndIf(is.LessThan,is.LessThanEqual)},UNIVERSAL_GreaterThan:{difference:makeSecondValue(is.LessThanEqual)},GreaterThan_GreaterThanEqual:{union:returnSmallerValue,intersection:returnBiggerValue,difference:makeAndIf(is.LessThan,is.LessThan)},GreaterThanEqual_GreaterThan:{difference:make_InIfEqual_else_andIf(is.LessThan,is.LessThanEqual)},GreaterThan_LessThan:{union:function(){var e=makeOrUnless(is.LessThan);return function(n,t){return comparisons.In.test([n.value],t.value)?new is.NotIn([n.value]):e(n,t)}}(),intersection:makeAndUnless(is.GreaterThan),difference:makeComplementSecondArgIf(is.LessThan)},LessThan_GreaterThan:{difference:makeComplementSecondArgIf(is.GreaterThan)},GreaterThan_LessThanEqual:{union:makeOrUnless(is.LessThanEqual),intersection:makeAndUnless(is.GreaterThanEqual),difference:makeComplementSecondArgIf(is.LessThanEqual)},LessThanEqual_GreaterThan:{difference:makeComplementSecondArgIf(is.GreaterThanEqual)},GreaterThan_And:{union:RANGE_And_Union,intersection:RANGE_And_Intersection,difference:RANGE_And_Difference},And_GreaterThan:{difference:And_RANGE_Difference},GreaterThan_Or:RANGE_Or,Or_GreaterThan:Or_RANGE,GreaterThanEqual_GreaterThanEqual:{union:returnSmallerValue,intersection:returnBiggerValue,difference:makeAndIf(is.LessThan,is.LessThan)},UNIVERSAL_GreaterThanEqual:{difference:makeSecondValue(is.LessThan)},GreaterThanEqual_LessThan:{union:makeOrUnless(is.LessThanEqual),intersection:makeAndUnless(is.GreaterThanEqual),difference:makeComplementSecondArgIf(is.LessThanEqual)},LessThan_GreaterThanEqual:{difference:makeComplementSecondArgIf(is.GreaterThanEqual)},GreaterThanEqual_LessThanEqual:{union:makeOrUnless(is.LessThanEqual),intersection:function(){var e=makeAndUnless(is.GreaterThan);return function(n,t){var r=new is.In([n.value]);return r.isMember(t.value)?r:e(n,t)}}(),difference:makeComplementSecondArgIf(is.LessThanEqual)},LessThanEqual_GreaterThanEqual:{difference:makeComplementSecondArgIf(is.GreaterThanEqual)},GreaterThanEqual_And:{union:RANGE_And_Union,intersection:RANGE_And_Intersection,difference:RANGE_And_Difference},And_GreaterThanEqual:{difference:And_RANGE_Difference},GreaterThanEqual_Or:RANGE_Or,Or_GreaterThanEqual:Or_RANGE,LessThan_LessThan:{union:returnBiggerValue,intersection:returnSmallerValue,difference:makeAndIf(is.GreaterThan,is.GreaterThanEqual)},UNIVERSAL_LessThan:{difference:makeSecondValue(is.GreaterThanEqual)},LessThan_LessThanEqual:{union:returnBiggerValue,intersection:returnSmallerValue,difference:makeAndIf(is.GreaterThan,is.GreaterThan)},LessThanEqual_LessThan:{difference:make_InIfEqual_else_andIf(is.GreaterThanEqual,is.GreaterThanEqual)},LessThan_And:{union:RANGE_And_Union,intersection:RANGE_And_Intersection,difference:RANGE_And_Difference},And_LessThan:{difference:And_RANGE_Difference},LessThan_Or:RANGE_Or,Or_LessThan:Or_RANGE,LessThanEqual_LessThanEqual:{union:returnBiggerValue,intersection:returnSmallerValue,difference:function(e,n){return e.value>=n.value?makeAnd([e,new is.GreaterThan(n.value)]):set_1.EMPTY}},UNIVERSAL_LessThanEqual:{difference:makeSecondValue(is.GreaterThan)},LessThanEqual_And:{union:RANGE_And_Union,intersection:RANGE_And_Intersection,difference:RANGE_And_Difference},And_LessThanEqual:{difference:And_RANGE_Difference},LessThanEqual_Or:RANGE_Or,Or_LessThanEqual:Or_RANGE,And_And:{union:function(e,n){var t=set_1.union(e,n.values[0]),r=set_1.union(e,n.values[1]);return(isAndOrOr(t)||isAndOrOr(r))&&(t=set_1.union(n,e.values[0]),r=set_1.union(n,e.values[1])),isAndOrOr(t)||isAndOrOr(r)?new is.Or([e,n]):set_1.intersection(t,r)},intersection:function(e,n){var t=set_1.intersection(e.values[0],n.values[0]),r=set_1.intersection(e.values[1],n.values[1]);return isAndOrOr(t)&&isAndOrOr(r)?(t=set_1.intersection(e.values[0],n.values[1]),r=set_1.intersection(e.values[1],n.values[0]),isAndOrOr(t)&&isAndOrOr(r)?new is.And([e,n]):set_1.intersection(t,r)):set_1.intersection(t,r)},difference:function(e,n){var t=set_1.difference(e,n.values[0]),r=set_1.difference(e,n.values[1]);return set_1.union(t,r)}},And_Or:{union:function(e,n){var t=set_1.union(e.values[0],n),r=set_1.union(e.values[1],n);return isAndOrOr(t)&&isAndOrOr(r)?new is.Or([e,n]):set_1.intersection(t,r)},intersection:function(e,n){var t=set_1.intersection(e,n.values[0]),r=set_1.intersection(e,n.values[1]);return isOr(t)||isOr(r)?new is.And([e,n]):set_1.union(t,r)},difference:function(e,n){var t=set_1.difference(e,n.values[0]),r=set_1.difference(e,n.values[1]);return set_1.intersection(t,r)}},Or_And:{difference:function(e,n){var t=set_1.difference(e,n.values[0]),r=set_1.difference(e,n.values[1]);return set_1.union(t,r)}},UNIVERSAL_And:{difference:function(e,n){var t=set_1.difference(e,n.values[0]),r=set_1.difference(e,n.values[1]);return set_1.union(t,r)}},Or_Or:{union:function(e,n){var t=set_1.union(e.values[0],n.values[0]),r=set_1.union(e.values[1],n.values[1]);return isAndOrOr(t)&&isAndOrOr(r)?(t=set_1.union(e.values[0],n.values[1]),r=set_1.union(e.values[1],n.values[0]),isAndOrOr(t)&&isAndOrOr(r)?new is.Or([e,n]):set_1.union(t,r)):set_1.union(t,r)},intersection:function(e,n){var t=n.values[0],r=n.values[1],s=set_1.intersection(e,t),i=set_1.intersection(e,r);return isOr(s)&&isOr(i)?(s=set_1.union(n,e.values[0]),i=set_1.union(n,e.values[1]),isOr(s)&&isOr(i)?new is.Or([e,n]):set_1.union(s,i)):set_1.union(s,i)},difference:function(e,n){var t=set_1.difference(e,n.values[0]),r=set_1.difference(e,n.values[1]);return set_1.intersection(t,r)}},UNIVERSAL_Or:{difference:function(e,n){var t=set_1.difference(e,n.values[0]),r=set_1.difference(e,n.values[1]);return set_1.intersection(t,r)}}},names=Object.keys(comparisons);names.forEach(function(e,n){comparators[e+"_"+e]?set_1.defineComparison(comparisons[e],comparisons[e],comparators[e+"_"+e]):console.warn("no "+e+"_"+e),comparators["UNIVERSAL_"+e]?set_1.defineComparison(set_1.UNIVERSAL,comparisons[e],comparators["UNIVERSAL_"+e]):console.warn("no UNIVERSAL_"+e);for(var t=n+1;t<names.length;t++){var r=names[t];comparators[e+"_"+r]?set_1.defineComparison(comparisons[e],comparisons[r],comparators[e+"_"+r]):console.warn("no "+e+"_"+r),comparators[r+"_"+e]?set_1.defineComparison(comparisons[r],comparisons[e],comparators[r+"_"+e]):console.warn("no "+r+"_"+e)}});var comparisons_1=comparisons,makeRealNumberRangeInclusive=function(e,n){function t(t,r){this.start=arguments.length>0?+t:e,this.end=arguments.length>1?+r:n,this.range=new comparisons_1.And([new comparisons_1.GreaterThanEqual(this.start),new comparisons_1.LessThanEqual(this.end)])}var r=new t(e,n);function s(e){return set_1.isSubset(r.range,e.range)}function i(e){var n={};if(e.values.forEach(function(e){e instanceof comparisons_1.GreaterThanEqual&&(n.start=e.value),e instanceof comparisons_1.GreaterThan&&(n.start=e.value+1),e instanceof comparisons_1.LessThanEqual&&(n.end=e.value),e instanceof comparisons_1.LessThan&&(n.end=e.value-1)}),"start"in n&&"end"in n)return new t(n.start,n.end)}function a(e){var n;if(e instanceof comparisons_1.And&&(n=i(e)),e instanceof comparisons_1.Or){var r=i(e.values[0]),a=i(e.values[1]);if(!r||!a)return set_1.UNDEFINABLE;var u=r.range.values,o=a.range.values;if(u[1].value+1===o[0].value)n=new t(u[0].value,o[1].value);else{if(o[1].value+1!==u[0].value)return set_1.UNDEFINABLE;n=new t(o[0].value,u[1].value)}}return n&&s(n)?set_1.UNIVERSAL:n}function u(e,n){var t=a(set_1.difference(e.range,n.range));return t||set_1.EMPTY}return set_1.defineComparison(t,t,{union:function(e,n){var t=a(set_1.union(e.range,n.range));return t||set_1.EMPTY},intersection:function(e,n){var t=a(set_1.intersection(e.range,n.range));return t||set_1.EMPTY},difference:u}),set_1.defineComparison(set_1.UNIVERSAL,t,{difference:function(e,n){return s(n)?set_1.EMPTY:u(r,n)}}),t},types={};function ValuesOr(e){this.values=e}ValuesOr.prototype.isMember=function(e){return this.values.some(function(n){return n&&n.isMember?n.isMember(e):n===e})},set_1.defineComparison(set_1.UNIVERSAL,ValuesOr,{difference:function(){return set_1.UNDEFINABLE}});var valuesOr=types.ValuesOr=ValuesOr;function NotIdentity(e){this.value=e}var Identity$1=set_1.Identity;set_1.defineComparison(set_1.UNIVERSAL,Identity$1,{difference:function(e,n){return new NotIdentity(n)}}),set_1.defineComparison(set_1.UNIVERSAL,NotIdentity,{difference:function(e,n){return n.value}}),set_1.defineComparison(NotIdentity,NotIdentity,{}),set_1.defineComparison(NotIdentity,Identity$1,{union:function(e,n){if(set_1.isEqual(e.value,n))return set_1.UNIVERSAL;throw new Error("Not,Identity Union is not filled out")},intersection:function(e,n){return set_1.isEqual(!e.value,n)?n:set_1.EMPTY},difference:function(e,n){return set_1.isEqual(e.value,n)?e:set_1.UNDEFINABLE}}),set_1.defineComparison(Identity$1,NotIdentity,{difference:function(e,n){return set_1.isEqual(e,n.value)?e:set_1.UNDEFINABLE}});var valuesNot=types.Not=NotIdentity;function KeysAnd(e){var n=this.values={};canReflect.eachKey(e,function(e,t){canReflect.isPlainObject(e)&&!set_1.isSpecial(e)?n[t]=new KeysAnd(e):n[t]=e})}var isMemberSymbol$1=canSymbol.for("can.isMember");function checkIfUniversalAndReturnUniversal(e){return set_1.isEqual(e,set_1.UNIVERSAL)?set_1.UNIVERSAL:e}KeysAnd.prototype.isMember=function(e,n,t){var r=!0,s=t?t+".":"";return canReflect.eachKey(this.values,function(t,i){var a=t&&(t[isMemberSymbol$1]||t.isMember);a?a.call(t,get(e,i),n||e,s+i)||(r=!1):t!==get(e,i)&&(r=!1)}),r};var MISSING={};function eachInUnique(e,n,t,r,s){var i,a=assign({},t);for(var u in e){if(void 0!==(i=n(u,e[u],u in t?t[u]:MISSING,e,t)))return i;delete a[u]}for(u in a)if(void 0!==(i=r(u,MISSING,t[u],e,t)))return i;return s}function keyDiff(e,n){var t=arrayUnionIntersectionDifference(Object.keys(e),Object.keys(n));return{aOnlyKeys:t.difference,aAndBKeys:t.intersection,bOnlyKeys:arrayUnionIntersectionDifference(Object.keys(n),Object.keys(e)).difference}}function notEmpty(e){return e!==set_1.EMPTY}function difference(e,n){var t=e.values,r=n.values,s=keyDiff(t,r),i=s.aOnlyKeys,a=s.aAndBKeys,u=s.bOnlyKeys,o={},c={},f={};a.forEach(function(e){var n=set_1.difference(t[e],r[e]);if(n===set_1.EMPTY)o[e]=t[e];else{var s=set_1.intersection(t[e],r[e]);s!==set_1.EMPTY?c[e]={difference:n,intersection:s}:f[e]=t[e]}});var l,m=Object.keys(c);if(1===m.length&&((l={})[m[0]]=c[m[0]].difference),Object.keys(f).length)return e;if(0===i.length&&0===u.length)return m.length>1?set_1.UNDEFINABLE:1===m.length?(assign(o,l),new KeysAnd(o)):set_1.EMPTY;if(i.length>0&&0===u.length)return m.length>1?set_1.UNDEFINABLE:1===m.length?(assign(o,l),i.forEach(function(e){o[e]=t[e]}),new KeysAnd(o)):set_1.EMPTY;if(0===i.length&&u.length>0){if(m.length>1)return set_1.UNDEFINABLE;var d;if(1===m.length){var h=m[0];(d=assign({},o))[h]=c[h].difference,o[h]=c[h].intersection}var _=u.map(function(e){var n=assign({},o),t=n[e]=set_1.difference(set_1.UNIVERSAL,r[e]);return t===set_1.EMPTY?t:new KeysAnd(n)}).filter(notEmpty);return d&&_.push(new KeysAnd(d)),_.length>1?new types.ValuesOr(_):1===_.length?_[0]:set_1.EMPTY}if(i.length>0&&u.length>0){if(m.length)throw new Error("Can't handle any productable keys right now");if(i.forEach(function(e){o[e]=t[e]}),1===u.length){var p=u[0],y=assign({},o);return y[p]=set_1.difference(set_1.UNIVERSAL,r[p]),new KeysAnd(y)}return set_1.UNDEFINABLE}}set_1.defineComparison(KeysAnd,KeysAnd,{union:function(e,n){var t=keyDiff(e.values,n.values),r=[],s={};t.aAndBKeys.forEach(function(t){set_1.isEqual(e.values[t],n.values[t])?s[t]=e.values[t]:r.push(t)});var i={},a={};if(r.forEach(function(t){i[t]=e.values[t],a[t]=n.values[t]}),!t.aOnlyKeys.length&&!t.bOnlyKeys.length){if(1===r.length){var u=r[0],o=s[u]=set_1.union(e.values[u],n.values[u]);return 1===canReflect.size(s)&&set_1.isEqual(o,set_1.UNIVERSAL)?set_1.UNIVERSAL:new KeysAnd(s)}if(0===r.length)return e}if(0===r.length){if(t.aOnlyKeys.length>0&&0===t.bOnlyKeys.length)return checkIfUniversalAndReturnUniversal(n);if(0===t.aOnlyKeys.length&&t.bOnlyKeys.length>0)return checkIfUniversalAndReturnUniversal(e)}return t.aOnlyKeys.length>0&&0===t.bOnlyKeys.length&&set_1.isSubset(new KeysAnd(i),new KeysAnd(a))?n:t.bOnlyKeys.length>0&&0===t.aOnlyKeys.length&&set_1.isSubset(new KeysAnd(a),new KeysAnd(i))?e:new types.ValuesOr([e,n])},intersection:function(e,n){var t=e.values,r=n.values,s=!1,i={};return eachInUnique(t,function(e,n,t){i[e]=t===MISSING?n:set_1.intersection(n,t),i[e]===set_1.EMPTY&&(s=!0)},r,function(e,n,t){i[e]=t,i[e]===set_1.EMPTY&&(s=!0)}),s?set_1.EMPTY:new KeysAnd(i)},difference:difference}),set_1.defineComparison(set_1.UNIVERSAL,KeysAnd,{difference:function(e,n){return difference({values:{}},n)}});var keysAnd=types.KeysAnd=KeysAnd,andOrNot={KeysAnd:keysAnd,ValuesOr:valuesOr,ValuesNot:valuesNot},defaultCompare={$gt:function(e,n){return e>n},$lt:function(e,n){return e<n}},helpers={uniqueConcat:function(e,n,t){var r=new Set;return e.concat(n).filter(function(e){var n=t(e);return!r.has(n)&&(r.add(n),!0)})},getIndex:function(e,n,t){if(n&&n.length){if(-1===e(t,n[0]))return 0;if(1===e(t,n[n.length-1]))return n.length;for(var r=0,s=n.length;r<s;){var i=r+s>>>1;-1===e(t,n[i])?s=i:r=i+1}return s}},sortData:function(e){return"-"===e[0]?{prop:e.slice(1),desc:!0}:{prop:e,desc:!1}},defaultCompare:defaultCompare,sorter:function(e,n){var t,r=helpers.sortData(e);return t=n&&n[r.prop]?n[r.prop]:defaultCompare,function(e,n){var s,i=canReflect.getKeyValue(e,r.prop),a=canReflect.getKeyValue(n,r.prop);return r.desc&&(s=i,i=a,a=s),t.$lt(i,a)?-1:t.$gt(i,a)?1:0}},valueHydrator:function(e){if(canReflect.isBuiltIn(e))return e;throw new Error("can-query-logic doesn't support comparison operator: "+JSON.stringify(e))}},helpers_1=helpers,isMemberSymbol$2=canSymbol.for("can.isMember"),KeysAnd$1=andOrNot.KeysAnd,Or=andOrNot.ValuesOr,Not=andOrNot.ValuesNot,RecordRange=makeRealNumberRangeInclusive(0,1/0);function makeSort(e,n){var t={};function r(e){this.key=e,this.compare=helpers_1.sorter(e,t)}return canReflect.eachKey(e,function(e,r){t[r]={$gt:function(t,s){return n({$gt:s},r,e,helpers_1.valueHydrator)[isMemberSymbol$2](t)},$lt:function(t,s){return n({$lt:s},r,e,helpers_1.valueHydrator)[isMemberSymbol$2](t)}}}),set_1.defineComparison(r,r,{intersection:function(e,n){return e.key===n.key?e:set_1.EMPTY},difference:function(e,n){return e.key===n.key?set_1.EMPTY:e},union:function(e,n){return e.key===n.key?e:set_1.UNDEFINABLE}}),r}var DefaultSort=makeSort({});function BasicQuery(e){assign(this,e),this.filter||(this.filter=set_1.UNIVERSAL),this.page||(this.page=new RecordRange),this.sort||(this.sort="id"),"string"==typeof this.sort&&(this.sort=new DefaultSort(this.sort))}BasicQuery.KeysAnd=KeysAnd$1,BasicQuery.Or=Or,BasicQuery.Not=Not,BasicQuery.RecordRange=RecordRange,BasicQuery.makeSort=makeSort,canReflect.assignMap(BasicQuery.prototype,{count:function(){return this.page.end-this.page.start+1},sortData:function(e){return e.slice(0).sort(this.sort.compare)},filterMembersAndGetCount:function(e,n){if(n){if(!set_1.isSubset(this,n))throw new Error("can-query-logic: Unable to get members from a set that is not a superset of the current set.")}else n=new BasicQuery;var t=e.filter(function(e){return this.filter.isMember(e)},this),r=t.length;r&&this.sort.key!==n.sort.key&&(t=this.sortData(t));var s=set_1.isEqual(this.page,set_1.UNIVERSAL);if(set_1.isEqual(n.page,set_1.UNIVERSAL))return s?{data:t,count:r}:{data:t.slice(this.page.start,this.page.end+1),count:r};if(this.sort.key===n.sort.key&&set_1.isEqual(n.filter,this.filter))return{data:t.slice(this.page.start-n.page.start,this.page.end-n.page.start+1),count:r};throw new Error("can-query-logic: Unable to get members from the parent set for this subset.")},filterFrom:function(e,n){return this.filterMembersAndGetCount(e,n).data},merge:function(e,n,t,r){var s=set_1.union(this,e);if(s!==set_1.UNDEFINABLE){var i=helpers_1.uniqueConcat(n,t,r);return s.sortData(i)}},index:function(e,n){var t=helpers_1.sortData(this.sort.key);if(canReflect.hasOwnKey(e,t.prop))return helpers_1.getIndex(this.sort.compare,n,e)},isMember:function(e){return this.filter.isMember(e)},removePagination:function(){this.page=new RecordRange}});var CLAUSE_TYPES=["filter","page","sort"];function getDifferentClauseTypes(e,n){var t=[];return CLAUSE_TYPES.forEach(function(r){set_1.isEqual(e[r],n[r])||t.push(r)}),t}function isSubset(e,n,t){return!!t[e+"FilterIsSubset"]&&(!!t[n+"PageIsUniversal"]||t[e+"PageIsSubset"]&&t.sortIsEqual)}function MetaInformation(e,n){this.queryA=e,this.queryB=n}function metaInformation(e,n){return new MetaInformation(e,n)}canReflect.eachKey({pageIsEqual:function(){return set_1.isEqual(this.queryA.page,this.queryB.page)},aPageIsUniversal:function(){return set_1.isEqual(this.queryA.page,set_1.UNIVERSAL)},bPageIsUniversal:function(){return set_1.isEqual(this.queryB.page,set_1.UNIVERSAL)},pagesAreUniversal:function(){return this.pageIsEqual&&this.aPageIsUniversal},sortIsEqual:function(){return this.queryA.sort.key===this.queryB.sort.key},aFilterIsSubset:function(){return set_1.isSubset(this.queryA.filter,this.queryB.filter)},bFilterIsSubset:function(){return set_1.isSubset(this.queryB.filter,this.queryA.filter)},aPageIsSubset:function(){return set_1.isSubset(this.queryA.page,this.queryB.page)},bPageIsSubset:function(){return set_1.isSubset(this.queryB.page,this.queryA.page)},filterIsEqual:function(){return set_1.isEqual(this.queryA.filter,this.queryB.filter)},aIsSubset:function(){return isSubset("a","b",this)},bIsSubset:function(){return isSubset("b","a",this)}},function(e,n){defineLazyValue(MetaInformation.prototype,n,e)}),set_1.defineComparison(BasicQuery,BasicQuery,{union:function(e,n){var t=metaInformation(e,n),r=set_1.union(e.filter,n.filter);if(t.pagesAreUniversal)return new BasicQuery({filter:r,sort:t.sortIsEqual?e.sort.key:void 0});if(t.filterIsEqual)return t.sortIsEqual?new BasicQuery({filter:e.filter,sort:e.sort.key,page:set_1.union(e.page,n.page)}):t.aIsSubset?n:t.bIsSubset?e:set_1.UNDEFINABLE;throw new Error("different filters, non-universal pages")},intersection:function(e,n){var t=metaInformation(e,n);if(t.pagesAreUniversal){var r=set_1.intersection(e.filter,n.filter);return set_1.isDefinedAndHasMembers(r)?new BasicQuery({filter:r,sort:t.sortIsEqual?e.sort.key:void 0}):r}return set_1.intersection(e.filter,n.filter)===set_1.EMPTY?set_1.EMPTY:t.filterIsEqual?t.sortIsEqual?new BasicQuery({filter:e.filter,sort:e.sort.key,page:set_1.intersection(e.page,n.page)}):t.aIsSubset?e:t.bIsSubset?n:set_1.UNKNOWABLE:t.aIsSubset?e:t.bIsSubset?n:set_1.UNDEFINABLE},difference:function(e,n){var t,r=getDifferentClauseTypes(e,n),s=metaInformation(e,n);if(r.length>1)return s.aIsSubset?set_1.EMPTY:s.pagesAreUniversal?new BasicQuery({filter:set_1.difference(e.filter,n.filter),sort:e.sort.key}):set_1.UNDEFINABLE;switch(t=r[0]){case void 0:return set_1.EMPTY;case"sort":return s.pagesAreUniversal?set_1.EMPTY:set_1.UNKNOWABLE;case"page":case"filter":var i=set_1.difference(e[t],n[t]);if(set_1.isSpecial(i))return i;var a={filter:e.filter,page:e.page,sort:e.sort.key};return a[t]=i,new BasicQuery(a)}}});var basicQuery=BasicQuery,Serializer=function(e){this.serializers=new Map(e||[]),this.serialize=this.serialize.bind(this)};Serializer.prototype.add=function(e){canReflect.assign(this.serializers,e instanceof Serializer?e.serializers:e)},Serializer.prototype.serialize=function(e){if(!e)return e;var n=e.constructor,t=this.serializers.get(n);return t?t(e,this.serialize):canReflect.serialize(e)};var serializer=Serializer;function makeNew(e){return function(n){return new e(n)}}var hydrateMap={};function addHydrateFrom(e,n){hydrateMap[e]=function(t,r){return n(r?r(t[e]):t[e])},Object.defineProperty(hydrateMap[e],"name",{value:"hydrate "+e,writable:!0})}function addHydrateFromValues(e,n){hydrateMap[e]=function(t,r){var s=t[e];return r&&(s=s.map(function(e){return r(e)})),n(s)},Object.defineProperty(hydrateMap[e],"name",{value:"hydrate "+e,writable:!0})}addHydrateFrom("$eq",function(e){return new comparisons_1.In([e])}),addHydrateFrom("$ne",function(e){return new comparisons_1.NotIn([e])}),addHydrateFrom("$gt",makeNew(comparisons_1.GreaterThan)),addHydrateFrom("$gte",makeNew(comparisons_1.GreaterThanEqual)),addHydrateFromValues("$in",makeNew(comparisons_1.In)),addHydrateFrom("$lt",makeNew(comparisons_1.LessThan)),addHydrateFrom("$lte",makeNew(comparisons_1.LessThanEqual)),addHydrateFromValues("$nin",makeNew(comparisons_1.GreaterThan));var schemaHelpers,serializer$1=new serializer([[comparisons_1.In,function(e,n){return 1===e.values.length?n(e.values[0]):{$in:e.values.map(n)}}],[comparisons_1.NotIn,function(e,n){return 1===e.values.length?{$ne:n(e.values[0])}:{$nin:e.values.map(n)}}],[comparisons_1.GreaterThan,function(e,n){return{$gt:n(e.value)}}],[comparisons_1.GreaterThanEqual,function(e,n){return{$gte:n(e.value)}}],[comparisons_1.LessThan,function(e,n){return{$lt:n(e.value)}}],[comparisons_1.LessThanEqual,function(e,n){return{$lte:n(e.value)}}],[comparisons_1.And,function(e,n){var t={};return e.values.forEach(function(e){canReflect.assignMap(t,n(e))}),t}]]),comparisons$1={hydrate:function(e,n){if(n||(n=function(){throw new Error("can-query-logic doesn't recognize operator: "+JSON.stringify(e))}),Array.isArray(e))return new comparisons_1.In(e.map(function(e){return n(e)}));if(e&&"object"==typeof e){var t=Object.keys(e);if(t.every(function(e){return hydrateMap[e]})){var r=t.map(function(t){var r={};return r[t]=e[t],(0,hydrateMap[t])(r,n)});return r.length>1?new comparisons_1.And(r):r[0]}return n(e)}return new comparisons_1.In([n(e)])},serializer:serializer$1},schemaHelpers_1=schemaHelpers={isRangedType:function(e){return e&&canReflect.isConstructorLike(e)&&!set_1.hasComparisons(e)&&!e[canSymbol.for("can.SetType")]&&e.prototype.valueOf&&e.prototype.valueOf!==Object.prototype.valueOf},categorizeOrValues:function(e){var n={primitives:[],valueOfTypes:[],others:[]};return e.forEach(function(e){canReflect.isPrimitive(e)?n.primitives.push(e):schemaHelpers.isRangedType(e)?n.valueOfTypes.push(e):n.others.push(e)}),n}},comparisonSetTypeSymbol=canSymbol.for("can.ComparisonSetType"),isMemberSymbol$3=canSymbol.for("can.isMember");function splitByRangeAndEnum(e,n){var t;if(n instanceof comparisons_1.And)return n.values.map(function(n){return splitByRangeAndEnum(e,n)}).reduce(function(e,n){return{range:set_1.intersection(e.range,n.range),enum:set_1.intersection(e.enum,n.enum)}},{range:set_1.UNIVERSAL,enum:e});if(n instanceof comparisons_1.In){var r=n.values.filter(function(n){return e.isMember(n)});if(r.length){var s=n.values.slice(0);return canReflect.removeValues(s,r),{enum:new comparisons_1.In(r),range:s.length?new comparisons_1.In(s):set_1.EMPTY}}return{enum:set_1.EMPTY,range:n}}if(n instanceof comparisons_1.NotIn){t=set_1.intersection(e,n);var i=n.values.filter(function(n){return!e.isMember(n)});return{range:i.length?new comparisons_1.NotIn(i):set_1.UNIVERSAL,enum:t}}return{enum:set_1.EMPTY,range:n}}function makeMaybe(e,n){var t=new comparisons_1.In(e);function r(e){var n=splitByRangeAndEnum(t,e.range);if(this.range=n.range||set_1.EMPTY,e.enum?n.enum!==set_1.EMPTY?this.enum=set_1.union(n.enum,e.enum):this.enum=e.enum:this.enum=n.enum,this.enum===set_1.EMPTY&&this.range===set_1.EMPTY)return set_1.EMPTY}return r.prototype.orValues=function(){var e=[];return this.range!==set_1.EMPTY&&e.push(this.range),this.enum!==set_1.EMPTY&&e.push(this.enum),e},r.prototype[isMemberSymbol$3]=function(){var e=this.range[isMemberSymbol$3]||this.range.isMember,n=this.enum[isMemberSymbol$3]||this.enum.isMember;return e.apply(this.range,arguments)||n.apply(this.enum,arguments)},set_1.defineComparison(r,r,{union:function(e,n){return new r({enum:set_1.union(e.enum,n.enum),range:set_1.union(e.range,n.range)})},difference:function(e,n){return new r({enum:set_1.difference(e.enum,n.enum),range:set_1.difference(e.range,n.range)})},intersection:function(e,n){return new r({enum:set_1.intersection(e.enum,n.enum),range:set_1.intersection(e.range,n.range)})}}),r.inValues=e,set_1.defineComparison(set_1.UNIVERSAL,r,{difference:function(e,n){var s;if(n.range===set_1.UNIVERSAL)return new r({range:n.range,enum:set_1.difference(t,n.enum)});if(n.enum===set_1.EMPTY){var i=set_1.difference(set_1.UNIVERSAL,n.range),a=set_1.difference(t,n.range);return new r({range:i,enum:set_1.difference(a,i)})}return s=set_1.difference(e,n.range),new r({enum:set_1.difference(t,n.enum),range:s})}}),n=n||function(e){return e},r.hydrate=function(e,t){return new r({range:t(e,n)})},r}makeMaybe.canMakeMaybeSetType=function(e){var n=canReflect.getSchema(e);if(n&&"Or"===n.type){var t=schemaHelpers_1.categorizeOrValues(n.values);return 1===t.valueOfTypes.length&&t.valueOfTypes.length+t.primitives.length===n.values.length}return!1},makeMaybe.makeMaybeSetTypes=function(e){var n,t=canReflect.getSchema(e),r=schemaHelpers_1.categorizeOrValues(t.values);return e[comparisonSetTypeSymbol]?n=e[comparisonSetTypeSymbol]:((n=function(n){this.value=canReflect.new(e,n)}).prototype.valueOf=function(){return this.value},canReflect.assignSymbols(n.prototype,{"can.serialize":function(){return this.value}}),"production"!==process$1.env.NODE_ENV&&Object.defineProperty(n,"name",{value:"Or["+r.valueOfTypes[0].name+","+r.primitives.map(String).join(" ")+"]"})),{Maybe:makeMaybe(r.primitives,function(e){return new n(e)}),ComparisonSetType:n}};var makeMaybe_1=makeMaybe,setTypeSymbol=canSymbol.for("can.SetType"),isMemberSymbol$4=canSymbol.for("can.isMember"),newSymbol=canSymbol.for("can.new");function makeEnumSetType(e,n){function t(e){var t=Array.isArray(e)?e:[e];this.values=n?t.map(n):t}canReflect.assignSymbols(t.prototype,{"can.serialize":function(){return 1===this.values.length?this.values[0]:this.values}}),t.prototype[isMemberSymbol$4]=function(e){return this.values.some(function(n){return set_1.isEqual(n,e)})},t.UNIVERSAL=new t(e);var r=function(e,n){var r=arrayUnionIntersectionDifference(e.values,n.values);return r.difference.length?new t(r.difference):set_1.EMPTY};return set_1.defineComparison(t,t,{union:function(e,n){var r=arrayUnionIntersectionDifference(e.values,n.values);return r.union.length?new t(r.union):set_1.EMPTY},intersection:function(e,n){var r=arrayUnionIntersectionDifference(e.values,n.values);return r.intersection.length?new t(r.intersection):set_1.EMPTY},difference:r}),set_1.defineComparison(t,set_1.UNIVERSAL,{difference:function(n){return r(n,{values:e.slice(0)})}}),set_1.defineComparison(set_1.UNIVERSAL,t,{difference:function(n,t){return r({values:e.slice(0)},t)}}),t}function makeEnum$1(e,n,t){var r=makeEnumSetType(n,t);return e[setTypeSymbol]=r,e[isMemberSymbol$4]=function(e){return n.some(function(n){return set_1.isEqual(n,e)})},r}makeEnum$1.canMakeEnumSetType=function(e){var n=canReflect.getSchema(e);return!(!n||"Or"!==n.type)&&schemaHelpers_1.categorizeOrValues(n.values).primitives.length===n.values.length},makeEnum$1.makeEnumSetType=function(e){var n=canReflect.getSchema(e),t=schemaHelpers_1.categorizeOrValues(n.values),r=e[newSymbol]?e[newSymbol].bind(e):void 0;return makeEnumSetType(t.primitives,r)};var makeEnum_1=makeEnum$1,setTypeSymbol$1=canSymbol.for("can.SetType"),schemaSymbol=canSymbol.for("can.getSchema"),defaultQuery=new basicQuery({});function getSchemaProperties(e){var n=e.constructor;return n&&n[schemaSymbol]&&n[schemaSymbol]().keys||{}}function hydrateFilter(e,n,t){return e&&"object"==typeof e&&"$or"in e?hydrateOrs(e.$or,n,t):hydrateAndValues(e,n,t)}var setTypeMap=new WeakMap;function hydrateAndValue(e,n,t,r){if(t){var s=t[setTypeSymbol$1];return s?s.hydrate?s.hydrate(e,comparisons$1.hydrate):set_1.hasComparisons(s)?new s(e):comparisons$1.hydrate(e,function(e){return new s(e)}):makeEnum_1.canMakeEnumSetType(t)?(setTypeMap.has(t)||setTypeMap.set(t,makeEnum_1.makeEnumSetType(t)),new(s=setTypeMap.get(t))(e)):makeMaybe_1.canMakeMaybeSetType(t)?(setTypeMap.has(t)||setTypeMap.set(t,makeMaybe_1.makeMaybeSetTypes(t)),(s=setTypeMap.get(t).Maybe).hydrate(e,comparisons$1.hydrate)):comparisons$1.hydrate(e,r)}return comparisons$1.hydrate(e,r)}function hydrateAndValues(e,n,t){function r(e){if(e){if(Array.isArray(e))return e.map(t);if(canReflect.isPlainObject(e))return hydrateAndValues(e,getSchemaProperties(e))}return t?t(e):e}n=n||{};var s={};return canReflect.eachKey(e,function(e,t){s[t]=hydrateAndValue(e,t,n[t],r)}),new basicQuery.KeysAnd(s)}function combineAnds(e){var n=Object.keys(e[0].values),t={},r=new comparisons_1.In(n);if(n.map(function(e){t[e]=[]}),e.every(function(e){return!!set_1.isEqual(r,new comparisons_1.In(Object.keys(e.values)))&&(canReflect.eachKey(e.values,function(e,n){t[n].push(e)}),!0)})){var s=[];if(n.forEach(function(e){t[e].reduce(function(e,n){return!1!==n&&(void 0===n?e:!!set_1.isEqual(e,n)&&e)})||s.push(e)}),1===s.length){var i=s[0],a=t[i].reduce(function(e,n){return set_1.union(e,n)},set_1.EMPTY),u={};return n.map(function(e){u[e]=t[e][0]}),u[i]=a,new basicQuery.KeysAnd(u)}}}function hydrateOrs(e,n,t){var r=e.map(function(e){return hydrateAndValues(e,n,t)}),s=combineAnds(r);return s||new basicQuery.Or(r)}function recursivelyAddOrs(e,n,t,r){n.orValues().forEach(function(n){if("function"==typeof n.orValues)recursivelyAddOrs(e,n,t,r);else{var s={};s[r]=t(n),e.push(s)}})}var canQueryLogic,basicQuery$1=function(e){var n=e.identity&&e.identity[0],t=e.keys,r=[[basicQuery.Or,function(e,n){return e.values.map(function(e){return n(e)})}],[basicQuery.KeysAnd,function(e,n){var t=[],r={};return canReflect.eachKey(e.values,function(e,s){"function"==typeof e.orValues?recursivelyAddOrs(t,e,n,s):r[s]=n(e)}),t.length?1===t.length?t[0]:{$or:t.map(function(e){return canReflect.assign(canReflect.serialize(r),e)})}:r}],[basicQuery.RecordRange,function(e){return{start:e.start,end:e.end}}],[basicQuery,function(e,t){var r=set_1.isEqual(e.filter,set_1.UNIVERSAL)?{}:t(e.filter),s={};return 0!==canReflect.size(r)&&(s.filter=r),set_1.isEqual(e.page,defaultQuery.page)||(s.page={start:e.page.start},e.page.end!==defaultQuery.page.end&&(s.page.end=e.page.end)),e.sort.key!==n&&(s.sort=e.sort.key),s}]],s=basicQuery.makeSort(t,hydrateAndValue),i=new serializer(r);return i.add(comparisons$1.serializer),{hydrate:function(e){if("production"!==process$1.env.NODE_ENV){var r=makeEnum_1(function(){},["filter","sort","page"]),i=set_1.difference(new r(Object.keys(e)),r.UNIVERSAL);i.values&&i.values.length&&dev.warn("can-query-logic: Ignoring keys: "+i.values.join(", ")+".")}var a={filter:hydrateFilter(canReflect.serialize(e.filter),t,helpers_1.valueHydrator)};return e.page&&(a.page=new basicQuery.RecordRange(e.page.start,e.page.end)),e.sort?a.sort=new s(e.sort):a.sort=new s(n),new basicQuery(a)},serializer:i}},schemaSymbol$1=canSymbol.for("can.getSchema"),newSymbol$1=canSymbol.for("can.new");function QueryLogic(e,n){e=e||{};var t,r=n&&n.toQuery,s=n&&n.toParams;(t=e[schemaSymbol$1]?e[schemaSymbol$1]():e).identity&&t.identity[0]||(t.identity=["id"]);var i,a,u=basicQuery$1(t);i=r?function(e){return u.hydrate(r(e))}:u.hydrate,a=s?function(e){return s(u.serializer.serialize(e))}:u.serializer.serialize,this.hydrate=i,this.serialize=a,this.schema=t}function makeNewSet(e){return function(n,t){var r=this.hydrate(n),s=this.hydrate(t),i=set_1[e](r,s);return this.serialize(i)}}function makeReturnValue(e){return function(n,t){var r=this.hydrate(n),s=this.hydrate(t);return set_1[e](r,s)}}for(var prop in canReflect.assignSymbols(QueryLogic.prototype,{"can.getSchema":function(){return this.schema}}),canReflect.assign(QueryLogic.prototype,{union:makeNewSet("union"),difference:makeNewSet("difference"),intersection:makeNewSet("intersection"),isEqual:makeReturnValue("isEqual"),isProperSubset:makeReturnValue("isProperSubset"),isSubset:makeReturnValue("isSubset"),isSpecial:set_1.isSpecial,isDefinedAndHasMembers:set_1.isDefinedAndHasMembers,count:function(e){var n=this.hydrate(e);return n.page.end-n.page.start+1},identityKeys:function(){return this.schema.identity},filterMembers:function(e,n,t){var r=this.hydrate(e);if(arguments.length>=3){var s=this.hydrate(n);return r.filterFrom(t,s)}return r.filterFrom(n)},filterMembersAndGetCount:function(e,n,t){var r=this.hydrate(e),s=this.hydrate(n);return r.filterMembersAndGetCount(t,s)},unionMembers:function(e,n,t,r){var s=this.hydrate(e),i=this.hydrate(n),a=this.schema;return s.merge(i,t,r,function(e){return canReflect.getIdentity(e,a)})},isMember:function(e,n){return this.hydrate(e).isMember(n)},memberIdentity:function(e){return canReflect.getIdentity(e,this.schema)},index:function(e,n,t){return this.hydrate(e).index(t,n)},insert:function(e,n,t){var r=this.index(e,n,t);void 0===r&&(r=n.length);var s=n.slice(0);return s.splice(r,0,t),s},isPaginated:function(e){var n=this.hydrate(e);return!set_1.isEqual(n.page,set_1.UNIVERSAL)},removePagination:function(e){var n=this.hydrate(e);return n.removePagination(),this.serialize(n)}}),set_1)void 0===QueryLogic[prop]&&(QueryLogic[prop]=set_1[prop]);QueryLogic.makeEnum=function(e){var n=function(){};return n[newSymbol$1]=function(e){return e},makeEnum_1(n,e),n},QueryLogic.KeysAnd=basicQuery.KeysAnd,QueryLogic.ValuesOr=basicQuery.Or,QueryLogic.In=comparisons_1.In,QueryLogic.NotIn=comparisons_1.NotIn,QueryLogic.GreaterThan=comparisons_1.GreaterThan,QueryLogic.GreaterThanEqual=comparisons_1.GreaterThanEqual,QueryLogic.LessThan=comparisons_1.LessThan,QueryLogic.LessThanEqual=comparisons_1.LessThanEqual,QueryLogic.ValueAnd=comparisons_1.And,QueryLogic.ValueOr=comparisons_1.Or;export{QueryLogic as a,set_1 as b,helpers_1 as c,makeEnum_1 as d,QueryLogic as e};
//# sourceMappingURL=chunk-0826a8c3.js.map
